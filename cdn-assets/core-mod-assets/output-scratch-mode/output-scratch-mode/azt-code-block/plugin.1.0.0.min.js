!function(){"use strict";const n="azt-code-block",a="azt-dispatch-setup-api";var l,o,e;(e=l=l||{})[e.FRAME=0]="FRAME",e[e.DOCUMENT=1]="DOCUMENT",e[e.ALL=2]="ALL",(e=o=o||{})[e.AztSigma=0]="AztSigma",e[e.AztImage=1]="AztImage",e[e.AztAdd=2]="AztAdd",e[e.AztBadge=3]="AztBadge",e[e.AztLayoutList=4]="AztLayoutList",e[e.AztBraces=5]="AztBraces",e[e.AztListChecks=6]="AztListChecks";const i={setup:(e,o)=>{e.addCommand("aztAddSuggestionActionMenu",(e,t)=>{o.addOneMenu(t)})},call:(e,t)=>{e.execCommand("aztAddSuggestionActionMenu",!1,t)},name:"aztAddSuggestionActionMenu"},t={setup:(e,o)=>{e.addCommand("aztHiddenOneSuggestionActionMenu",(e,t)=>{o.hiddenOneMenu(t)})},call:(e,t)=>{e.execCommand("aztHiddenOneSuggestionActionMenu",!1,t)},name:"aztHiddenOneSuggestionActionMenu"},d={setup:(e,o)=>{e.addCommand("aztOpenOneSuggestionActionMenu",(e,t)=>{o.openOneMenu(t)})},call:(e,t)=>{e.execCommand("aztOpenOneSuggestionActionMenu",!1,t)},name:"aztOpenOneSuggestionActionMenu"},s={setup:(e,o)=>{e.addCommand("aztHiddenSuggestionActionMenu",(e,t)=>{o.hidden(t)})},call:(e,t)=>{e.execCommand("aztHiddenSuggestionActionMenu",!1,t)},name:"aztHiddenSuggestionActionMenu"},c={setup:(e,o)=>{e.addCommand("aztLoadScriptSource",(e,t)=>{o.loadSrcJs(t.name,t.url,t.mode).then(t.callback)})},call:(e,t)=>{e.execCommand("aztLoadScriptSource",!1,t)},name:"aztLoadScriptSource"},r={setup:(e,o)=>{e.addCommand("aztLoadMultipleScriptSource",(e,t)=>{o.loadMultipleSrcJs(t.lst).then(t.callback)})},call:(e,t)=>{e.execCommand("aztLoadMultipleScriptSource",!1,t)},name:"aztLoadMultipleScriptSource"},u={setup:(e,o)=>{e.addCommand("aztLoadStyleSource",(e,t)=>{o.loadStyle(t.name,t.content,t.mode)})},call:(e,t)=>{e.execCommand("aztLoadStyleSource",!1,t)},name:"aztLoadStyleSource"},h={setup:(e,o)=>{e.addCommand("aztSetContentPlaceholderActionMenu",(e,t)=>{o.setContent(t)})},call:(e,t)=>{e.execCommand("aztSetContentPlaceholderActionMenu",!1,t)},name:"aztSetContentPlaceholderActionMenu"};class p{constructor(e){this.editor=e}loadScript(t,o,n){return new Promise(e=>{c.call(this.editor,{name:t,url:o,mode:n,callback:e})})}loadMultipleScript(t){return new Promise(e=>{r.call(this.editor,{lst:t,callback:e})})}loadStyle(e,t,o){return u.call(this.editor,{name:e,content:t,mode:o})}hiddenSuggestionMenu(e){return s.call(this.editor,e)}addOneSuggestionMenu(e,t,o,n,a){return i.call(this.editor,{name:e,callback:t,svgIcon:o,hidden:n,hiddenOnExcuse:a})}openOneSuggestionMenu(e){return d.call(this.editor,e)}hiddenOneSuggestionMenu(e){return t.call(this.editor,e)}setContentPlaceholder(e){return h.call(this.editor,e)}pushJsonContent(e,t){return this.editor.fire("azt-dispatch-push-json-content",{name:e,content:t})}static replaceTranslateService(e){Object.prototype.hasOwnProperty.call(window,"aztEditorFnsTranslateService")||(window.aztEditorFnsTranslateService=e)}translate(e,t){return window.aztEditorFnsTranslateService?window.aztEditorFnsTranslateService(e,t):null!=t?t:e}}class g{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static replaceAllWithNonNullable(e,t,o){return null!=o&&null!=e?e.toString().replace(new RegExp(g.escapeRegExp(t),"g"),o):e}static getTextContentWithLineBreaks(e){let o="";const n=e=>{if(e.nodeType===Node.TEXT_NODE)o+=e.nodeValue;else if(e.nodeType===Node.ELEMENT_NODE)if("BR"===e.nodeName)o+="\n";else for(const t of e.childNodes)n(t)};return n(e),o}}class m{constructor(e,t){this.editor=e,this.pluginApi=t,this.pluginApi.loadScript("highlight.min.js","https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js",l.DOCUMENT).then(()=>{this.editor.addCommand("azt-code-block--popup-new-code",()=>{this.onHandleExecuteSuggestion()}),this.pluginApi.addOneSuggestionMenu(this.pluginApi.translate("lang_editor_common_open_code_block_editor","Mở trình soạn code block"),"azt-code-block--popup-new-code",o.AztBraces,!1,!0),this.editor.on("keydown",()=>{this.detachAll()}),this.editor.on("NewBlock",()=>{this.detachAll()}),this.editor.on("Change",()=>{this.detachAll()}),this.editor.on("dblclick",e=>{e=e.target.closest(".az-code-boxer");e&&this.onHandleExecuteSuggestion(e)}),this.detachAll()})}onHandleExecuteSuggestion(n){console.log(this.pluginApi),this.editor.windowManager.open({size:"large",title:this.pluginApi.translate("lang_editor_common_code_block_editor","Trình chỉnh sửa mã code block"),body:{type:"panel",items:[{type:"textarea",name:"codeBlock",placeholder:this.pluginApi.translate("lang_editor_common_paste_code","Dán đoạn code bạn muốn thêm vào")}]},buttons:[{type:"cancel",text:this.pluginApi.translate("lang_editor_common_close","Đóng")},{type:"submit",text:n?this.pluginApi.translate("lang_editor_common_edit","Chỉnh sửa"):this.pluginApi.translate("lang_editor_common_add_new_code_block","Thêm mới đoạn code"),primary:!0}],initialData:{codeBlock:n?n.getAttribute("content"):""},onSubmit:e=>{var t,o=e.getData();return n?(t=o.codeBlock,n.setAttribute("content",t),t=hljs.highlightAuto(t).value.split("\n").filter(e=>0<e.trim().length),n.querySelector(".azt-pre").innerHTML=t.map(e=>`<code class="azt-pre-code">${e}</code>`).join(""),this.editor.execCommand("mceAutoResize")):this.editor.execCommand("mceInsertContent",!1,`<code>${o.codeBlock}</code>`),this.editor.focus(),e.close()}})}detachAll(){this.editor.getBody().querySelectorAll("code").forEach(e=>{var t,o;e.hasAttribute("processing")||e.classList.contains("azt-pre-code")||(e.setAttribute("processing","true"),t=g.getTextContentWithLineBreaks(e),t=g.replaceAllWithNonNullable(t,"&lt;","<"),t=g.replaceAllWithNonNullable(t,"&gt;",">"),t=g.replaceAllWithNonNullable(t,"<br>","\n"),e.setAttribute("content",t),t=hljs.highlightAuto(t).value.split("\n").filter(e=>0<e.trim().length),e.innerHTML="",e.setAttribute("contenteditable","false"),e.classList.add("az-code-boxer"),e.setAttribute("data-translate-text",this.pluginApi.translate("lang_editor_common_source_code","Mã nguồn")),(o=document.createElement("pre")).classList.add("azt-pre"),o.innerHTML=t.map(e=>`<code class="azt-pre-code">${e}</code>`).join(""),e.appendChild(o),this.editor.execCommand("mceAutoResize"))})}}const A=`.az-code-boxer {
    margin: 10px;
    padding: 0;
    background: #eceff1;
    border-radius: 5px;
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 and IE 11 */
    user-select: none; /* Standard syntax */
    cursor: pointer;
}

.az-code-boxer[contentEditable=false][data-mce-selected] {
    outline: none;
}

.az-code-boxer::before {
    content: attr(data-translate-text);
    display: block;
    padding: 5px 10px;
    background: #2361ae;
    border-radius: 5px 5px 0 0;
    color: white;
    font-weight: 500;
} 

.az-code-boxer .azt-pre {
    border: 1px solid #2361ae;
    border-top: none;
    padding: 0;
    overflow: auto;
    border-radius: 0 0 5px 5px;
    margin: 0;
}

.az-code-boxer .azt-pre .azt-pre-code {
    display: block;
    padding: 5px 10px;
    background: linear-gradient(-225deg,#d5dbe4,#f8f8f8);
    border-radius: 0;
}

pre code.hljs {
    display: block;
    overflow-x: auto;
    padding: 1em
}

code.hljs {
    padding: 3px 5px
}

.hljs {
    background: #f3f3f3;
    color: #444
}

.hljs-comment {
    color: #697070
}

.hljs-punctuation,
.hljs-tag {
    color: #444a
}

.hljs-tag .hljs-attr,
.hljs-tag .hljs-name {
    color: #444
}

.hljs-attribute,
.hljs-doctag,
.hljs-keyword,
.hljs-meta .hljs-keyword,
.hljs-name,
.hljs-selector-tag {
    font-weight: 700
}

.hljs-deletion,
.hljs-number,
.hljs-quote,
.hljs-selector-class,
.hljs-selector-id,
.hljs-string,
.hljs-template-tag,
.hljs-type {
    color: #800
}

.hljs-section,
.hljs-title {
    color: #800;
    font-weight: 700
}

.hljs-link,
.hljs-operator,
.hljs-regexp,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-symbol,
.hljs-template-variable,
.hljs-variable {
    color: #ab5656
}

.hljs-literal {
    color: #695
}

.hljs-addition,
.hljs-built_in,
.hljs-bullet,
.hljs-code {
    color: #397300
}

.hljs-meta {
    color: #1f7199
}

.hljs-meta .hljs-string {
    color: #38a
}

.hljs-emphasis {
    font-style: italic
}

.hljs-strong {
    font-weight: 700
}`,b=t=>{var o;o=t,new Promise(e=>{o.on(a,()=>{e(new p(o))})}).then(e=>{e.loadStyle(n+"__default",A,l.FRAME),new m(t,e)})};tinymce.PluginManager.add(n,b)}();