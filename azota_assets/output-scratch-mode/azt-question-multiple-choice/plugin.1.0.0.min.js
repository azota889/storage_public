!function(){"use strict";const a="azt-question-multiple-choice",i="azt-dispatch-setup-api",n="azt-dispatch-push-json-content";var s,o,e;(e=s=s||{})[e.FRAME=0]="FRAME",e[e.DOCUMENT=1]="DOCUMENT",e[e.ALL=2]="ALL",(e=o=o||{})[e.AztSigma=0]="AztSigma",e[e.AztImage=1]="AztImage",e[e.AztAdd=2]="AztAdd",e[e.AztBadge=3]="AztBadge",e[e.AztLayoutList=4]="AztLayoutList",e[e.AztBraces=5]="AztBraces",e[e.AztListChecks=6]="AztListChecks";const r={setup:(e,n)=>{e.addCommand("aztAddSuggestionActionMenu",(e,t)=>{n.addOneMenu(t)})},call:(e,t)=>{e.execCommand("aztAddSuggestionActionMenu",!1,t)},name:"aztAddSuggestionActionMenu"},t={setup:(e,n)=>{e.addCommand("aztHiddenOneSuggestionActionMenu",(e,t)=>{n.hiddenOneMenu(t)})},call:(e,t)=>{e.execCommand("aztHiddenOneSuggestionActionMenu",!1,t)},name:"aztHiddenOneSuggestionActionMenu"},c={setup:(e,n)=>{e.addCommand("aztOpenOneSuggestionActionMenu",(e,t)=>{n.openOneMenu(t)})},call:(e,t)=>{e.execCommand("aztOpenOneSuggestionActionMenu",!1,t)},name:"aztOpenOneSuggestionActionMenu"},l={setup:(e,n)=>{e.addCommand("aztHiddenSuggestionActionMenu",(e,t)=>{n.hidden(t)})},call:(e,t)=>{e.execCommand("aztHiddenSuggestionActionMenu",!1,t)},name:"aztHiddenSuggestionActionMenu"},d={setup:(e,n)=>{e.addCommand("aztLoadScriptSource",(e,t)=>{n.loadSrcJs(t.name,t.url,t.mode).then(t.callback)})},call:(e,t)=>{e.execCommand("aztLoadScriptSource",!1,t)},name:"aztLoadScriptSource"},u={setup:(e,n)=>{e.addCommand("aztLoadMultipleScriptSource",(e,t)=>{n.loadMultipleSrcJs(t.lst).then(t.callback)})},call:(e,t)=>{e.execCommand("aztLoadMultipleScriptSource",!1,t)},name:"aztLoadMultipleScriptSource"},p={setup:(e,n)=>{e.addCommand("aztLoadStyleSource",(e,t)=>{n.loadStyle(t.name,t.content,t.mode)})},call:(e,t)=>{e.execCommand("aztLoadStyleSource",!1,t)},name:"aztLoadStyleSource"},m={setup:(e,n)=>{e.addCommand("aztSetContentPlaceholderActionMenu",(e,t)=>{n.setContent(t)})},call:(e,t)=>{e.execCommand("aztSetContentPlaceholderActionMenu",!1,t)},name:"aztSetContentPlaceholderActionMenu"};class h{constructor(e){this.editor=e}loadScript(t,n,a){return new Promise(e=>{d.call(this.editor,{name:t,url:n,mode:a,callback:e})})}loadMultipleScript(t){return new Promise(e=>{u.call(this.editor,{lst:t,callback:e})})}loadStyle(e,t,n){return p.call(this.editor,{name:e,content:t,mode:n})}hiddenSuggestionMenu(e){return l.call(this.editor,e)}addOneSuggestionMenu(e,t,n,a,i){return r.call(this.editor,{name:e,callback:t,svgIcon:n,hidden:a,hiddenOnExcuse:i})}openOneSuggestionMenu(e){return c.call(this.editor,e)}hiddenOneSuggestionMenu(e){return t.call(this.editor,e)}setContentPlaceholder(e){return m.call(this.editor,e)}pushJsonContent(e,t){return this.editor.fire(n,{name:e,content:t})}static replaceTranslateService(e){Object.prototype.hasOwnProperty.call(window,"aztEditorFnsTranslateService")||(window.aztEditorFnsTranslateService=e)}translate(e,t){return window.aztEditorFnsTranslateService?window.aztEditorFnsTranslateService(e,t):null!=t?t:e}}class g{constructor(e,t){this.editor=e,this.pluginApi=t,this.startCheckRemove=!1,this.editor.on(n,e=>{"QUESTION_MULTIPLE_CHOICE_JSON"===e.name&&this.processJsonToElement(e.content)}),t.addOneSuggestionMenu(this.pluginApi.translate("lang_editor_common_add_multiple_choice_question_layout","Thêm layout câu hỏi trắc nghiệm"),"azt-manager-plugins--question-add-multiple-choice",o.AztLayoutList,!1,!0),this.editor.on("keydown",e=>{if("Tab"===e.code){e.preventDefault();e=this.editor.selection.getRng().commonAncestorContainer.parentElement;if("P"===e.tagName&&e.textContent.startsWith("A."))return this.checkExistAnswer()?void 0:(this.createLstAnswers("azt-question-multiple-choice-answers-layout-4",e),this.onHasChoiceTypeQuest());e.closest(".azt-question-answer")&&this.editor.execCommand("mceInsertNewLine")}0===this.editor.getBody().querySelectorAll(".azt-question-multiple-choice-answers").length&&this.onNotHasChoiceTypeQuest()}),this.editor.on("NewBlock",e=>{e=e.newBlock.previousSibling;if(e&&e.tagName&&"P"===e.tagName&&e.textContent.startsWith("A."))return this.createLstAnswers("azt-question-multiple-choice-answers-layout-4",e),this.onHasChoiceTypeQuest();this.recheckElementAnswer()}),this.editor.on("click",e=>{var t=e.target;t.closest&&t.closest(".azt-question-answer")&&e.offsetX<=0&&((e=t.closest(".azt-question-answer")).classList.contains("correct-answer")?(e.classList.remove("correct-answer"),(t=this.editor.getBody().querySelector(`.qv_string_eng_ans[data-index-answer='${e.getAttribute("data-index-answer").replace(".","")}']`))&&t.classList.remove("correct-answer")):(e.classList.add("correct-answer"),(t=this.editor.getBody().querySelector(`.qv_string_eng_ans[data-index-answer='${e.getAttribute("data-index-answer").replace(".","")}']`))&&t.classList.add("correct-answer")))})}createAnswerElement(){var e=document.createElement("ol");return e.classList.add("azt-answer-managers"),e.classList.add("azt-question-multiple-choice-answers"),e}createLstAnswersFromInput(e){const a=this.createAnswerElement();a.classList.add("azt-question-multiple-choice-answers-layout-4"),e.forEach(e=>{var t,n=document.createElement("li");n.classList.add("azt-question-answer"),n.innerHTML=e.content,e.isTrue&&(n.classList.add("correct-answer"),t=this.editor.getBody().querySelector(`.qv_string_eng_ans[data-index-answer='${e.key}']`))&&t.classList.add("correct-answer"),n.setAttribute("data-index-answer",e.key+"."),a.appendChild(n)}),this.editor.getBody().prepend(a),this.onHasChoiceTypeQuest()}processJsonToElement(e){this.createLstAnswersFromInput(e.answers);var t=document.createElement("p");t.innerHTML=e.content,this.editor.getBody().prepend(t),this.editor.selection.setCursorLocation(t,0)}recheckElementAnswer(){var e=this.editor.getBody().querySelectorAll(".azt-question-multiple-choice-answers .azt-question-answer");e.forEach((e,t)=>{e.setAttribute("data-index-answer",["A","B","C","D","E","F","G","H","I","K","L","M","N"][t]+".")}),e.length&&this.onHasChoiceTypeQuest()}onHasChoiceTypeQuest(){this.startCheckRemove=!0,this.pluginApi.hiddenOneSuggestionMenu("azt-manager-plugins--question-add-multiple-choice"),this.pluginApi.setContentPlaceholder(this.pluginApi.translate("lang_cms_common_open_tool","Gõ [kbd=/] để mở công cụ."))}onNotHasChoiceTypeQuest(){this.startCheckRemove&&(this.pluginApi.setContentPlaceholder(this.pluginApi.translate("lang_cms_common_start_answer_input","Gõ [kbd=/] để mở công cụ. Gõ [kbd=A.] nội dung + [kbd=tab] hoặc [kbd=enter] để bắt đầu nhập đáp án")),this.pluginApi.openOneSuggestionMenu("azt-manager-plugins--question-add-multiple-choice"))}checkExistAnswer(){return 0<this.editor.getBody().querySelectorAll(".azt-question-multiple-choice-answers").length}createLstAnswers(e,t){var n=document.createElement("div"),a=(t.parentNode.insertBefore(n,t),t),i=this.createAnswerElement(),e=(i.classList.add(e),t.innerHTML=t.innerHTML.substring(2),document.createElement("li"));e.classList.add("azt-question-answer"),e.appendChild(t),i.appendChild(e),0<t.textContent.length&&((e=document.createElement("li")).classList.add("azt-question-answer"),(t=document.createElement("p")).innerHTML="<br/>",e.appendChild(t),i.appendChild(e),a=t),n.appendChild(i),this.editor.selection.setCursorLocation(a,0),this.recheckElementAnswer()}}const w=`.azt-question-multiple-choice-answers {
    padding-left: 16px;
    list-style: none;
    margin: 5px;
    margin-top: 20px;
    display: grid;
    grid-row-gap: 10px;
}

.azt-question-multiple-choice-answers .azt-question-answer {
    position: relative;
    width: fit-content;
}

.azt-question-multiple-choice-answers .azt-question-answer::before {
    content: attr(data-index-answer);
    position: absolute;
    top: 50%;
    left: -12px;
    transform: translate(-50%, -50%);
}

.azt-question-multiple-choice-answers .azt-question-answer::after {
    content: '';
    position: absolute;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 2px solid #2361ae;
    top: 50%;
    left: -35px;
    transform: translate(-50%, -50%);
    cursor: pointer;
}

.azt-question-multiple-choice-answers .correct-answer::after,
.qv_string_eng_ans.correct-answer::after {
    content: '✓';
    background-color: #2361ae;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    font-weight: 700;
}

.qv_string_eng_ans.correct-answer::after {
    font-size: 8px;
}

.qv_string_eng_ans.correct-answer {
    color: #2361ae;
}

.azt-question-multiple-choice-answers-layout-2 {
    display: grid;
    align-items: center;
    grid-template-columns: 50% 50%;
    grid-gap: 10px;
    box-sizing: border-box;
}

.azt-question-multiple-choice-answers-layout-2 .azt-question-answer {
    max-width: 90%;
}

.azt-question-multiple-choice-answers-layout-1 {
    display: grid;
    align-items: center;
    grid-template-columns: 25% 25% 25% 25%;
    grid-gap: 10px;
    box-sizing: border-box;
}

.azt-question-multiple-choice-answers-layout-1 .azt-question-answer {
    max-width: 82%;
}

.azt-question-multiple-choice-answers-layout-1-3 {
    display: grid;
    align-items: center;
    grid-template-columns: 33.33% 33.33% 33.33%;
    grid-gap: 10px;
    box-sizing: border-box;
}

.azt-question-multiple-choice-answers-layout-1-3 .azt-question-answer {
    max-width: 86%;
}

.qv_string_eng_ans {
    cursor: pointer;
    padding: 0 5px;
    font-weight: bold;
    text-decoration: underline;
    position: relative;
    height: 40px;
    display: inline-block;
    text-underline-offset: 4px;
    text-decoration-skip-ink: none;
}

.qv_string_eng_ans::after {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 2px solid #2361ae;
    top: 30px;
    left: 50%;
    transform: translate(-160%, 0);
    cursor: pointer;
}

.qv_string_eng_ans::before {
    content: attr(data-index-answer);
    position: absolute;
    top: 23px;
    left: 50% !important;
    transform: translate(-50%, 0) !important;
}`,z=t=>{var n;n=t,new Promise(e=>{n.on(i,()=>{e(new h(n))})}).then(e=>{e.loadStyle(a+"__default",w,s.ALL),new g(t,e)})};tinymce.PluginManager.add(a,z)}();