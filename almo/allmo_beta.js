var QRCode;
!function(){function a(g){this.mode=l.MODE_8BIT_BYTE;this.data=g;this.parsedData=[];g=[];for(var k=0,h=this.data.length;h>k;k++){var m=this.data.charCodeAt(k);65536<m?(g[0]=240|(1835008&m)>>>18,g[1]=128|(258048&m)>>>12,g[2]=128|(4032&m)>>>6,g[3]=128|63&m):2048<m?(g[0]=224|(61440&m)>>>12,g[1]=128|(4032&m)>>>6,g[2]=128|63&m):128<m?(g[0]=192|(1984&m)>>>6,g[1]=128|63&m):g[0]=m;this.parsedData=this.parsedData.concat(g)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),
this.parsedData.unshift(239))}function b(g,k){this.typeNumber=g;this.errorCorrectLevel=k;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function c(g,k){if(void 0==g.length)throw Error(g.length+"/"+k);for(var h=0;h<g.length&&0==g[h];)h++;this.num=Array(g.length-h+k);for(k=0;k<g.length-h;k++)this.num[k]=g[k+h]}function d(g,k){this.totalCount=g;this.dataCount=k}function e(){this.buffer=[];this.length=0}function f(){var g=!1,k=navigator.userAgent;return/android/i.test(k)&&(g=
!0,aMat=k.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(g=parseFloat(aMat[1]))),g}a.prototype={getLength:function(){return this.parsedData.length},write:function(g){for(var k=0,h=this.parsedData.length;h>k;k++)g.put(this.parsedData[k],8)}};b.prototype={addData:function(g){g=new a(g);this.dataList.push(g);this.dataCache=null},isDark:function(g,k){if(0>g||this.moduleCount<=g||0>k||this.moduleCount<=k)throw Error(g+","+k);return this.modules[g][k]},getModuleCount:function(){return this.moduleCount},
make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(g,k){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var h=0;h<this.moduleCount;h++){this.modules[h]=Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++)this.modules[h][m]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(g,
k);7<=this.typeNumber&&this.setupTypeNumber(g);null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,k)},setupPositionProbePattern:function(g,k){for(var h=-1;7>=h;h++)if(!(-1>=g+h||this.moduleCount<=g+h))for(var m=-1;7>=m;m++)-1>=k+m||this.moduleCount<=k+m||(this.modules[g+h][k+m]=0<=h&&6>=h&&(0==m||6==m)||0<=m&&6>=m&&(0==h||6==h)||2<=h&&4>=h&&2<=m&&4>=m?!0:!1)},getBestMaskPattern:function(){for(var g=0,k=0,h=0;8>h;h++){this.makeImpl(!0,
h);var m=n.getLostPoint(this);(0==h||g>m)&&(g=m,k=h)}return k},createMovieClip:function(g,k,h){g=g.createEmptyMovieClip(k,h);this.make();for(k=0;k<this.modules.length;k++){h=1*k;for(var m=0;m<this.modules[k].length;m++){var r=1*m;this.modules[k][m]&&(g.beginFill(0,100),g.moveTo(r,h),g.lineTo(r+1,h),g.lineTo(r+1,h+1),g.lineTo(r,h+1),g.endFill())}}return g},setupTimingPattern:function(){for(var g=8;g<this.moduleCount-8;g++)null==this.modules[g][6]&&(this.modules[g][6]=0==g%2);for(g=8;g<this.moduleCount-
8;g++)null==this.modules[6][g]&&(this.modules[6][g]=0==g%2)},setupPositionAdjustPattern:function(){for(var g=n.getPatternPosition(this.typeNumber),k=0;k<g.length;k++)for(var h=0;h<g.length;h++){var m=g[k],r=g[h];if(null==this.modules[m][r])for(var v=-2;2>=v;v++)for(var y=-2;2>=y;y++)this.modules[m+v][r+y]=-2==v||2==v||-2==y||2==y||0==v&&0==y?!0:!1}},setupTypeNumber:function(g){for(var k=n.getBCHTypeNumber(this.typeNumber),h=0;18>h;h++){var m=!g&&1==(1&k>>h);this.modules[Math.floor(h/3)][h%3+this.moduleCount-
8-3]=m}for(h=0;18>h;h++)m=!g&&1==(1&k>>h),this.modules[h%3+this.moduleCount-8-3][Math.floor(h/3)]=m},setupTypeInfo:function(g,k){k=n.getBCHTypeInfo(this.errorCorrectLevel<<3|k);for(var h=0;15>h;h++){var m=!g&&1==(1&k>>h);6>h?this.modules[h][8]=m:8>h?this.modules[h+1][8]=m:this.modules[this.moduleCount-15+h][8]=m}for(h=0;15>h;h++)m=!g&&1==(1&k>>h),8>h?this.modules[8][this.moduleCount-h-1]=m:9>h?this.modules[8][15-h-1+1]=m:this.modules[8][15-h-1]=m;this.modules[this.moduleCount-8][8]=!g},mapData:function(g,
k){for(var h=-1,m=this.moduleCount-1,r=7,v=0,y=this.moduleCount-1;0<y;y-=2)for(6==y&&y--;;){for(var u=0;2>u;u++)if(null==this.modules[m][y-u]){var F=!1;v<g.length&&(F=1==(1&g[v]>>>r));n.getMask(k,m,y-u)&&(F=!F);this.modules[m][y-u]=F;r--;-1==r&&(v++,r=7)}if(m+=h,0>m||this.moduleCount<=m){m-=h;h=-h;break}}}};b.PAD0=236;b.PAD1=17;b.createData=function(g,k,h){k=d.getRSBlocks(g,k);for(var m=new e,r=0;r<h.length;r++){var v=h[r];m.put(v.mode,4);m.put(v.getLength(),n.getLengthInBits(v.mode,g));v.write(m)}for(r=
g=0;r<k.length;r++)g+=k[r].dataCount;if(m.getLengthInBits()>8*g)throw Error("code length overflow. ("+m.getLengthInBits()+">"+8*g+")");for(m.getLengthInBits()+4<=8*g&&m.put(0,4);0!=m.getLengthInBits()%8;)m.putBit(!1);for(;!(m.getLengthInBits()>=8*g||(m.put(b.PAD0,8),m.getLengthInBits()>=8*g));)m.put(b.PAD1,8);return b.createBytes(m,k)};b.createBytes=function(g,k){for(var h=0,m=0,r=0,v=Array(k.length),y=Array(k.length),u=0;u<k.length;u++){var F=k[u].dataCount,H=k[u].totalCount-F;m=Math.max(m,F);r=
Math.max(r,H);v[u]=Array(F);for(var C=0;C<v[u].length;C++)v[u][C]=255&g.buffer[C+h];h+=F;C=n.getErrorCorrectPolynomial(H);F=(new c(v[u],C.getLength()-1)).mod(C);y[u]=Array(C.getLength()-1);for(C=0;C<y[u].length;C++)H=C+F.getLength()-y[u].length,y[u][C]=0<=H?F.get(H):0}for(C=u=0;C<k.length;C++)u+=k[C].totalCount;g=Array(u);for(C=h=0;m>C;C++)for(u=0;u<k.length;u++)C<v[u].length&&(g[h++]=v[u][C]);for(C=0;r>C;C++)for(u=0;u<k.length;u++)C<y[u].length&&(g[h++]=y[u][C]);return g};for(var l={MODE_NUMBER:1,
MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},p={L:1,M:0,Q:3,H:2},n={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,
86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(g){for(var k=g<<10;0<=n.getBCHDigit(k)-n.getBCHDigit(n.G15);)k^=n.G15<<n.getBCHDigit(k)-n.getBCHDigit(n.G15);return(g<<10|k)^n.G15_MASK},getBCHTypeNumber:function(g){for(var k=g<<12;0<=n.getBCHDigit(k)-n.getBCHDigit(n.G18);)k^=n.G18<<n.getBCHDigit(k)-
n.getBCHDigit(n.G18);return g<<12|k},getBCHDigit:function(g){for(var k=0;0!=g;)k++,g>>>=1;return k},getPatternPosition:function(g){return n.PATTERN_POSITION_TABLE[g-1]},getMask:function(g,k,h){switch(g){case 0:return 0==(k+h)%2;case 1:return 0==k%2;case 2:return 0==h%3;case 3:return 0==(k+h)%3;case 4:return 0==(Math.floor(k/2)+Math.floor(h/3))%2;case 5:return 0==k*h%2+k*h%3;case 6:return 0==(k*h%2+k*h%3)%2;case 7:return 0==(k*h%3+(k+h)%2)%2;default:throw Error("bad maskPattern:"+g);}},getErrorCorrectPolynomial:function(g){for(var k=
new c([1],0),h=0;g>h;h++)k=k.multiply(new c([1,w.gexp(h)],0));return k},getLengthInBits:function(g,k){if(1<=k&&10>k)switch(g){case l.MODE_NUMBER:return 10;case l.MODE_ALPHA_NUM:return 9;case l.MODE_8BIT_BYTE:return 8;case l.MODE_KANJI:return 8;default:throw Error("mode:"+g);}else if(27>k)switch(g){case l.MODE_NUMBER:return 12;case l.MODE_ALPHA_NUM:return 11;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 10;default:throw Error("mode:"+g);}else{if(!(41>k))throw Error("type:"+k);switch(g){case l.MODE_NUMBER:return 14;
case l.MODE_ALPHA_NUM:return 13;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 12;default:throw Error("mode:"+g);}}},getLostPoint:function(g){for(var k=g.getModuleCount(),h=0,m=0;k>m;m++)for(var r=0;k>r;r++){for(var v=0,y=g.isDark(m,r),u=-1;1>=u;u++)if(!(0>m+u||m+u>=k))for(var F=-1;1>=F;F++)0>r+F||r+F>=k||(0!=u||0!=F)&&y==g.isDark(m+u,r+F)&&v++;5<v&&(h+=3+v-5)}for(m=0;k-1>m;m++)for(r=0;k-1>r;r++)v=0,g.isDark(m,r)&&v++,g.isDark(m+1,r)&&v++,g.isDark(m,r+1)&&v++,g.isDark(m+1,r+1)&&v++,0!=v&&
4!=v||(h+=3);for(m=0;k>m;m++)for(r=0;k-6>r;r++)g.isDark(m,r)&&!g.isDark(m,r+1)&&g.isDark(m,r+2)&&g.isDark(m,r+3)&&g.isDark(m,r+4)&&!g.isDark(m,r+5)&&g.isDark(m,r+6)&&(h+=40);for(r=0;k>r;r++)for(m=0;k-6>m;m++)g.isDark(m,r)&&!g.isDark(m+1,r)&&g.isDark(m+2,r)&&g.isDark(m+3,r)&&g.isDark(m+4,r)&&!g.isDark(m+5,r)&&g.isDark(m+6,r)&&(h+=40);for(r=v=0;k>r;r++)for(m=0;k>m;m++)g.isDark(m,r)&&v++;return h+Math.abs(100*v/k/k-50)/5*10}},w={glog:function(g){if(1>g)throw Error("glog("+g+")");return w.LOG_TABLE[g]},
gexp:function(g){for(;0>g;)g+=255;for(;256<=g;)g-=255;return w.EXP_TABLE[g]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},x=0;8>x;x++)w.EXP_TABLE[x]=1<<x;for(x=8;256>x;x++)w.EXP_TABLE[x]=w.EXP_TABLE[x-4]^w.EXP_TABLE[x-5]^w.EXP_TABLE[x-6]^w.EXP_TABLE[x-8];for(x=0;255>x;x++)w.LOG_TABLE[w.EXP_TABLE[x]]=x;c.prototype={get:function(g){return this.num[g]},getLength:function(){return this.num.length},multiply:function(g){for(var k=Array(this.getLength()+g.getLength()-1),h=0;h<this.getLength();h++)for(var m=
0;m<g.getLength();m++)k[h+m]^=w.gexp(w.glog(this.get(h))+w.glog(g.get(m)));return new c(k,0)},mod:function(g){if(0>this.getLength()-g.getLength())return this;for(var k=w.glog(this.get(0))-w.glog(g.get(0)),h=Array(this.getLength()),m=0;m<this.getLength();m++)h[m]=this.get(m);for(m=0;m<g.getLength();m++)h[m]^=w.gexp(w.glog(g.get(m))+k);return(new c(h,0)).mod(g)}};d.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],
[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,
46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,
70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,
46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],
[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,
46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];d.getRSBlocks=function(g,k){var h=d.getRsBlockTable(g,k);if(void 0==h)throw Error("bad rs block @ typeNumber:"+g+"/errorCorrectLevel:"+k);g=h.length/3;k=[];for(var m=0;g>m;m++)for(var r=h[3*m],v=h[3*m+1],y=h[3*m+2],u=0;r>u;u++)k.push(new d(v,y));return k};d.getRsBlockTable=function(g,
k){switch(k){case p.L:return d.RS_BLOCK_TABLE[4*(g-1)];case p.M:return d.RS_BLOCK_TABLE[4*(g-1)+1];case p.Q:return d.RS_BLOCK_TABLE[4*(g-1)+2];case p.H:return d.RS_BLOCK_TABLE[4*(g-1)+3]}};e.prototype={get:function(g){return 1==(1&this.buffer[Math.floor(g/8)]>>>7-g%8)},put:function(g,k){for(var h=0;k>h;h++)this.putBit(1==(1&g>>>k-h-1))},getLengthInBits:function(){return this.length},putBit:function(g){var k=Math.floor(this.length/8);this.buffer.length<=k&&this.buffer.push(0);g&&(this.buffer[k]|=128>>>
this.length%8);this.length++}};var G=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,
625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];x=function(){var g=function(k,h){this._el=k;this._htOption=h};return g.prototype.draw=function(k){function h(F,H){F=document.createElementNS("http://www.w3.org/2000/svg",F);for(var C in H)H.hasOwnProperty(C)&&F.setAttribute(C,
H[C]);return F}var m=this._htOption,r=this._el,v=k.getModuleCount();Math.floor(m.width/v);Math.floor(m.height/v);this.clear();var y=h("svg",{viewBox:"0 0 "+String(v)+" "+String(v),width:"100%",height:"100%",fill:m.colorLight});y.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");r.appendChild(y);y.appendChild(h("rect",{fill:m.colorDark,width:"1",height:"1",id:"template"}));for(m=0;v>m;m++)for(r=0;v>r;r++)if(k.isDark(m,r)){var u=h("use",{x:String(m),y:String(r)});
u.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");y.appendChild(u)}},g.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},g}();var N="svg"===document.documentElement.tagName.toLowerCase()?x:"undefined"!=typeof CanvasRenderingContext2D?function(){function g(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}function k(v,y){var u=this;if(u._fFail=y,u._fSuccess=
v,null===u._bSupportDataURI)return v=document.createElement("img"),y=function(){u._bSupportDataURI=!1;u._fFail&&_fFail.call(u)},v.onabort=y,v.onerror=y,v.onload=function(){u._bSupportDataURI=!0;u._fSuccess&&u._fSuccess.call(u)},v.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0;!0===u._bSupportDataURI&&u._fSuccess?u._fSuccess.call(u):!1===u._bSupportDataURI&&u._fFail&&u._fFail.call(u)}if(this._android&&
2.1>=this._android){var h=1/window.devicePixelRatio,m=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(v,y,u,F,H,C,J,K){if("nodeName"in v&&/img/i.test(v.nodeName))for(var L=arguments.length-1;1<=L;L--)arguments[L]*=h;else"undefined"==typeof K&&(arguments[1]*=h,arguments[2]*=h,arguments[3]*=h,arguments[4]*=h);m.apply(this,arguments)}}var r=function(v,y){this._bIsPainted=!1;this._android=f();this._htOption=y;this._elCanvas=document.createElement("canvas");
this._elCanvas.width=y.width;this._elCanvas.height=y.height;v.appendChild(this._elCanvas);this._el=v;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=!1;this._elImage=document.createElement("img");this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};return r.prototype.draw=function(v){var y=this._elImage,u=this._oContext,F=this._htOption,H=v.getModuleCount(),C=F.width/H,J=F.height/H,K=Math.round(C),L=Math.round(J);y.style.display="none";
this.clear();for(y=0;H>y;y++)for(var P=0;H>P;P++){var S=v.isDark(y,P),R=P*C,Q=y*J;u.strokeStyle=S?F.colorDark:F.colorLight;u.lineWidth=1;u.fillStyle=S?F.colorDark:F.colorLight;u.fillRect(R,Q,C,J);u.strokeRect(Math.floor(R)+.5,Math.floor(Q)+.5,K,L);u.strokeRect(Math.ceil(R)-.5,Math.ceil(Q)-.5,K,L)}this._bIsPainted=!0},r.prototype.makeImage=function(){this._bIsPainted&&k.call(this,g)},r.prototype.isPainted=function(){return this._bIsPainted},r.prototype.clear=function(){this._oContext.clearRect(0,0,
this._elCanvas.width,this._elCanvas.height);this._bIsPainted=!1},r.prototype.round=function(v){return v?Math.floor(1E3*v)/1E3:v},r}():function(){var g=function(k,h){this._el=k;this._htOption=h};return g.prototype.draw=function(k){for(var h=this._htOption,m=this._el,r=k.getModuleCount(),v=Math.floor(h.width/r),y=Math.floor(h.height/r),u=['<table style="border:0;border-collapse:collapse;">'],F=0;r>F;F++){u.push("<tr>");for(var H=0;r>H;H++)u.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+
v+"px;height:"+y+"px;background-color:"+(k.isDark(F,H)?h.colorDark:h.colorLight)+';"></td>');u.push("</tr>")}u.push("</table>");m.innerHTML=u.join("");k=m.childNodes[0];m=(h.width-k.offsetWidth)/2;h=(h.height-k.offsetHeight)/2;0<m&&0<h&&(k.style.margin=h+"px "+m+"px")},g.prototype.clear=function(){this._el.innerHTML=""},g}();QRCode=function(g,k){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:p.H},"string"==typeof k&&(k={text:k}),k)for(var h in k)this._htOption[h]=
k[h];"string"==typeof g&&(g=document.getElementById(g));this._android=f();this._el=g;this._oQRCode=null;this._oDrawing=new N(this._el,this._htOption);this._htOption.text&&this.makeCode(this._htOption.text)};QRCode.prototype.makeCode=function(g){var k=this._htOption.correctLevel,h=1;var m=encodeURI(g).toString().replace(/%[0-9a-fA-F]{2}/g,"a");m=m.length+(m.length!=g?3:0);for(var r=0,v=G.length;v>=r;r++){var y=0;switch(k){case p.L:y=G[r][0];break;case p.M:y=G[r][1];break;case p.Q:y=G[r][2];break;case p.H:y=
G[r][3]}if(y>=m)break;h++}if(h>G.length)throw Error("Too long data");this._oQRCode=new b(h,this._htOption.correctLevel);this._oQRCode.addData(g);this._oQRCode.make();this._el.title=g;this._oDrawing.draw(this._oQRCode);this.makeImage()};QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||3<=this._android)&&this._oDrawing.makeImage()};QRCode.prototype.clear=function(){this._oDrawing.clear()};QRCode.CorrectLevel=p}();var $jscomp=$jscomp||{};
$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var l=e[f];if(!(l in d))return;d=d[l]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};
(function(){function a(t,B){var z=0,D=!1,A=window.setInterval(function(){t()&&(window.clearInterval(A),B(D));50<z++&&(window.clearInterval(A),D=!0,B(D))},10)}function b(t){t=t.toLowerCase();return 0===t.indexOf("msie")&&0===t.indexOf("trident")?!1:(t=/(?:msie|rv:)\s?([\d\.]+)/.exec(t))&&10<=parseInt(t[1],10)?!0:!1}function c(t){t=(t||n.userAgent).toLowerCase();return(t=t.match(/android\s([0-9\.]*)/))?t[1]:!1}function d(t,B){function z(I){if(I){console.log("candicate "+I);var T=u.exec(I);T&&(T=T[1],
I=I.match(y),void 0===A[T]&&t(T,I,!0),A[T]=!0)}else t()}function D(){O.localDescription.sdp.split("\n").forEach(function(I){I&&0===I.indexOf("a=candidate:")&&z(I)})}if("undefined"!==typeof document&&"function"===typeof document.getElementById){var A={},E=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!E){E=document.getElementById("iframe");if(!E)return;E=E.contentWindow;E=E.RTCPeerConnection||E.mozRTCPeerConnection||E.webkitRTCPeerConnection}if(E){var W=null;
"Chrome"===q.browser&&58>q.browser.version&&(W={optional:[{RtpDataChannels:!0}]});var O=new E({iceServers:[]},W);B&&(O.addStream?O.addStream(B):O.addTrack&&B.getTracks()[0]&&O.addTrack(B.getTracks()[0],B));O.onicecandidate=function(I){I.candidate&&I.candidate.candidate?z(I.candidate.candidate):z()};if(!B)try{O.createDataChannel("",{reliable:!1})}catch(I){}q.isPromisesSupported?O.createOffer().then(function(I){O.setLocalDescription(I).then(D)}):O.createOffer(function(I){O.setLocalDescription(I,D,function(){})},
function(){})}}}function e(t){if(L)if(!n.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(n.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!n.enumerateDevices&&n.enumerateDevices&&(n.enumerateDevices=n.enumerateDevices.bind(n)),n.enumerateDevices){H=[];C=[];J=[];K=[];U=Q=R=S=P=!1;var B={};n.enumerateDevices(function(z){H=[];C=[];J=[];K=[];z.forEach(function(D){var A={},E;for(E in D)try{"function"!==typeof D[E]&&(A[E]=D[E])}catch(W){}B[A.deviceId+
A.label+A.kind]||("audio"===A.kind&&(A.kind="audioinput"),"video"===A.kind&&(A.kind="videoinput"),A.deviceId||(A.deviceId=A.id),A.id||(A.id=A.deviceId),A.label?("videoinput"!==A.kind||U||(U=!0),"audioinput"!==A.kind||Q||(Q=!0)):(A.isCustomLabel=!0,A.label="videoinput"===A.kind?"Camera "+(K.length+1):"audioinput"===A.kind?"Microphone "+(C.length+1):"audiooutput"===A.kind?"Speaker "+(J.length+1):"Please invoke getUserMedia once.","undefined"!==typeof q&&q.browser.isChrome&&46<=q.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||
"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(A.label="HTTPs is required to get label of this "+A.kind+" device.")),"audioinput"===A.kind&&(P=!0,-1===C.indexOf(A)&&C.push(A)),"audiooutput"===A.kind&&(S=!0,-1===J.indexOf(A)&&J.push(A)),"videoinput"===A.kind&&(R=!0,-1===K.indexOf(A)&&K.push(A)),H.push(A),B[A.deviceId+A.label+A.kind]=A)});"undefined"!==typeof q&&(q.MediaDevices=H,q.hasMicrophone=P,q.hasSpeakers=
S,q.hasWebcam=R,q.isWebsiteHasWebcamPermissions=U,q.isWebsiteHasMicrophonePermissions=Q,q.audioInputDevices=C,q.audioOutputDevices=J,q.videoInputDevices=K);t&&t()})}else t&&t();else t&&t()}var f="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",l="object"===typeof process&&"object"===typeof process.versions&&process.versions.node&&!process.browser;if(l){var p=process.versions.node.toString().replace("v","");f="Nodejs/"+p+" (NodeOS) AppleWebKit/"+p+" (KHTML, like Gecko) Nodejs/"+
p+" Nodejs/"+p}(function(t){"undefined"===typeof window&&("undefined"===typeof window&&"undefined"!==typeof global?(global.navigator={userAgent:f,getUserMedia:function(){}},t.window=global):"undefined"===typeof window&&console.log("window undefined"),"undefined"===typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"===typeof screen&&(t.screen={width:0,height:0}))})("undefined"!==typeof global?global:window);var n=window.navigator;"undefined"!==typeof n?("undefined"!==typeof n.webkitGetUserMedia&&
(n.getUserMedia=n.webkitGetUserMedia),"undefined"!==typeof n.mozGetUserMedia&&(n.getUserMedia=n.mozGetUserMedia)):n={getUserMedia:function(){},userAgent:f};p=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(n.userAgent||"");var w=-1!==n.userAgent.indexOf("Edge")&&(!!n.msSaveOrOpenBlob||!!n.msSaveBlob),x=!!window.opera||0<=n.userAgent.indexOf(" OPR/"),G=-1<n.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(n.userAgent),N=/^((?!chrome|android).)*safari/i.test(n.userAgent),
g=!!window.chrome&&!x,k={Android:function(){return n.userAgent.match(/Android/i)},BlackBerry:function(){return n.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return n.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.userAgent.match(/Opera Mini/i)},Windows:function(){return n.userAgent.match(/IEMobile/i)},any:function(){return k.Android()||k.BlackBerry()||k.iOS()||k.Opera()||k.Windows()},getOsName:function(){var t="Unknown OS";k.Android()&&(t="Android");k.BlackBerry()&&(t="BlackBerry");
k.iOS()&&(t="iOS");k.Opera()&&(t="Opera Mini");k.Windows()&&(t="Windows");return t}},h="Unknown OS",m="Unknown OS Version";(l=function(){for(var t=n.appVersion,B=n.userAgent,z="-",D=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",
r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",
r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],A=0,E;E=D[A];A++)if(E.r.test(B)){z=E.s;break}D="-";/Windows/.test(z)&&(/Windows (.*)/.test(z)&&(D=/Windows (.*)/.exec(z)[1]),z="Windows");switch(z){case "Mac OS X":/Mac OS X (10[\._\d]+)/.test(B)&&(D=/Mac OS X (10[\._\d]+)/.exec(B)[1]);break;case "Android":/Android ([\._\d]+)/.test(B)&&
(D=/Android ([\._\d]+)/.exec(B)[1]);break;case "iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(B)&&(D=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))&&3<D.length&&(D=D[1]+"."+D[2]+"."+(D[3]|0))}return{osName:z,osVersion:D}}())&&l.osName&&"-"!=l.osName?(h=l.osName,m=l.osVersion):k.any()&&(h=k.getOsName(),"Android"==h&&(m=c()));l="object"===typeof process&&"object"===typeof process.versions&&process.versions.node;"Unknown OS"===h&&l&&(h="Nodejs",m=process.versions.node.toString().replace("v",""));var r=!1,v=!1;["captureStream",
"mozCaptureStream","webkitCaptureStream"].forEach(function(t){"undefined"!==typeof document&&"function"===typeof document.createElement&&(!r&&t in document.createElement("canvas")&&(r=!0),!v&&t in document.createElement("video")&&(v=!0))});var y=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,u=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,F=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,H=[],C=[],J=[],K=[];n.mediaDevices&&n.mediaDevices.enumerateDevices&&(n.enumerateDevices=function(t){var B=n.mediaDevices.enumerateDevices();
B&&B.then?n.mediaDevices.enumerateDevices().then(t).catch(function(){t([])}):t([])});var L=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?L=!0:n.mediaDevices&&n.mediaDevices.enumerateDevices&&(L=!0);var P=!1,S=!1,R=!1,Q=!1,U=!1,q=window.DetectRTC||{};q.browser=function(){var t=n.userAgent,B=n.appName,z=""+parseFloat(n.appVersion);parseInt(n.appVersion,10);var D,A;if(x){B="Opera";try{z=n.userAgent.split("OPR/")[1].split(" ")[0],z.split(".")}catch(W){z="0.0.0.0"}}else if(g){var E=
t.indexOf("Chrome");B="Chrome";z=t.substring(E+7)}else N?-1!==t.indexOf("CriOS")?(E=t.indexOf("CriOS"),B="Chrome",z=t.substring(E+6)):-1!==t.indexOf("FxiOS")?(E=t.indexOf("FxiOS"),B="Firefox",z=t.substring(E+6)):(E=t.indexOf("Safari"),B="Safari",z=t.substring(E+7),-1!==(E=t.indexOf("Version"))&&(z=t.substring(E+8)),-1!==n.userAgent.indexOf("Version/")&&(z=n.userAgent.split("Version/")[1].split(" ")[0])):G?(E=t.indexOf("Firefox"),B="Firefox",z=t.substring(E+8)):(D=t.lastIndexOf(" ")+1)<(E=t.lastIndexOf("/"))&&
(B=t.substring(D,E),z=t.substring(E+1),B.toLowerCase()===B.toUpperCase()&&(B=n.appName));w&&(B="Edge",z=n.userAgent.split("Edge/")[1]);-1!==(A=z.search(/[; \)]/))&&(z=z.substring(0,A));t=parseInt(""+z,10);isNaN(t)&&(z=""+parseFloat(n.appVersion),t=parseInt(n.appVersion,10));return{fullVersion:z,version:t,name:B,isPrivateBrowsing:!1}}();(function(t){try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){z=!1},function(D){z=!0});else if(window.indexedDB&&
/Firefox/.test(window.navigator.userAgent)){try{var B=window.indexedDB.open("test");B.onerror=function(){return!0}}catch(D){var z=!0}"undefined"===typeof z&&a(function(){return"done"===B.readyState?!0:!1},function(D){D||(z=B.result?!1:!0)})}else if(b(window.navigator.userAgent)){z=!1;try{window.indexedDB||(z=!0)}catch(D){z=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(D){z=!0}"undefined"===typeof z&&(z=!1,window.localStorage.removeItem("test"))}}catch(D){z=
!1}a(function(){return"undefined"!==typeof z?!0:!1},function(D){t(z)})})(function(t){q.browser.isPrivateBrowsing=!!t});q.browser["is"+q.browser.name]=!0;q.osName=h;q.osVersion=m;var Z=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(t){Z||t in window&&(Z=!0)});q.isWebRTCSupported=Z;q.isORTCSupported="undefined"!==typeof RTCIceGatherer;h=!1;q.browser.isChrome&&35<=q.browser.version?h=!0:q.browser.isFirefox&&34<=q.browser.version?h=!0:q.browser.isEdge&&
17<=q.browser.version?h=!0:"Android"===q.osName&&q.browser.isChrome&&(h=!0);if(n.getDisplayMedia||n.mediaDevices&&n.mediaDevices.getDisplayMedia)h=!0;/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(q.browser.isChrome||q.browser.isEdge||q.browser.isOpera)?h=!1:q.browser.isFirefox&&(h=!1));q.isScreenCapturingSupported=h;var aa=!1,ba=!1;["AudioContext",
"webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(t){!aa&&t in window&&(aa=!0,window[t]&&"createMediaStreamSource"in window[t].prototype&&(ba=!0))});q.isAudioContextSupported=aa;q.isCreateMediaStreamSourceSupported=ba;h=!1;q.browser.isChrome&&31<q.browser.version&&(h=!0);q.isRtpDataChannelsSupported=h;h=!1;q.browser.isFirefox&&28<q.browser.version?h=!0:q.browser.isChrome&&25<q.browser.version?h=!0:q.browser.isOpera&&11<=q.browser.version&&(h=!0);q.isSctpDataChannelsSupported=
h;q.isMobileDevice=p;p=!1;n.getUserMedia?p=!0:n.mediaDevices&&n.mediaDevices.getUserMedia&&(p=!0);q.browser.isChrome&&46<=q.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(p="Requires HTTPs");"Nodejs"===q.osName&&(p=!1);q.isGetUserMediaSupported=p;p="";screen.width&&(p+=""+(screen.width?screen.width:"")+" x "+(screen.height?screen.height:
""));q.displayResolution=p;q.displayAspectRatio=function(t,B){function z(A,E){return 0==E?A:z(E,A%E)}var D=z(t,B);return t/D/(B/D)}(screen.width,screen.height).toFixed(2);q.isCanvasSupportsStreamCapturing=r;q.isVideoSupportsStreamCapturing=v;"Chrome"==q.browser.name&&53<=q.browser.version&&(q.isCanvasSupportsStreamCapturing||(q.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),q.isVideoSupportsStreamCapturing||(q.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"));
q.DetectLocalIPAddress=function(t,B){if(q.isWebRTCSupported){var z=!0,D=!0;d(function(A){A?A.match(y)?(z=!1,t("Local: "+A,z,D)):(A.match(F)&&(D=!1),t("Public: "+A,z,D)):t()},B)}};q.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING;q.isWebSocketsBlocked=!q.isWebSocketsSupported;"Nodejs"===q.osName&&(q.isWebSocketsSupported=!0,q.isWebSocketsBlocked=!1);q.checkWebSocketsSupport=function(t){t=t||function(){};try{var B,z=new WebSocket("wss://echo.websocket.org:443/");z.onopen=function(){q.isWebSocketsBlocked=
!1;B=(new Date).getTime();z.send("ping")};z.onmessage=function(){q.WebsocketLatency=(new Date).getTime()-B+"ms";t();z.close();z=null};z.onerror=function(){q.isWebSocketsBlocked=!0;t()}}catch(D){q.isWebSocketsBlocked=!0,t()}};q.load=function(t){e(t||function(){})};"function"===typeof e&&console.log("check device support !");q.MediaDevices="undefined"!==typeof H?H:[];q.hasMicrophone=P;q.hasSpeakers=S;q.hasWebcam=R;q.isWebsiteHasWebcamPermissions=U;q.isWebsiteHasMicrophonePermissions=Q;q.audioInputDevices=
C;q.audioOutputDevices=J;q.videoInputDevices=K;p=!1;"undefined"!==typeof document&&"function"===typeof document.createElement&&"setSinkId"in document.createElement("video")&&(p=!0);q.isSetSinkIdSupported=p;p=!1;q.browser.isFirefox&&"undefined"!==typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(p=!0):q.browser.isChrome&&"undefined"!==typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(p=!0);q.isRTPSenderReplaceTracksSupported=p;p=!1;q.browser.isFirefox&&
38<q.browser.version&&(p=!0);q.isRemoteStreamProcessingSupported=p;p=!1;"undefined"!==typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(p=!0);q.isApplyConstraintsSupported=p;p=!1;q.browser.isFirefox&&43<=q.browser.version&&(p=!0);q.isMultiMonitorScreenCapturingSupported=p;q.isPromisesSupported=!!("Promise"in window);q.version="1.4.1";"undefined"===typeof q&&(window.DetectRTC={});p=window.MediaStream;"undefined"===typeof p&&"undefined"!==typeof webkitMediaStream&&(p=webkitMediaStream);
q.MediaStream="undefined"!==typeof p&&"function"===typeof p?Object.keys(p.prototype):!1;q.MediaStreamTrack="undefined"!==typeof MediaStreamTrack?Object.keys(MediaStreamTrack.prototype):!1;p=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;q.RTCPeerConnection="undefined"!==typeof p?Object.keys(p.prototype):!1;window.DetectRTC=q;"undefined"!==typeof module&&(module.exports=q);"function"===typeof define&&define.amd&&define("DetectRTC",[],function(){return q})})();
var cc=cc||{};
cc.defineGetterSetter=function(a,b,c,d,e,f){if(a.__defineGetter__)c&&a.__defineGetter__(b,c),d&&a.__defineSetter__(b,d);else if(Object.defineProperty){var l={enumerable:!1,configurable:!0};c&&(l.get=c);d&&(l.set=d);Object.defineProperty(a,b,l)}else throw Error("browser does not support getters");if(!e&&!f){l=null!=c;for(var p=void 0!=d,n=Object.getOwnPropertyNames(a),w=0;w<n.length;w++){var x=n[w];if((a.__lookupGetter__?!a.__lookupGetter__(x):!Object.getOwnPropertyDescriptor(a,x))&&"function"===typeof a[x]){var G=
a[x];if(l&&G===c&&(e=x,!p||f))break;if(p&&G===d&&(f=x,!l||e))break}}}a=a.constructor;e&&(a.__getters__||(a.__getters__={}),a.__getters__[e]=b);f&&(a.__setters__||(a.__setters__={}),a.__setters__[f]=b)};cc.clone=function(a){var b=a.constructor?new a.constructor:{},c;for(c in a){var d=a[c];b[c]="object"!==typeof d||!d||d instanceof cc.Node||d instanceof HTMLElement?d:cc.clone(d)}return b};cc.inject=function(a,b){for(var c in a)b[c]=a[c]};
var ClassManager=function(){var a=0|998*Math.random(),b=0|998*Math.random();this.getNewID=function(){return a++};this.getNewInstanceId=function(){return b++}},classManager=new ClassManager;
(function(){var a=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(b){cc.isEmpty(b._html)||cc.import(b._html);cc.isEmpty(b._css)||cc.import(b._css);var c=this.prototype,d=Object.create(c),e={writable:!0,enumerable:!1,configurable:!0};var f=function(m,r,v,y,u){this.__instanceId=classManager.getNewInstanceId();if(this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(m);break;case 2:this.ctor(m,r);break;case 3:this.ctor(m,r,v);break;case 4:this.ctor(m,r,v,y);break;case 5:this.ctor(m,
r,v,y,u);break;default:this.ctor.apply(this,arguments)}};e.value=classManager.getNewID();Object.defineProperty(d,"__pid",e);f.prototype=d;e.value=f;Object.defineProperty(d,"constructor",e);this.__getters__&&(f.__getters__=cc.clone(this.__getters__));this.__setters__&&(f.__setters__=cc.clone(this.__setters__));for(var l=0,p=arguments.length;l<p;++l){var n=arguments[l],w;for(w in n){var x="function"===typeof n[w],G="function"===typeof c[w],N=a.test(n[w]);x&&G&&N?(e.value=function(m,r){return function(){var v=
this._super;this._super=c[m];var y=r.apply(this,arguments);this._super=v;return y}}(w,n[w]),Object.defineProperty(d,w,e)):x?(e.value=n[w],Object.defineProperty(d,w,e)):d[w]=n[w];if(x){if(this.__getters__&&this.__getters__[w]){x=this.__getters__[w];for(var g in this.__setters__)if(this.__setters__[g]===x){var k=g;break}cc.defineGetterSetter(d,x,n[w],n[k]?n[k]:d[k],w,k)}if(this.__setters__&&this.__setters__[w]){x=this.__setters__[w];for(g in this.__getters__)if(this.__getters__[g]===x){var h=g;break}cc.defineGetterSetter(d,
x,n[h]?n[h]:d[h],n[w],h,w)}}}}f.extend=cc.Class.extend;f.implement=function(m){for(var r in m)d[r]=m[r]};return f}})();cc.each=function(a,b,c){if(a)if(a instanceof Array)for(var d=0,e=a.length;d<e&&!1!==b.call(c,a[d],d);d++);else for(d in a)if(!1===b.call(c,a[d],d))break};cc.extend=function(a){var b=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(b,function(c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])});return a};
cc.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};cc.isFunction=function(a){return"function"===typeof a};cc.isNumber=function(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)};cc.isString=function(a){return"string"===typeof a||"[object String]"===Object.prototype.toString.call(a)};cc.isArray=function(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)};
cc.isUndefined=function(a){return"undefined"===typeof a};cc.isObject=function(a){return"object"===typeof a&&"[object Object]"===Object.prototype.toString.call(a)};cc.objToArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};cc.localLog={maxLog:20,isLocalStorage:window.localStorage?!0:!1,push:function(a){},send:function(a,b){}};cc.log=function(a){var b=(new Date).toISOString();a=b.substr(b.length-13,13)+"--"+a;console.log(a)};
cc.isEmpty=function(a){return void 0==a||null==a||""==a.toString()?!0:!1};String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)};cc.Class.prototype.addCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=!1,e=0;e<this.arrEventCb.length;e++)if(this.arrEventCb[e].ev==a&&this.arrEventCb[e].cb==b&&this.arrEventCb[e].caller==c){d=!0;break}d||this.arrEventCb.push({ev:a,cb:b,caller:c})};
cc.Class.prototype.removeCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=0;d<this.arrEventCb.length;d++)if(this.arrEventCb[d].ev==a&&this.arrEventCb[d].cb==b&&c==this.arrEventCb[d].caller){this.arrEventCb.splice(d,1);break}};cc.Class.prototype.CEventCallback=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};
cc.Class.prototype.dispath=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};cc.Class.prototype.removeAllCEventListener=function(a){if(null==a)null!=this.arrEventCb&&(this.arrEventCb=[]);else if(null!=this.arrEventCb&&void 0!=this.arrEventCb){do{var b=!1;for(var c=0;c<this.arrEventCb.length;c++)if(this.arrEventCb[c].ev==a){this.arrEventCb.splice(c,1);b=!0;break}}while(b)}};
cc.os=function(){var a=navigator.userAgent.toLowerCase(),b=/iphone|ipod|ipad/.test(a);return/android/.test(a)?"android":b?"ios":"pc"};cc.isMobile=function(){var a=cc.os();return"android"==a||"ios"==a?!0:!1};cc.isWebview=function(){return"zaloWebview"==cc.browserName||"fbWebview"==cc.browserName||"webview"==cc.browserName?!0:!1};
cc.browserName=function(){var a=navigator.userAgent.toLowerCase();if(0<=a.indexOf("zalo"))return"zaloWebview";if(0<=a.indexOf("FBAV"))return"fbWebview";if(0<=a.indexOf("webview"))return"webview";if(0<=a.indexOf("coccoc"))return"coccoc";var b="undefined"!==typeof InstallTrigger,c=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&window.safari.pushNotification).toString();0<=a.indexOf("safari")&&(c=!0);a=!!window.StyleMedia;
var d=-1!=navigator.userAgent.indexOf("Chrome"),e=d&&-1!=navigator.userAgent.indexOf("Edg");return c?"safari":b?"firefox":a?"edge":d?"chrome":e?"edgeChrome":"other"};cc.touchable=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};cc.webrtcSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof RTCPeerConnection?!0:!1};
cc.mediaRecorderSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.MediaRecorder?!0:!1};cc.workerSupport=function(){return"undefined"!==typeof Worker?!0:!1};
cc.fullscreenSupport=function(){var a=document.body;return"undefined"!==typeof a.requestFullscreen||"undefined"!==typeof a.mozRequestFullScreen||"undefined"!==typeof a.webkitRequestFullscreen||"undefined"!==typeof a.msRequestFullscreen||"undefined"!==typeof document.exitFullscreen||"undefined"!==typeof document.mozCancelFullScreen||"undefined"!==typeof document.webkitExitFullscreen};cc.removeAllChildNodes=function(a){if(a)for(;a.firstChild;)a.removeChild(a.firstChild)};
cc.removeDomAttr=function(a,b){if(cc.isArray(b)&&a&&a instanceof HTMLElement)for(var c=0;c<b.length;c++)a.removeAttribute(b[c])};cc.getAttrToNumber=function(a,b){return Number(a.getAttribute(b))};cc.createGrid=function(a,b){if(0>=a||0>=b)return null;for(var c=document.createElement("div"),d=100/a,e=100/b,f=0;f<a*b;f++){var l=document.createElement("div");l.style.width=e+"%";l.style.height=d+"%";l.style.position="relative";l.style.float="left";l.setAttribute("grid",f);c.appendChild(l)}return c};
cc.dragDom=null;cc.winSize=function(){return{width:window.innerWidth,height:window.innerHeight}};cc.getParameterByName=function(a,b=window.location.href){a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};cc.appVer=.1;
cc.loadCss=function(a){for(var b=0;b<a.length;b++){var c=document.getElementsByTagName("HEAD")[0],d=document.createElement("link");d.rel="stylesheet";d.type="text/css";d.href=a[b]+"?ver="+cc.appVer;c.appendChild(d)}};cc.insertCss=function(a){var b=document.createElement("style");b.type="text/css";b.textContent=a;document.getElementsByTagName("head")[0].appendChild(b)};
cc.getText=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&(200==this.status?b&&b(!0,this.responseText):b(!1,this.status))};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.getJson=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){if(b)try{b(!0,JSON.parse(this.responseText))}catch(d){b(!1,"error parse json result "+this.responseText)}}else b(!1,this.status)};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.loadJs=function(a,b,c){cc.isString(a)&&(a=[a]);if(!cc.isNumber(c)||0>c)c=0;if(a&&cc.isArray(a))if(a.length<=c)b&&b.call(null,!0);else{var d=a[c],e=document.createElement("script");e.onload=()=>{c<a.length&&(c++,cc.loadJs(a,b,c))};e.onerror=()=>{b&&b.call(null,!1)};e.src=d+"?ver="+cc.appVer;e.async=!0;document.body.appendChild(e)}};
cc.loadHtml=function(a,b,c){if(!cc.isNumber(c)||0>c)c=0;a&&cc.isArray(a)&&(a.length<=c?b&&b.call(null,!0):cc.getText(a[c],(d,e)=>{d&&(cc.htmlImport[a[c]]=e);c++;cc.loadHtml(a,b,c)}))};cc.randomStr=function(a){for(var b="",c=0;c<a;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b};cc.jsfw=[];cc.coreready=null;cc.callbackready=null;cc.onready=function(a){null==cc.coreready?cc.callbackready=a:a.call(null,cc.coreready)};
cc.loadJs(cc.jsfw,a=>{cc.coreready=a;cc.callbackready&&cc.callbackready.call(null,cc.coreready)});cc.htmlImport={};cc.cssImport={};cc.getHtml=function(a){return cc.htmlImport[a]?cc.htmlImport[a]:""};cc.import=function(a){0<a.indexOf(".css")&&(cc.cssImport[a]||(cc.cssImport[a]=a));0<a.indexOf(".html")&&(cc.htmlImport[a]||(cc.htmlImport[a]=a))};cc.initApp=function(a,b){cc.loadJs(a,c=>{cc.loadCss(cc.objToArray(cc.cssImport));cc.loadHtml(cc.objToArray(cc.htmlImport),()=>{b&&b()})})};
cc.randomUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"==b?c:c&3|8).toString(16)})};cc.md5=function(a){return M(V(Y(X(a),8*a.length))).toLowerCase()};function M(a){for(var b,c="",d=0;d<a.length;d++)b=a.charCodeAt(d),c+="0123456789ABCDEF".charAt(b>>>4&15)+"0123456789ABCDEF".charAt(15&b);return c}
function X(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function V(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}
function Y(a,b){a[b>>5]|=128<<b%32;a[14+(b+64>>>9<<4)]=b;b=1732584193;for(var c=-271733879,d=-1732584194,e=271733878,f=0;f<a.length;f+=16){var l=b,p=c,n=d,w=e;c=md5_ii(c=md5_ii(c=md5_ii(c=md5_ii(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_ff(c=md5_ff(c=md5_ff(c=md5_ff(c,d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+0],7,-680876936),c,d,a[f+1],12,-389564586),b,c,a[f+2],17,606105819),e,b,a[f+3],22,-1044525330),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+4],7,-176418897),
c,d,a[f+5],12,1200080426),b,c,a[f+6],17,-1473231341),e,b,a[f+7],22,-45705983),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+8],7,1770035416),c,d,a[f+9],12,-1958414417),b,c,a[f+10],17,-42063),e,b,a[f+11],22,-1990404162),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+12],7,1804603682),c,d,a[f+13],12,-40341101),b,c,a[f+14],17,-1502002290),e,b,a[f+15],22,1236535329),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+1],5,-165796510),c,d,a[f+6],9,-1069501632),b,c,a[f+11],14,643717713),e,b,a[f+0],20,-373897302),d=md5_gg(d,
e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+5],5,-701558691),c,d,a[f+10],9,38016083),b,c,a[f+15],14,-660478335),e,b,a[f+4],20,-405537848),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+9],5,568446438),c,d,a[f+14],9,-1019803690),b,c,a[f+3],14,-187363961),e,b,a[f+8],20,1163531501),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+13],5,-1444681467),c,d,a[f+2],9,-51403784),b,c,a[f+7],14,1735328473),e,b,a[f+12],20,-1926607734),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+5],4,-378558),c,d,a[f+8],11,-2022574463),b,c,a[f+11],16,
1839030562),e,b,a[f+14],23,-35309556),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+1],4,-1530992060),c,d,a[f+4],11,1272893353),b,c,a[f+7],16,-155497632),e,b,a[f+10],23,-1094730640),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+13],4,681279174),c,d,a[f+0],11,-358537222),b,c,a[f+3],16,-722521979),e,b,a[f+6],23,76029189),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+9],4,-640364487),c,d,a[f+12],11,-421815835),b,c,a[f+15],16,530742520),e,b,a[f+2],23,-995338651),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+0],6,
-198630844),c,d,a[f+7],10,1126891415),b,c,a[f+14],15,-1416354905),e,b,a[f+5],21,-57434055),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+12],6,1700485571),c,d,a[f+3],10,-1894986606),b,c,a[f+10],15,-1051523),e,b,a[f+1],21,-2054922799),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+8],6,1873313359),c,d,a[f+15],10,-30611744),b,c,a[f+6],15,-1560198380),e,b,a[f+13],21,1309151649),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+4],6,-145523070),c,d,a[f+11],10,-1120210379),b,c,a[f+2],15,718787259),e,b,a[f+9],21,-343485551);
b=safe_add(b,l);c=safe_add(c,p);d=safe_add(d,n);e=safe_add(e,w)}return[b,c,d,e]}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,l){return md5_cmn(b&c|~b&d,a,b,e,f,l)}function md5_gg(a,b,c,d,e,f,l){return md5_cmn(b&d|c&~d,a,b,e,f,l)}function md5_hh(a,b,c,d,e,f,l){return md5_cmn(b^c^d,a,b,e,f,l)}function md5_ii(a,b,c,d,e,f,l){return md5_cmn(c^(b|~d),a,b,e,f,l)}
function safe_add(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}cc.keywordNotStyle=["element","_childStyle","state"];
cc.Node=cc.Class.extend({_name:"",_lcid:0,_countChild:0,_render:null,_children:null,_parent:null,_style:null,_nodeType:"Node",ctor:function(a){this._initRender(a);a&&this.css(a)},_initRender:function(a){null==a&&(a={});cc.isEmpty(a.element)&&(a.element=cc.getHtml(this._html));if(!cc.isEmpty(a.element)){if(cc.isString(a.element))try{var b=document.createElement("div");b.textContent=a.element.trim();var c=b.firstChild;if(c&&1==c.nodeType){this._render=c;this._render.setAttribute("_nt",this.getType());
return}}catch(d){cc.log("error create element from  html :"+a.element+":"+this._idLocal+":"+this.getType())}if(a.element instanceof HTMLElement){this._render=a.element;this._render.setAttribute("_nt",this.getType());return}}this._render=document.createElement("div");this._render.setAttribute("_nt",this.getType())},appendTo:function(a){a instanceof HTMLElement&&a.appendChild(this._render)},addChild:function(a){a._nodeType&&this._render&&a._render instanceof HTMLElement&&(this._render.appendChild(a._render),
this._children=this._children||{},a._lcid=this._countChild++,this._children[a._lcid]=a,a._parent=this)},removeChild:function(a,b){a._parent&&a._parent._render&&a._parent._render.removeChild(a._render);delete this._children[a._idNode];b&&a.release&&a.release()},removeAllChild:function(){for(var a in this._children)this.removeChild(this._children[a])},children:function(){var a=[],b;for(b in this._children)a.push(this._children);return a},getParent:function(){return this._parent},getRender:function(){return this._render},
getChildrenByName:function(a){if(cc.isEmpty(a))return null;for(var b in this._children)if(this._children[b].name==a)return this._children[b]},getChildByLcId:function(a){return!cc.isNumber(a)||0>Number(a)?null:this._children[a]?this._children[a]:null},toObject:function(){},fromObject:function(a){this._countChild=a.countChild?a.countChild:this._countChild},getType:function(){return this._nodeType},_release:function(){this.removeAllChild();this._render=null;this.removeAllCEventListener()},cssChild:function(a){if(this._render)for(var b in a){var c=
this._render.getChildrenByName(b);if(c)for(var d=0;d<c.length;d++)this.cssDom(c[d],a[b])}},css:function(a,b){if(!this._render||!this._render.style)return!1;this._style=this._style||{};var c=!0;if(cc.isString(a)){if(!b)return this._render.style[a];0>cc.keywordNotStyle.indexOf(a)&&(a=this._replaceCssProperties(a),this._render.style[a]=b,this._render.style[a]==b?this._style[a]=b:c=!1)}else{a=this._replaceCssProperties(a);for(var d in a)0>cc.keywordNotStyle.indexOf(d)?(this._render.style[d]=a[d],this._render.style[d]==
a[d]?this._style[d]=a[d]:c=!1):"_childStyle"==d&&this.cssChild(a[d])}""!=this._render.style.display&&"none"!=this._render.style.display&&(this._render.style.cdisplay=this._render.style.display);if(this._style.scaleX||this._style.scaleY||this._style.rotation)a="",this._style.rotation&&(a+="rotate("+this._style.rotation+"deg) "),this._style.scaleX&&(a+="scaleX("+this._style.scaleX+") "),this._style.scaleY&&(a+="scaleY("+this._style.scaleY+") "),this._render.style.transform=a;return c},cssDom:function(a,
b,c){if(cc.isString(b))b=this._replaceCssProperties(b),a.style[b]=c;else{b=this._replaceCssProperties(b);for(var d in b)a.style[d]=b[d]}},_replaceCssProperties:function(a){cc.isObject(a)&&(void 0!=a.x&&(a.left=a.x),void 0!=a.y&&(a.top=a.y),void 0!=a.rotate&&(a.rotation=a.rotate),delete a.x,delete a.y);if(cc.isString(a)){if("x"==a)return"left";if("y"==a)return"top";if("rotate"==a)return"ratation"}return a},_renderStyle:function(){return this._render&&this._render.style?this._render.style:null},setWidth:function(a){return this._renderStyle()?
cc.isString(a)?this.css("width",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("width",a+"px"):!1},getWidth:function(){return this._renderStyle()?parseInt(this._render.style.width):0},setHeight:function(a){return this._renderStyle()?cc.isString(a)?this.css("height",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("height",a+"px"):!1},getHeight:function(){return this._renderStyle()?parseInt(this._render.style.height):0},setX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("left",a+"px"):!1},
getX:function(){return this._renderStyle()?parseInt(this._render.style.left):0},setY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("top",a+"px"):!1},getY:function(){return this._renderStyle()?parseInt(this._render.style.top):0},getClientBoudingBox:function(){return this._render&&this._render.getClientBoudingBox?this._render.getClientBoudingBox():null},setVisible:function(a){this._renderStyle()&&(this._render.style.display=a?cc.isUndefined(this._render.style.cdisplay)?"":this._render.style.cdisplay:
"none")},getVisible:function(){return this._renderStyle()?"none"==this._render.style.display?!0:!1:!1},setColor:function(a){return this._renderStyle()?this.css("color",a):!1},getColor:function(){return this._renderStyle()?this._render.style.color.toString():""},setOpacity:function(a){return this._renderStyle()?this.css("opacity",a):!1},getOpacity:function(){return this._renderStyle()&&cc.isNumber(this._render.style.opacity)?this._render.style.opacity:1},setRotate:function(a){return!this._renderStyle()||
!cc.isNumber(a)||0>Number(a)?!1:this.css("rotation",a)},getRotate:function(){return this._renderStyle()&&this._style.rotation?this._style.rotation:0},setScaleX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleX",a):!1},getScaleX:function(){return this._renderStyle()&&this._style.scaleX?this._style.scaleX:1},setScaleY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleY",a):!1},getScaleY:function(){return this._renderStyle()&&this._style.scaleY?this._style.scaleY:
1},setScale:function(a,b){this.setScaleX(a);this.setScaleY(b)},setButtonMode:function(a){if(!this._renderStyle())return!1;a?this.css("cursor","pointer"):this.css("cursor","default")},anim:function(a,b,c,d){cc.isObject(a)||cc.isArray(a)?this.animFromTo(null,a,b,c,d):cc.isString(a)&&this._render&&(a=cc.animePattern.getFromTo(a,this))&&(b&&(a.to.duration=b),this.animFromTo(a.from,a.to,b,c,d))},animFromTo:function(a,b,c,d,e){if(this._render&&b&&(cc.isArray(b)||cc.isObject(b))){d&&"true"==d.toString().trim()||
(d=!1);null==e&&(e="normal");try{this.stopAnim();this.timeline=anime.timeline({targets:this._render,loop:d,duration:Number(c),direction:e});a&&cc.isObject(a)&&(a=this._replaceCssProperties(a),this.timeline._from=a,this.css(a));if(cc.isArray(b))for(a=0;a<b.length;a++)b[a]=this._replaceCssProperties(b[a]),this.timeline.add(b[a]);else cc.isObject(b)&&(b=this._replaceCssProperties(b),this.timeline.add(b));this.timeline._animto=b}catch(f){cc.log("runAnim error "+f.message)}}},stopAnimToEnd:function(){this.timeline&&
this.timeline.pause();anime.remove(this._render);for(var a=0;a<this.timeline._animto.length;a++){var b=this.timeline._animto[a];delete b.targets;delete b.easing;delete b.duration;delete b.delay;delete b.endDelay;delete b.round;this.css(b)}delete this.timeline._from;delete this.timeline._timelines},stopAnim:function(){this.timeline&&(this.timeline.pause(),anime.remove(this._render),delete this.timeline._from,delete this.timeline._timelines)},addTouchStart:function(a){this.addDomTouchStart(this._render,
a)},removeTouchStart:function(){this.removeDomTouchStart(this._render)},addDomTouchStart:function(a,b){a.touchStartEnabled=!0;a.addEventListener("mousedown",c=>{this._onDomDown(c,b)});a.addEventListener("touchstart",c=>{this._onDomDown(c,b);c.preventDefault()})},_onDomDown:function(a,b){if(a.currentTarget.touchStartEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));
a.setAttribute("start_time",c.time);a.setAttribute("start_pageX",c.pageX);a.setAttribute("start_pageY",c.pageY);a.setAttribute("start_clientX",c.clientX);a.setAttribute("start_clientY",c.clientY);_windowUp();a.dragEnabled&&(cc.dragDom=a,a.setAttribute("start_left",parseInt(a.style.left)),a.setAttribute("start_top",parseInt(a.style.top)),window.addEventListener("mousemove",_windowMove),window.addEventListener("touchmove",_windowMove),window.addEventListener("mouseup",_windowUp),window.addEventListener("touchend",
_windowUp));b&&b(c)}},removeDomTouchStart:function(a){a.dragEnabled||(a.touchStartEnabled=!1)},addTouchMove:function(a){this.addDomTouchMove(this._render,a)},removeTouchMove:function(){this.removeDomTouchMove(this._render)},addDomTouchMove:function(a,b){a.touchMoveEnabled=!0;a.addEventListener("mousemove",c=>{this._onDomMove(c,b)});a.addEventListener("touchmove",c=>{this._onDomMove(c,b);c.preventDefault()})},_onDomMove:function(a,b){if(a.currentTarget.touchMoveEnabled){var c=a.touches&&0<a.touches.length?
a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("move_time",c.time);a.setAttribute("move_pageX",c.pageX);a.setAttribute("move_pageY",c.pageY);a.setAttribute("move_clientX",c.clientX);a.setAttribute("move_clientY",c.clientY);b&&b(c)}},removeDomTouchMove:function(a){a.touchMoveEnabled=!1},addTouchOut:function(a){this.addDomTouchOut(this._render,a)},removeTouchOut:function(){this.removeDomTouchOut(this._render)},addDomTouchOut:function(a,b){a.touchOutEnabled=
!0;a.addEventListener("mouseout",c=>{this._onDomOut(c,b)})},_onDomOut:function(a,b){if(a.target.touchOutEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();b&&b(c)}},removeDomTouchOut:function(a){a.touchOutEnabled=!1},addTouchEnd:function(a){this.addDomTouchEnd(this._render,a)},removeTouchEnd:function(){this.removeDomTouchEnd(this._render)},addDomTouchEnd:function(a,b){a.touchEndEnabled=!0;a.addEventListener("mouseup",
c=>{this._onDomEnd(c,b)});a.addEventListener("touchend",c=>{this._onDomEnd(c,b);c.preventDefault()})},_onDomEnd:function(a,b){if(a.currentTarget.touchEndEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("end_time",c.time);b&&b(c);this._onDomTap(a);cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));cc.removeDomAttr(a,["start_time","start_pageX","start_pageY",
"start_clientX","start_clientY"])}},removeDomTouchEnd:function(a){a.touchEndEnabled=!1},addTouch:function(a){this.addTouchTap(a)},removeTouch:function(){this.removeTouchTap()},addDomTouch:function(a,b){this.addDomTouchTap(a,b)},addTouchTap:function(a){this.addDomTouchTap(this._render,a)},removeTouchTap:function(){this.removeDomTouchTap(this._render)},addDomTouchTap:function(a,b){a.touchStartEnabled||this.addDomTouchStart(a);a.touchEndEnabled||this.addDomTouchEnd(a);a.touchTapEnabled=!0;a.callbacksTap=
a.callbacksTap||[];b&&a.callbacksTap.push(b)},_onDomTap:function(a){a.getAttribute("move_pageX")||a.setAttribute("move_pageX",a.getAttribute("start_pageX"));a.getAttribute("move_pageY")||a.setAttribute("move_pageY",a.getAttribute("start_pageY"));if(150>cc.getAttrToNumber(a,"end_time")-cc.getAttrToNumber(a,"start_time")&&10>Math.abs(cc.getAttrToNumber(a,"start_pageX")-cc.getAttrToNumber(a,"move_pageX"))&&10>Math.abs(cc.getAttrToNumber(a,"start_pageY")-cc.getAttrToNumber(a,"move_pageY"))){if(a.getAttribute("tap_time")&&
200>(new Date).getTime()-cc.getAttrToNumber(a,"tap_time")){if(a.callbacksDoubleTap)for(var b=0;b<a.callbacksDoubleTap.length;b++)a.callbacksDoubleTap[b].call(null,{target:a==this._render?this._render:a})}else if(a.callbacksTap)for(b=0;b<a.callbacksTap.length;b++)a.callbacksTap[b].call(null,{target:a==this._render?this._render:a});a.setAttribute("tap_time",(new Date).getTime())}},removeDomTouchTap:function(a){a.callbacksTap&&(a.touchTapEnabled=!1,a.callbacksTap=null,delete a.callbacksTap)},addTouchDouble:function(a){this.addDomTouchDoubleTap(this._render,
a)},addTouchDoubleTap:function(a){this.addDomTouchDoubleTap(this._render,a)},removeTouchDoubleTap:function(){this.removeDomTouchDoubleTap(this._render)},addDomTouchDoubleTap:function(a,b){a.touchTapEnabled||this.addDomTouchTap(a);a.touchDoubleTapEnable=!0;a.callbacksDoubleTap=a.callbacksDoubleTap||[];b&&a.callbacksDoubleTap.push(b)},removeDomTouchDoubleTap:function(a){a.callbacksDoubleTap&&(a.touchDoubleTapEnable=!1,a.callbacksDoubleTap=null,delete a.callbacksDoubleTap)},_dragEnabled:!1,setDragEnabled:function(a){this._render&&
(this.setDragEnabledDom(this._render,a),this._dragEnabled=a)},getDragEnabled:function(){return this._dragEnabled},setDragEnabledDom:function(a,b){b&&!a.touchStartEnabled&&this.addDomTouchStart(a);a.dragEnabled=!!b},findDom:function(a){var b=null;if(!a)return null;a instanceof HTMLElement?b=a:cc.isString(a)&&(b=this._render.querySelector(a));b._ccinit||(b._ccinit=!0,b.css=(c,d)=>{if(cc.isString(c))b.style[c]=d;else if(cc.isObject(c))for(var e in c)b.style[e]=c[e]},b.getBoxGrid=c=>this.findDom(b.querySelector("[grid='"+
c+"']")),b.addTouch=c=>{this.addDomTouchTap(b,c)},b.removeTouch=()=>{this.removeDomTouchTap(b)},b.addTouchStart=c=>{this.addDomTouchStart(b,c)},b.removeTouchStart=()=>{this.removeDomTouchStart(b)},b.addTouchMove=c=>{this.addDomTouchMove(b,c)},b.removeTouchMove=()=>{this.removeDomTouchMove(b)},b.addTouchOut=c=>{this.addDomTouchOut(b,c)},b.removeTouchOut=()=>{this.removeDomTouchOut(b)},b.addTouchEnd=c=>{this.addDomTouchEnd(b,c)},b.removeTouchEnd=()=>{this.removeDomTouchEnd(b)},b.addTouchDouble=c=>{this.addDomTouchDoubleTap(b,
c)},b.removeTouchDouble=()=>{this.removeDomTouchDoubleTap(b)});return b},findAllDom:function(a){}});cc.Node.fromObject=function(a){return cc.Node().fromObject(a)};var _p=cc.Node.prototype;cc.defineGetterSetter(_p,"parent",_p.getParent,_p.getParent);cc.defineGetterSetter(_p,"render",_p.getRender,_p.getRender);cc.defineGetterSetter(_p,"width",_p.getWidth,_p.setWidth);cc.defineGetterSetter(_p,"height",_p.getHeight,_p.setHeight);cc.defineGetterSetter(_p,"x",_p.getX,_p.setX);
cc.defineGetterSetter(_p,"left",_p.getX,_p.setX);cc.defineGetterSetter(_p,"y",_p.getY,_p.setY);cc.defineGetterSetter(_p,"top",_p.getY,_p.setY);cc.defineGetterSetter(_p,"visible",_p.getVisible,_p.setVisible);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"scale",_p.getScale,_p.getScale);cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX);cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY);
cc.defineGetterSetter(_p,"rotate",_p.getRotate,_p.setRotate);cc.defineGetterSetter(_p,"buttonMode",_p.setButtonMode,_p.setButtonMode);cc.defineGetterSetter(_p,"anchorX",_p.getAnchorX,_p.setAnchorX);cc.defineGetterSetter(_p,"anchorY",_p.getAnchorY,_p.setAnchorY);cc.defineGetterSetter(_p,"touchEnabled",_p.getTouchEnabled,_p.setTouchEnabled);cc.defineGetterSetter(_p,"dragEnabled",_p.getDragEnabled,_p.setDragEnabled);
function _windowMove(a){var b=a.touches&&0<a.touches.length?a.touches[0]:a;a=cc.dragDom;var c=b.pageX-cc.getAttrToNumber(a,"start_pageX");b=b.pageY-cc.getAttrToNumber(a,"start_pageY");a==this._render?(this.x=c+cc.getAttrToNumber(a,"start_left"),this.y=b+cc.getAttrToNumber(a,"start_top")):(a.style.left=c+cc.getAttrToNumber(a,"start_left")+"px",a.style.top=b+cc.getAttrToNumber(a,"start_top")+"px")}
function _windowUp(a){window.removeEventListener("mousemove",_windowMove);window.removeEventListener("touchmove",_windowMove);window.removeEventListener("mouseup",_windowUp);window.removeEventListener("touchend",_windowUp);cc.dragDom&&cc.dragDom.removeAttribute("start_left");cc.dragDom&&cc.dragDom.removeAttribute("start_top");cc.dragDom&&cc.removeDomAttr(cc.dragDom,["start_time","start_pageX","start_pageY","start_clientX","start_clientY"]);cc.dragDom=null};var aztExam=aztExam||{};
aztExam.RTCConnection=cc.Class.extend({conn:null,candidate:null,callback:null,isUsed:!1,remoteUserId:"",localUserId:"",type:"offer",monitor:null,offerTimestamp:-1,timeIntv:6E3,timeAnswerIntv:4E3,timeIntvCount:0,blacklistTimestamp:null,lasttimestamp:-1,isWaitingUploadOffer:!1,isWaitingUploadAnswer:!1,offer:null,answer:null,offerReceive:null,isUsefirestore:!1,isDataChannelOpen:!1,urlOffer:null,urlAnswer:null,mykey:"",localStream:null,remoteStream:null,firebaseApp:null,autoReconnect:!0,state:"",timeOfferValid:-1,
ctor:function(a){this.blacklistTimestamp=[];this.monitor=a;this.initUI()},initUI:function(){this.ui=document.createElement("div");this.ui.style.transformOrigin="0% 0%";this.ui.style.overflow="hidden";this.uivideo=document.createElement("div");this.uivideo.style.width="100%";this.uivideo.style.height="100%";this.uivideo.style.display="flex";this.uivideo.style.flexDirection="row";this.uivideo.style.alignItems="center";this.uivideo.style.justifyContent="center";this.ui.appendChild(this.uivideo);this.txtConnecting=
document.createElement("div");this.txtConnecting.style.backgroundColor="#333333";this.txtConnecting.style.width="100%";this.txtConnecting.style.borderRadius="8px";this.txtConnecting.style.color="#EEEEEE";this.txtConnecting.style.fontSize="16px";this.txtConnecting.textContent="\u0110ang k\u1ebft n\u1ed1i ...";this.txtConnecting.style.position="absolute";this.txtConnecting.style.textAlign="center";this.txtConnecting.style.lineHeight="40px";this.txtConnecting.style.height="40px";this.ui.appendChild(this.txtConnecting)},
showLoading:function(){this.txtConnecting.style.display="block";clearInterval(this.itvPerConnection)},hideLoading:function(){this.txtConnecting.style.display="none";clearInterval(this.itvPerConnection)},resizeUI:function(a,b){this.ui.style.width=a+"px";this.ui.style.height=b+"px";this.txtConnecting.style.width=a+"px";this.txtConnecting.style.top=(b-45)/2+"px"},startIntv:async function(){cc.log("start intv");this.isStarted=!0;this.showLoading();if("offer"==this.type){var a=(new Date).getTime();this.offer=
await this.createOffer();this.offer.timestamp=a;this.offer.conn=a;this.offer.userid=this.localUserId;this.isWaitingUploadOffer=!0}else clearInterval(this.ofIntv),this.ofIntv=setInterval(()=>{this.getOfferIntv()},this.timeIntv),this.getOfferIntv()},getAnswerIntv:function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(atob(CryptoJS.AES.decrypt(a.responseText,this.mykey).toString(CryptoJS.enc.Utf8)));b.timestamp==this.offerTimestamp&&(clearInterval(this.anIntv),
this.receiveAnswer(b))}catch(c){cc.log("get answer error")}};a.open("GET",this.urlAnswer.download+"?t="+(new Date).getTime());a.send()},getOfferIntv:async function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(atob(CryptoJS.AES.decrypt(a.responseText,this.mykey).toString(CryptoJS.enc.Utf8)));b&&this.receiveOffer(b)}catch(c){cc.log("get offer error")}};a.open("GET",this.urlOffer.download+"?t="+(new Date).getTime());a.send()},start:function(a,
b,c,d,e,f,l,p,n){cc.log("start connection :"+l+":"+p);this.isUsed||!a||!b&&"offer"!=c||(this.reset(),this.localUser=a,this.remoteUser=b,this.localUserId=a.userid,this.localStudentId=a.studentid,null!=b&&(this.remoteUserId=b.userid,this.remoteStudentId=b.studentid),this.type=c,d&&(this.urlOffer=d),e&&(this.urlAnswer=e),f&&(this.stream=f),l&&(this.isIntvAnswer=l),p&&(this.timeOfferValid=p),cc.isEmpty(n)||(this.mykey=n),this.timeUsed=(new Date).getTime(),this.txtConnecting.textContent="\u0110ang k\u1ebft n\u1ed1i ...",
this.isUsed=!0,this.initConn(),this.startIntv())},stop:function(){this.reset()},initConn:function(){cc.log("init connection ");this.conn=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]});this.conn.addEventListener("icecandidate",a=>this.onIceCandidate(a));this.conn.addEventListener("iceconnectionstatechange",a=>this.onIceStateChange(a));this.conn.addEventListener("datachannel",
a=>{this.dataChannel=a.channel;this.addListenerDataChannel()});"offer"==this.type&&(this.dataChannel=this.conn.createDataChannel("aztExam",{}),this.addListenerDataChannel());this.stream&&this.addStream(this.stream);this.conn.ontrack=a=>{this.gotRemoteStream(a)}},addListenerDataChannel:function(){this.dataChannel.onerror=a=>{console.log("Data Channel Error:",a)};this.dataChannel.onmessage=a=>{console.log("Got Data Channel Message:",a.data);this.ondatamessage(a.data)};this.dataChannel.onopen=()=>{cc.log("ondata open");
this.isDataChannelOpen=!0;this.CEventCallback("datachannelopen")};this.dataChannel.onclose=()=>{console.log("The Data Channel is Closed")}},ondatamessage:function(a){try{var b=JSON.parse(a.toString());"changeStream"==b.cmd&&this.monitor.changeStream(b.stream);this.CEventCallback("onmessages",b)}catch(c){cc.log("exception ondatamessage")}},requestStream:function(a){this.sendMessages({cmd:"changeStream",stream:a})},sendMessages:function(a){this.dataChannel&&this.isDataChannelOpen&&this.dataChannel.send(JSON.stringify(a))},
createOffer:async function(){if(this.conn){try{const a=await this.conn.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});this.conn.setLocalDescription(a);return{candidate:this.candidate,offer:a}}catch(a){console.log("create offer error "+a)}return null}},receiveOffer:async function(a){if(null!=this.conn)try{if(!(0<=this.blacklistTimestamp.indexOf(a.timestamp)||this.timeOfferValid>a.timestamp)){cc.log("receiveOffer "+a.timestamp);this.blacklistTimestamp.push(a.timestamp);clearInterval(this.ofIntv);
this.offerReceive=a;this.conn.setRemoteDescription(this.offerReceive.offer);var b=await this.conn.createAnswer();this.conn.setLocalDescription(b);this.answer={candidate:this.candidate,answer:b,timestamp:a.timestamp};this.isWaitingUploadAnswer=!0}}catch(c){cc.log("receiveOffer error "+c)}},receiveAnswer:function(a){if(null!=this.conn){"offer"==this.type&&(this.answer=a);clearInterval(this.anIntv);cc.log("setAnswerObj ");cc.log(JSON.stringify(a));this.conn.setRemoteDescription(a.answer);for(var b=0;b<
a.candidate.length;b++)this.conn.addIceCandidate(a.candidate[b])}},addStream:function(a){"offer"==this.type&&(0<a.getVideoTracks().length&&(this.videoTrack=a.getVideoTracks()[0],this.videoSender=this.conn.addTrack(this.videoTrack,a)),0<a.getAudioTracks().length&&(this.audioTrack=a.getAudioTracks()[0],this.audioSender=this.conn.addTrack(this.audioTrack,a)))},replaceVideoTrack:function(a,b){a!=this.currStream&&0!=a.getVideoTracks().length&&(this.currStream=a,this.videoSender?(a=a.getVideoTracks()[0],
this.videoSender.replaceTrack(a)):(this.videoTrack=a.getVideoTracks()[0],this.videoSender=this.conn.addTrack(this.videoTrack,a)),this.sendMessages({cmd:"replaceTrack",name:b}))},gotRemoteStream:function(a){cc.log("gotRemoteStream "+a.streams.length);if(0<a.streams.length){cc.removeAllChildNodes(this.uivideo);for(var b=0;b<a.streams.length;b++){var c=document.createElement("video");this.uivideo.appendChild(c);c.playsInline=!0;c.muted=!0;c.srcObject=a.streams[b];this.remoteStream=a.streams[b];c.vW=
parseInt(this.ui.style.width);c.vH=parseInt(this.ui.style.height);c.onplay=()=>{};c.onresize=()=>{80<c.videoWidth&&60<c.videoHeight&&(this.hideLoading(),console.log("video size "+c.videoWidth+":"+c.videoHeight),this.CEventCallback("videoresize"),c.videoWidth/c.videoHeight<c.vW/c.vH?(c.style.width="",c.style.height="100%"):(c.style.width="100%",c.style.height=""))};c.play();this.videoEl=c}}},updateBandwidthRestriction:function(a,b){return a=-1===a.indexOf("b=AS:")?a.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb=AS:"+
b+"\r\n"):a.replace(RegExp("b=AS:.*\r\n"),"b=AS:"+b+"\r\n")},onIceCandidate:function(a){try{a&&a.candidate?(cc.log("onIceCandicate "+JSON.stringify(a.candidate)),this.candidate.push(a.candidate),clearInterval(this.iceIntv),this.iceIntv=setInterval(()=>{clearInterval(this.iceIntv);this.onIceCandidateFinish()},3E3)):(cc.log("on ice null finish get candicate first time"),this.onIceCandidateFinish())}catch(b){cc.log("onIceCandidate exception "+b.message)}},onIceCandidateFinish:function(){if(this.isWaitingUploadOffer&&
this.offer){this.isWaitingUploadOffer=!1;this.offer.candidate=this.candidate;var a=btoa(JSON.stringify(this.offer));a=CryptoJS.AES.encrypt(a,this.mykey).toString();this.monitor.uploadPublicContent(this.urlOffer.upload,this.localUserId+"_"+this.localStudentId+"_offer.txt",a,(b,c)=>{200==b?this.offer&&(this.offerTimestamp=this.offer.timestamp,cc.log("upload offer ok"),this.CEventCallback("uploadOffer"),this.isIntvAnswer&&(this.getAnswerIntv(),clearInterval(this.anIntv),this.anIntv=setInterval(()=>{this.getAnswerIntv()},
this.timeAnswerIntv))):this.monitor.showToolTip("Kh\u00f4ng upload d\u1eef li\u1ec7u l\u00ean h\u1ec7 th\u1ed1ng , vui l\u00f2ng li\u00ean h\u1ec7 v\u1edbi admin \u0111\u1ec3 \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 ! ",-1)})}if(this.isWaitingUploadAnswer&&this.answer)for(this.isWaitingUploadAnswer=!1,this.answer.candidate=this.candidate,a=btoa(JSON.stringify(this.answer)),a=CryptoJS.AES.encrypt(a,this.mykey).toString(),""!=this.urlAnswer.upload&&this.monitor.uploadPublicContent(this.urlAnswer.upload,
this.remoteUserId+"_"+this.remoteStudentId+"_answer.txt",a,(b,c)=>{200==b&&(cc.log("write answer ok"),this.CEventCallback("uploadAnswer"))}),a=0;a<this.offerReceive.candidate.length;a++)this.conn.addIceCandidate(this.offerReceive.candidate[a])},onIceStateChange:function(a){a=this.conn.iceConnectionState.toString();cc.log("onIceStateChange state "+a);this.state=a;if("failed"==a||"disconnected"==a||"closed"==a)"offer"==this.type?this.autoReconnect&&(this.isUsed=!1,this.start(this.localUser,this.remoteUser,
this.type,this.urlOffer,this.urlAnswer,this.stream,this.isIntvAnswer)):this.txtConnecting.textContent="M\u1ea5t k\u1ebft n\u1ed1i !",this.showLoading();"connected"==a&&this.hideLoading();this.CEventCallback("stateChange")},stateConnection:function(){return"failed"==this.state||"disconnected"==this.state||"closed"==this.state?"close":"connected"==this.state?"connected":""==this.state?"notstart":"connecting"},reset:function(){null!=this.conn&&(this.conn.close(),this.conn=null);this.remoteStream&&(this.remoteStream.getTracks().forEach(a=>
{a.stop()}),this.remoteStream=null);this.state="";this.audioSender=this.videoSender=this.audioTrack=this.videoTrack=null;this.isStarted=this.isUsed=!1;this.localStudentId=this.remoteStudentId=this.localUserId=this.remoteUserId="";this.urlAnswer=this.urlOffer=this.remoteStream=this.currStream=this.stream=this.remoteUser=this.localUser=null;this.type="";this.offerTimestamp=-1;this.isWaitingUploadOffer=this.isWaitingUploadAnswer=!1;this.answer=this.offerReceive=this.offer=null;this.candidate=[];this.timeUsed=
-1;this.dataChannel=this.videoEl=this.firebaseApp=null;this.isDataChannelOpen=!1;this.mykey="";clearInterval(this.anIntv);clearInterval(this.ofIntv);cc.removeAllChildNodes(this.uivideo);this.CEventCallback("stateChange")}});aztExam=aztExam||{};aztExam.icon={};
aztExam.svg={iconCheck:'<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 24px; height: 24px;"><g class="style-scope iron-icon"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" class="style-scope iron-icon"></path></g></svg>',iconWarning:'<?xml version="1.0" ?><svg  viewBox="0 0 64 64" style="pointer-events: none; display: block; width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#efcc00;}.cls-2{fill:#353535;}</style></defs><title/><path class="cls-1" d="M30.16,11.51,6.84,51.9a2.13,2.13,0,0,0,1.84,3.19H55.32a2.13,2.13,0,0,0,1.84-3.19L33.84,11.51A2.13,2.13,0,0,0,30.16,11.51Z"/><path class="cls-2" d="M29,46a3,3,0,1,1,3,3A2.88,2.88,0,0,1,29,46Zm1.09-4.66-.76-15h5.26l-.73,15Z"/></svg>',iconCameraOff:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M22.5,20.9l5,3C27.6,24,27.8,24,28,24c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9c0-0.4-0.2-0.7-0.5-0.9   c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8C22,20.4,22.2,20.7,22.5,20.9z"/><path d="M29.7,28.3L20,18.6V11c0-1.7-1.3-3-3-3H9.4L3.7,2.3c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l26,26c0.2,0.2,0.5,0.3,0.7,0.3   s0.5-0.1,0.7-0.3C30.1,29.3,30.1,28.7,29.7,28.3z"/><path d="M3,11v10c0,1.7,1.3,3,3,3h11c0.8,0,1.5-0.3,2-0.8L4.3,8.5C3.5,9.1,3,10,3,11z"/></g></svg>',
iconCamera:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M17,8H6c-1.7,0-3,1.3-3,3v10c0,1.7,1.3,3,3,3h11c1.7,0,3-1.3,3-3V11C20,9.3,18.7,8,17,8z"/><path d="M28.5,8.1c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8c0,0.4,0.2,0.7,0.5,0.9l5,3C27.6,24,27.8,24,28,24   c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9C29,8.6,28.8,8.3,28.5,8.1z"/></g></svg>',
iconMicOff:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48H0zm0 0h48v48H0z" fill="none"/><path d="M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z"/></svg>',
iconMic:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z"/><path d="M0 0h48v48H0z" fill="none"/></svg>',iconRefresh:'<?xml version="1.0" ?><svg style="enable-background:new 0 0 30 30;" version="1.1" viewBox="0 0 30 30" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M22.143,23.365  C20.221,25.008,17.726,26,15,26C8.925,26,4,21.075,4,15" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><path d="M7.857,6.635  C9.779,4.992,12.274,4,15,4c6.075,0,11,4.925,11,11" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><polygon points="26,20 22,14 30,14 "/><polygon points="4,10 8,16 0,16 "/></svg>',
iconClose:'<?xml version="1.0" ?><svg  style="enable-background:new 0 0 612 792;" version="1.1" viewBox="0 0 612 792" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{clip-path:url(#SVGID_2_);fill:none;stroke:#E44061;stroke-width:45;}.st1{fill:#E44061;}</style><g><g><defs><rect height="512" width="512" x="50" y="140"/></defs><clipPath id="SVGID_2_"><use style="overflow:visible;" xlink:href="#SVGID_1_"/></clipPath><path class="st0" d="M306,629.5c128.8,0,233.5-104.7,233.5-233.5S434.8,162.5,306,162.5S72.5,267.2,72.5,396    S177.2,629.5,306,629.5L306,629.5z"/></g><polygon class="st1" points="348.7,396 448,296.7 405.3,254 306,353.3 206.7,254 164,296.7 263.3,396 164,495.3 206.7,538    306,438.7 405.3,538 448,495.3 348.7,396  "/></g></svg>',
iconGroup:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><rect fill="none" height="24" width="24"/><g><path d="M12,12.75c1.63,0,3.07,0.39,4.24,0.9c1.08,0.48,1.76,1.56,1.76,2.73L18,18H6l0-1.61c0-1.18,0.68-2.26,1.76-2.73 C8.93,13.14,10.37,12.75,12,12.75z M4,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C2,12.1,2.9,13,4,13z M5.13,14.1 C4.76,14.04,4.39,14,4,14c-0.99,0-1.93,0.21-2.78,0.58C0.48,14.9,0,15.62,0,16.43V18l4.5,0v-1.61C4.5,15.56,4.73,14.78,5.13,14.1z M20,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C18,12.1,18.9,13,20,13z M24,16.43c0-0.81-0.48-1.53-1.22-1.85 C21.93,14.21,20.99,14,20,14c-0.39,0-0.76,0.04-1.13,0.1c0.4,0.68,0.63,1.46,0.63,2.29V18l4.5,0V16.43z M12,6c1.66,0,3,1.34,3,3 c0,1.66-1.34,3-3,3s-3-1.34-3-3C9,7.34,10.34,6,12,6z"/></g></svg>',
iconLeft:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M14 7l-5 5 5 5V7z"/><path d="M24 0v24H0V0h24z" fill="none"/></svg>',iconFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',iconExitFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>',
iconSharescreen:'<?xml version="1.0" ?><!DOCTYPE svg ><svg  height="22px" version="1.1" viewBox="0 0 48 48" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path clip-rule="evenodd" d="M46,37H2c-0.553,0-1-0.447-1-1V8c0-0.552,0.447-1,1-1h44c0.553,0,1,0.448,1,1v28  C47,36.553,46.553,37,46,37z M45,9H3v26h42V9z M21,16c0.214,0,0.4,0.082,0.563,0.196l7.771,4.872C29.72,21.205,30,21.566,30,22  c0,0.325-0.165,0.601-0.405,0.783l-7.974,4.981C21.449,27.904,21.238,28,21,28c-0.553,0-1-0.447-1-1V17C20,16.448,20.447,16,21,16z   M15,39h18c0.553,0,1,0.447,1,1s-0.447,1-1,1H15c-0.553,0-1-0.447-1-1S14.447,39,15,39z" fill-rule="evenodd"/></svg>',
iconMobile:'<?xml version="1.0" ?><svg  version="1.1" height="16" width="16" viewBox="0 0 16 16" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M5,16h6c1.105,0,2-0.895,2-2V2c0-1.105-0.895-2-2-2H5C3.895,0,3,0.895,3,2v12C3,15.105,3.895,16,5,16z M4,2h8v12H4V2z"/></svg>'};aztExam.svg.getDom=function(a){return(new DOMParser).parseFromString(a,"image/svg+xml").documentElement};
aztExam.lang={btDone:"XONG",btViewFull:"XEM TO\u00c0N B\u1ed8 L\u1edaP",btViewHistory:"XEM TH\u00d4NG TIN",btCopyLink:"COPY LINK",btBackToList:"DANH S\u00c1CH L\u1edaP",lbDeviceInfo:"TH\u00d4NG TIN THI\u1ebeT B\u1eca",lbOs:"H\u1ec7 \u0111i\u1ec1u h\u00e0nh",msgOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : iOS(iphone,ipad) , Android , Window , MAC_OS",msgTeacherOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : Window , MAC_OS",
lbBrowser:"Tr\u00ecnh duy\u1ec7t",msgBrowserNotSupportPc:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 phi\u00ean b\u1ea3n m\u1edbi nh\u1ea5tt tr\u00ecnh duy\u1ec7t Chrome,C\u1ed1c c\u1ed1c ,Microsoft Edge ,Firefox tr\u00ean m\u00e1y t\u00ednh",msgBrowserNotSupportAndroid:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Chrome tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh Android . Copy link v\u00e0 m\u1edf b\u1eb1ng Chrome !",msgBrowserNotSupportIOs:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Safari  tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh iOs . Copy link v\u00e0 m\u1edf b\u1eb1ng Safari !",
lbCamera:"Camera ",msgCameraNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 camera.",msgCameraNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera. Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1,camera tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp camera , t\u1ea3i l\u1ea1i trang website",msgCameraNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera .T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp camera .",
lbMic:"Microphone ",msgMicNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 microphone",msgMicNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone. Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1,microphone tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp microphone , t\u1ea3i l\u1ea1i trang website",msgMicNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone.T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp microphone .",
lbTitleHistory:"TH\u00d4NG TIN C\u00c1 NH\u00c2N ",lbConnectingMedia:"\u0110ang k\u1ebft n\u1ed1i ... !"};aztExam=aztExam||{};
aztExam.monitor=cc.Node.extend({_hasExtentCamera:!1,_imageCaptureWidth:142,_imageCaptureHeight:106,deviceInfo:null,stream:null,streamType:-1,_isGettingMediaUser:!1,_hasVideoReviewPlaying:!1,ctor:function(){this.init()},init:function(){this.deviceInfo={hasCollectInfo:!1,isSupportMonitor:!0};this.options={};this.options.roomid="";this.options.resultid="";this.options.time=-1;this.options.userlist=[];this.options.duration=9E5;this.options.user={token:"",userid:"",username:"",studentId:""};this.options.config=
{currentUpdateSize:3,storeUpdateSize:3,screenUpdateSize:6,domainApi:"",firebaseApp:null}},showDeviceUI:function(a){if(a){try{this.deviUI&&(document.body.removeChild(this.deviUI),this.deviUI=null)}catch(n){cc.log("error remove deviUI")}var b=window.innerWidth/500;0==b&&(b=1);1<=b&&(b=1);var c=window.innerHeight/b;this.deviUI=this.findDom(document.createElement("div"));this.deviUI.css("position","absolute");this.deviUI.css("transform-origin","0% 0%");this.deviUI.css("transform","scale("+b+","+b+")");
this.deviUI.css("width","500px");this.deviUI.css("height",Math.floor(c)+"px");this.deviUI.css("left",Math.floor((window.innerWidth-500*b)/2)+"px");this.deviUI.css("top",Math.floor((window.innerHeight-c*b)/2)+"px");this.deviUI.css("background-color","white");this.deviUI.css("font-family","sans-serif");this.deviUI.css("font-size","18px");this.deviUI.css("box-shadow","0 2px 2px 0 rgb(0 0 0 / 14%), 0 3px 1px -2px rgb(0 0 0 / 12%), 0 1px 5px 0 rgb(0 0 0 / 20%)");this.deviUI.css("z-index",999999999);document.body.appendChild(this.deviUI);
this.deviUI.css("display","block");b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height","60px");b.css("border-bottom","1px solid #CCCCCC");this.deviUI.appendChild(b);this.btDone=this.createButton(100,40,aztExam.lang.btDone,"#1A84E3",16);this.btDone.css("float","left");this.btDone.css("margin-left","10px");this.btDone.css("margin-top","10px");b.appendChild(this.btDone);var d=this.findDom(document.createElement("span"));d.css("color","gray");d.css("display","flex");d.css("width",
"60%");d.css("height","100%");d.css("float","left");d.css("padding-left","20px");d.css("align-items","center");d.textContent=aztExam.lang.lbDeviceInfo;b.appendChild(d);this.btDone.addTouch(n=>{this.deviUI.css("display","none")});b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height",c-60+"px");b.css("overflow-x","hidden");b.css("text-align","center");b.css("overflow-y","scroll");this.deviUI.appendChild(b);c=this.findDom(document.createElement("div"));c.css("width","100%");
c.css("height","60px");c.css("margin-top","10px");c.css("background",a.osSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.textContent=aztExam.lang.lbOs+" "+a.osName+"  "+a.osVersion;b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("margin-left","5%");c.textContent="student"==this.role()?aztExam.lang.msgOsNotSupport:
aztExam.lang.msgTeacherOsNotSupport;c.css("display",a.osSupport?"none":"block");b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.browserSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.textContent=aztExam.lang.lbBrowser+" "+a.browser.name+" "+a.browser.version;b.appendChild(c);
c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("padding-left","5%");c.css("line-height","28px");c.textContent=aztExam.lang.msgBrowserNotSupportPc;a.isAndroid?c.textContent=aztExam.lang.msgBrowserNotSupportAndroid:a.isIOs&&(c.textContent=aztExam.lang.msgBrowserNotSupportIOs);c.css("display",a.browserSupport?"none":"block");b.appendChild(c);if(a.browserSupport){c=this.findDom(document.createElement("div"));
c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.textContent=aztExam.lang.lbCamera+" ("+a.videoInputDevices.length+")";b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");
c.css("margin-top","10px");c.css("padding-left","5%");c.css("display",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"none":"block");a.hasWebcam?a.isWebsiteHasWebcamPermissions||(c.textContent=a.isIOs?aztExam.lang.msgCameraNotPermissionIos:aztExam.lang.msgCameraNotPermission):c.textContent=aztExam.lang.msgCameraNotFound;b.appendChild(c);if(a.isWebsiteHasWebcamPermissions){c=document.createElement("video");c.width=80;c.height=60;c.style.marginLeft="auto";c.style.marginTop="5px";c.classList.add("azt_monitor_webcam_review");
c.muted=!0;c.playsInline=!0;this.stream&&(c.srcObject=this.stream,c.play());b.appendChild(c);var e=document.createElement("div");e.style.width="100%";e.style.height="auto";b.appendChild(e);c=a.videoInputDevices;for(d=0;d<c.length;d++){var f=this.createListCheck("azt_cam_item",d,c[d].label,d==this.deviceInfo.videoInputIndex?!0:!1,c[d]);f.addTouch(n=>{n=parseInt(n.target.getAttribute("azt_cam_item_index"));n!=this.deviceInfo.videoInputIndex&&this.getMediaUser(n,this.deviceInfo.audioInputIndex)});e.appendChild(f)}}c=
this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.textContent=aztExam.lang.lbMic+" ("+a.audioInputDevices.length+")";b.appendChild(c);e=this.findDom(document.createElement("div"));e.css("width","90%");e.css("height",
"auto");e.css("text-align","center");e.css("margin-top","10px");e.css("padding-left","5%");e.css("padding-left","5%");e.css("display",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"none":"block");a.hasMicrophone?a.isWebsiteHasMicrophonePermissions||(e.textContent=a.isIOs?aztExam.lang.msgMicNotPermissionIos:aztExam.lang.msgMicNotPermission):e.textContent=aztExam.lang.msgMicNotFound;if(a.isWebsiteHasMicrophonePermissions)for(c=a.audioInputDevices,d=0;d<c.length;d++)f=this.createListCheck("azt_mic_item",
d,c[d].label,d==this.deviceInfo.audioInputIndex?!0:!1,c[d]),f.addTouch(n=>{n=parseInt(n.target.getAttribute("azt_mic_item_index"));n!=this.deviceInfo.audioInputIndex&&this.getMediaUser(this.deviceInfo.videoInputIndex,n)}),b.appendChild(f);b.appendChild(e)}else{var l=document.createElement("div");a=window.location.toString();0>a.indexOf("cam.html")&&(a=window.location.toString().indexOf(this._optionsPreparing.roomid),a=0>a?window.location.length:a,a=window.location.toString().substr(0,a+this._optionsPreparing.roomid.length+
1));l.textContent=a;l.style.width="100%";l.style.height="30px";l.style.marginTop="20px";l.style.marginBottom="10px";b.appendChild(l);var p=this.createButton(160,60,aztExam.lang.btCopyLink,"#1A84E3",20);p.css("margin-left","170px");p.css("margin-top","10px");p.css("display","flex");p.addTouch(n=>{n=document.createRange();const w=window.getSelection();w.removeAllRanges();n.selectNodeContents(l);w.addRange(n);try{document.queryCommandSupported("copy")?(document.execCommand("copy"),p.textContent="\u0110\u00c3 COPY LINK"):
cc.log("exec Command not found !")}catch(x){console.log(x)}w.removeAllRanges()});b.appendChild(p);this.isMobile()||(a=this.createButton(210,60,"DOWNLOAD CHROME","#1A84E3",16),a.css("margin-left","140px"),a.css("margin-top","10px"),a.css("display","flex"),a.addEventListener("mouseup",()=>{window.location.href="https://www.google.com/chrome/?hl=en-US"}),b.appendChild(a))}}},parseOption:function(a){a&&a.roomid&&cc.isString(a.roomid)&&(this.options.roomid=a.roomid);a&&a.resultid&&(this.options.resultid=
Number(a.resultid));a&&a.examid&&(this.options.examid=Number(a.examid));a&&a.user&&(a.user.studentid&&(this.options.user.studentid=a.user.studentid),a.user.userid&&(this.options.user.userid=a.user.userid),a.user.token&&(this.options.user.token=a.user.token),this.options.user.username=cc.isEmpty(a.user.studentname)?a.user.username:a.user.studentname);a&&a.userlist&&cc.isArray(a.userlist)&&(this.options.userlistStart=JSON.parse(JSON.stringify(a.userlist)));a&&a.time&&cc.isNumber(a.time)&&(this.options.time=
a.time);a&&a.duration&&(this.options.duration=Number(a.duration));this.options.duration=9E5>this.options.duration?9E5:this.options.duration;a&&a.config&&(a.config.domainApi&&(this.options.config.domainApi=a.config.domainApi),a.config.urlGetDownloadUrl&&(this.options.config.urlGetDownloadUrl=a.config.urlGetDownloadUrl),a.config.urlGetPublicForLive&&(this.options.config.urlGetPublicForLive=a.config.urlGetPublicForLive),a.config.urlGetListFileForLive&&(this.options.config.urlGetListFileForLive=a.config.urlGetListFileForLive),
a.config.urlGetTokenForLive&&(this.options.config.urlGetTokenForLive=a.config.urlGetTokenForLive),a.config.urlExamResultGetLastExamResultOfStudentId&&(this.options.config.urlExamResultGetLastExamResultOfStudentId=a.config.urlExamResultGetLastExamResultOfStudentId),a.config.numMainView&&(this.options.config.numMainView=a.config.numMainView),a.config.firestore&&(this.options.config.firestore=a.config.firestore));a&&a.take&&(this.options.take=a.take);a&&a.filetypeStr&&(this.options.take=a.filetypeStr);
a&&a.lckeyCurr&&(this.options.lckeyCurr=a.lckeyCurr);a&&a.lckeyOffer&&(this.options.lckeyOffer=a.lckeyOffer);a&&a.remoteKeyCurr&&(this.options.remoteKeyCurr=a.remoteKeyCurr);a&&a.remoteKeyOffer&&(this.options.remoteKeyOffer=a.remoteKeyOffer);a&&a.prefixName&&(this.options.prefixName=a.prefixName);a&&a.mykey&&(this.options.mykey=a.mykey);a&&a.element&&(this.options.element=a.element);a&&a.firebaseApp&&(this.options.firebaseApp=a.firebaseApp);this.options.config.urlGetDownloadUrl=this.options.config.domainApi+
this.options.config.urlGetDownloadUrl;this.options.config.urlGetPublicForLive=this.options.config.domainApi+this.options.config.urlGetPublicForLive;this.options.config.urlGetListFileForLive=this.options.config.domainApi+this.options.config.urlGetListFileForLive;this.options.config.urlGetTokenForLive=this.options.config.domainApi+this.options.config.urlGetTokenForLive;this.options.config.urlExamResultGetLastExamResultOfStudentId=this.options.config.domainApi+this.options.config.urlExamResultGetLastExamResultOfStudentId;
this.options.urlDownload=a.urlDownload;this.options.urlCurr=a.urlCurr;this.options.urlOffer=a.urlOffer;this.options.qrsign=a.qrsign;this.options.excamkey=a.excamkey;this.options.tk=a.tk;this.options.fn=a.fn},collectDeviceInfo:function(a){cc.log("call collectDeviceInfo");this.deviceInfo.hasCollectInfo?setTimeout(()=>{a&&a()},100):DetectRTC.load(()=>{cc.log("start collection info");this.deviceInfo.osName=DetectRTC.osName;this.deviceInfo.osVersion=DetectRTC.osVersion;this.deviceInfo.browser=DetectRTC.browser;
this.deviceInfo.osSupport=this.checkOsSupport(this.deviceInfo);this.deviceInfo.browserSupport=this.checkBrowserSuppor(this.deviceInfo);this.deviceInfo.hasWebcam=DetectRTC.hasWebcam;this.deviceInfo.hasMicrophone=DetectRTC.hasMicrophone;this.deviceInfo.isWebsiteHasWebcamPermissions=DetectRTC.isWebsiteHasWebcamPermissions;this.deviceInfo.isWebsiteHasMicrophonePermissions=DetectRTC.isWebsiteHasMicrophonePermissions;this.deviceInfo.isWebRTCSupported=DetectRTC.isWebRTCSupported;this.deviceInfo.videoInputDevices=
DetectRTC.videoInputDevices;this.deviceInfo.audioInputDevices=DetectRTC.audioInputDevices;this.deviceInfo.osSupport||(this.deviceInfo.isSupportMonitor=!1);this.deviceInfo.browserSupport||(this.deviceInfo.isSupportMonitor=!1);this.deviceInfo.hasCollectInfo=!0;cc.log("collect deviceInfo done");setTimeout(()=>{a&&a()},100)})},checkOsSupport:function(a){var b=a.osName.toLowerCase();return 0<=b.indexOf("window")||0<=b.indexOf("mac")?a.isPc=!0:0<=b.indexOf("android")?a.isAndroid=!0:0<=b.indexOf("ios")||
b.indexOf("ipad")?a.isIOs=!0:!1},checkBrowserSuppor:function(a){var b=a.osName.toLowerCase();a=a.browser.name.toLowerCase();if(0<=b.indexOf("mac")&&cc.touchable())return!0;if(0<=b.indexOf("window")||0<=b.indexOf("mac"))if(0<=a.indexOf("chrome")||0<=a.indexOf("edge")||0<=a.indexOf("firefox")||0<=a.indexOf("coccoc"))return!0;return 0<=b.indexOf("android")&&0<=a.indexOf("chrome")||(0<=b.indexOf("ios")||0<=b.indexOf("ipad"))&&0<=a.indexOf("safari")?!0:!1},isMobile:function(){return this.deviceInfo&&this.deviceInfo.osName&&
0>this.deviceInfo.osName.toLowerCase().indexOf("window")&&0>this.deviceInfo.osName.toLowerCase().indexOf("mac")?!0:!1},isInfoMobile:function(a){return 0>a.osName.toLowerCase().indexOf("window")&&0>a.osName.toLowerCase().indexOf("mac")?!0:!1},getMediaUser:function(a,b,c){cc.log("get media user "+a+":"+b);if(!(0>a&&0>b||this._isGettingMediaUser||a>=this.deviceInfo.videoInputDevices.length||b>=this.deviceInfo.audioInputDevices.length)){var d=!1,e=!1;if(0<=a){cc.log("video index");d=this.deviceInfo.videoInputDevices[a].deviceId;
var f=640,l=480;this.isMobile()||(f=320,l=240);d=c?{deviceId:d?{exact:d}:void 0}:{deviceId:d?{exact:d}:void 0,width:{max:f,min:f},height:{max:l,min:l},frameRate:{max:12,ideal:6}};cc.log("video contrainst")}0<=b&&(e=this.deviceInfo.audioInputDevices[b].deviceId,e={deviceId:e?{exact:e}:void 0});cc.log("video constraints "+JSON.stringify(d));this._isGettingMediaUser=!0;this.stopAllPreview();navigator.mediaDevices.getUserMedia({audio:e,video:d}).then(p=>{this.gotStream(p,a,b)}).then().catch(p=>{this.handleError(p,
a,b,c)})}},gotStream:function(a,b,c){cc.log("on getStream");this.deviceInfo.videoInputIndex=b;this.deviceInfo.audioInputIndex=c;this.stream=a;0<=b&&(this.videoWidth=this.stream.getVideoTracks()[0].getSettings().width,this.videoHeight=this.stream.getVideoTracks()[0].getSettings().height,this.videoHeight=0==this.videoHeight?480:this.videoHeight,this.videoWidth=0==this.videoWidth?640:this.videoWidth);0<=b&&0<=c?this._streamType=0:0<=b?this._streamType=1:0<=c&&(this._streamType=2);(0<=b&&!this.deviceInfo.isWebsiteHasWebcamPermissions||
0<=c&&!this.deviceInfo.isWebsiteHasMicrophonePermissions)&&DetectRTC.load(()=>{this.deviceInfo.videoInputDevices=DetectRTC.videoInputDevices;this.deviceInfo.audioInputDevices=DetectRTC.audioInputDevices});this.startAllPreview();this._isGettingMediaUser=!1},handleError:function(a,b,c,d){cc.log("handle error getStream "+b+":"+c+":"+d);this._isGettingMediaUser=!1;d?(cc.log("error permission "),this.showDeviceUI(this.deviceInfo)):this.getMediaUser(b,c,!0)},destroyStream:function(){this.stream&&(this.stream.getTracks().forEach(a=>
{a.stop()}),this.stream=null)},stopAllPreview:function(){this.destroyStream()},startAllPreview:function(){for(var a=document.getElementsByClassName("azt_monitor_webcam_review"),b=0;b<a.length;b++)cc.log("startPreview"),a[b].srcObject=this.stream,a[b].play()},getUrlDownload:function(a,b,c,d,e,f,l,p){var n=new XMLHttpRequest;a=encodeURI(a+"?examHashId="+(c+"&resultId="+d+"&isPublic="+f+"&userId="+e+"&file_name="+l));n.open("GET",a);n.setRequestHeader("Authorization","Bearer "+b);n.onreadystatechange=
function(){if(4==n.readyState)if(200==n.status)try{cc.log("getUrlDownload :"+n.responseText);var w=JSON.parse(n.responseText).data.link;setTimeout(()=>{p&&p(w)},10)}catch(x){setTimeout(()=>{p&&p("")},10)}else setTimeout(()=>{p&&p("")},10)};n.send()},getPublicUpload:function(a,b,c,d,e,f,l,p,n,w){var x=new XMLHttpRequest;a=encodeURI(a+"?examHashId="+(c+"&resultId="+d+"&isPublic="+l+"&userId="+e+"&file_name="+f+"&file_size=100000&minetype=text/plain&randomFileName="+p+"&fileType="+n));x.open("GET",a);
x.setRequestHeader("Authorization","Bearer "+b);x.onreadystatechange=function(){if(4==x.readyState)if(200==x.status)try{var G=JSON.parse(x.responseText).data.upload_url,N=JSON.parse(x.responseText).data.url,g=JSON.parse(x.responseText).data.fileTypeStr,k=JSON.parse(x.responseText).data.name,h=JSON.parse(x.responseText).data.userFileTypeStr;w(G,N,g,k,h)}catch(m){w("")}else w("")};x.send()},getPublicUploadQr:function(a,b,c,d,e,f,l,p,n){var w=new XMLHttpRequest;a=encodeURI(a+"?sign="+(b+"&examHashId="+
c+"&resultid="+d+"&isPublic="+l+"&userId="+e+"&file_name="+f+"&file_size=100000&minetype=text/plain&randomFileName="+p));w.open("GET",a);w.onreadystatechange=function(){if(4==w.readyState)if(200==w.status)try{var x=JSON.parse(w.responseText).data.upload_url,G=JSON.parse(w.responseText).data.url,N=JSON.parse(w.responseText).data.fileTypeStr,g=JSON.parse(w.responseText).data.name;n(x,G,N,g)}catch(k){n("")}else n("")};w.send()},uploadPublicContent:function(a,b,c,d){c=new Blob([c],{type:"text/plain"});
b=new File([c],b);c=new XMLHttpRequest;c.open("PUT",a);c.setRequestHeader("Content-Type","text/plain");c.setRequestHeader("x-amz-acl","public-read");c.onreadystatechange=function(){4==this.readyState&&d&&d(this.status,this.responseText)};c.send(b)},uploadContent:function(a,b,c,d,e,f){this.getPublicUpload(this.options.config.urlGetPublicForLive,this.options.user.token,this.options.roomid,this.options.resultid,this.options.user.userid,a,c,d,e,(l,p,n)=>{l?this.uploadPublicContent(l,a,"=="+n+","+b,(w,
x)=>{f&&f(w,p)}):f&&f(404,"")})},getTokenForLive:function(a,b){var c=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetTokenForLive+"?examHashId="+a);c.open("GET",a);c.setRequestHeader("Authorization","Bearer "+this.options.user.token);c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status)try{var d=JSON.parse(c.responseText).data;b(d)}catch(e){b("")}else b("")};c.send()},getListFile:function(a,b,c,d){var e=new XMLHttpRequest;a="examHashId="+encodeURIComponent(a)+"&userId="+b+
"&resultId="+c;a=encodeURI(this.options.config.urlGetListFileForLive+"?"+a);e.open("GET",a);e.setRequestHeader("Authorization","Bearer "+this.options.user.token);e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status)try{var f=JSON.parse(e.responseText).objs;cc.log("getListFile Path "+JSON.stringify(f));d&&d(f)}catch(l){d&&d("")}else d&&d("")};e.send()},getContentFile:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=()=>{if(4==c.readyState&&200==c.status)try{b&&b(c.responseText)}catch(d){b&&
b("")}};c.open("GET",a);c.send()},getExamResultGetLastExamResultOfStudentId:function(a,b,c,d,e){var f=new XMLHttpRequest;b=encodeURI(this.options.config.urlExamResultGetLastExamResultOfStudentId+"?examId="+(b+"&userId="+c+"&studentId="+d+"&getMixQuestion=0"));f.open("GET",b);f.setRequestHeader("Authorization","Bearer "+a);f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status)try{var l=JSON.parse(f.responseText),p={lastResultId:-1,lastResultTime:-1,resultIds:[]};if(l.data){if(l.data.examResultObjs)for(var n=
0;n<l.data.examResultObjs.length;n++)p.resultIds.push(l.data.examResultObjs[n].id);l.data.lastExamResultObj&&l.data.lastExamResultObj.examResultObj&&(p.lastResultId=l.data.lastExamResultObj.examResultObj.id,p.lastResultTime=l.data.lastExamResultObj.examResultObj.startedTest)}cc.log("getExamResult "+JSON.stringify(p));e&&e(p)}catch(w){e&&e(null)}else e&&e(null)};f.send()},get_token_for_qr_live:function(a,b){var c=new XMLHttpRequest;c.open("GET",this._optionsPreparing.config.domainApi+"S3space/get_token_for_qr_live");
c.setRequestHeader("Authorization","Bearer "+a);c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status)try{cc.log("get tokenForLive : "+c.responseText),b&&b(c.responseText)}catch(d){b&&b("")}else b&&b("")};c.send()},examLiveTeachers_student_subscribe:function(a,b){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_student_subscribe(a).subscribe(c=>{cc.log("receive student subcribe examId "+JSON.stringify(c));b&&b(c);0==c.success&&setTimeout(()=>{this.examLiveTeachers_student_subscribe(a,
b)},1500)})},examLiveTeachers_student_unbsubscribe:function(a){this.options.firebaseApp&&(cc.log("student unsubcrible "+a),this.options.firebaseApp.examLiveTeachers_student_unbsubscribe(a))},examLiveTeachers_teacher_saveChange:function(a,b,c){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_teacher_saveChange(a,b).subscribe(d=>{cc.log("teacher write examId "+JSON.stringify(d));c&&c(d)})},examSessions_subscribeUserMap:function(a,b){this.options.firebaseApp&&this.options.firebaseApp.examSessions_subscribeUserMap(a).subscribe(c=>
{b&&b(c)})},examLiveStudents_student_subscribe:function(a,b){this.options.firebaseApp&&this.options.firebaseApp.examLiveStudents_student_subscribe(a).subscribe(c=>{cc.log("receive student subcribe userid "+JSON.stringify(c));b&&b(c);0==c.success&&setTimeout(()=>{this.examLiveStudents_student_subscribe(a,b)},1500)})},examLiveStudents_student_unbsubscribe:function(a){this.options.firebaseApp&&(cc.log("student unsubcrible userid "+a),this.options.firebaseApp.examLiveStudents_student_unbsubscribe(a))},
examLiveStudents_teacher_saveChange:function(a,b,c){this.options.firebaseApp&&(cc.log("teacher write to userid "+a+":"+b+":"+JSON.stringify(c)),this.options.firebaseApp.examLiveStudents_teacher_saveChange(a,b,c).subscribe(d=>{cc.log("teacher write userid "+JSON.stringify(d))}))},encodeStrN:function(a,b,c,d){d=CryptoJS.AES.encrypt(d,a).toString();var e=Math.floor(c.length*Math.random());e%=2022;var f=c.substr(0,e);a=CryptoJS.AES.encrypt(f,a).toString();c=c.substr(e,c.length);return"="+b+","+d+","+
a+","+c},decodeStrN:function(a,b){try{var c={},d=b.split(",");cc.log("arr:"+d.length);if(4!=d.length)return null;var e=d[0].substr(1,d[0].length);cc.log("remoteKey: "+e);var f=d[1],l=d[2],p=d[3],n=this.getDecryptedCode(e,a);cc.log("decodekey "+n);if(""==n)return null;var w=CryptoJS.AES.decrypt(f,n).toString(CryptoJS.enc.Utf8),x=CryptoJS.AES.decrypt(l,n).toString(CryptoJS.enc.Utf8);cc.log("strBegin length : "+x.length);cc.log("strEnd length : "+p.length);c.info=JSON.parse(atob(w));c.imgstr=x+p;return c}catch(G){return null}},
encodeStrM:function(a,b){if(a&&b){var c=Math.floor(10+(5050<a.length?5050:a.length)*Math.random()),d=a.substr(0,c);a=a.substr(c,a.length);c={};var e=cc.randomStr(100);b=CryptoJS.AES.encrypt(b,e).toString();d=CryptoJS.AES.encrypt(d,e).toString();c.k=d.length+"_"+b.length+"_"+e;c.encryptStr=d+b+a;return c}},decodeStrM:function(a,b){try{var c=b.indexOf(","),d=b.substr(2,c-2);d=this.getDecryptedCode(d,a);var e=b.substr(c+1,b.length),f=d.split("_");if(3!=f.length)return null;var l=parseInt(f[0]),p=parseInt(f[1]),
n=f[2];b=a="";var w=e.substr(0,l);a+=CryptoJS.AES.decrypt(w,n).toString(CryptoJS.enc.Utf8);b=e.substr(l,l+p);b=CryptoJS.AES.decrypt(b,n).toString(CryptoJS.enc.Utf8);a+=e.substr(l+p,e.length);return{info:JSON.parse(atob(b)),imgstr:a}}catch(x){return null}},decodeStr:function(a){var b=null;if(0==a.indexOf("data")){var c=parseInt(a.substr(a.length-10,10));b=a.substr(0,a.length-(10+c));a=a.substr(a.length-(10+c),c);a=JSON.parse(a);c=(new Date).getTime();a.status=c-a.startTime>this._timeOnlineIntv?"join":
"online";b={info:a,imgstr:b}}else"=="==a.substr(0,2)?(cc.log("in decode M "+this.options.take),(a=this.decodeStrM(this.options.take,a))&&(b=a)):"="==a.substr(0,1)?(cc.log("in decode N "+this.options.take),(a=this.decodeStrN(this.options.take,a))&&(b=a)):(c=a.indexOf("/"),b=a.substr(0,c),b=atob(b),b=Number(b.substr(7,10)),c=a.substr(c,a.length),a=atob(c.substr(c.length-b,c.length)),a=JSON.parse(a),b=c.substr(0,c.length-b),b={info:a,imgstr:b});return b},getDecryptedCode:function(a,b){try{return CryptoJS.AES.decrypt(a,
CryptoJS.enc.Utf8.parse(b),{keySize:16,iv:CryptoJS.enc.Utf8.parse(b.substr(0,16)),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8)}catch(c){return""}},showToolTip:function(a,b){var c=this.isMobile()?"100%":"600px",d=document.createElement("div");d.style.width=c;d.style.backgroundColor="#333333";d.style.display="flex";d.style.alignItems="center";d.style.justifyContent="center";d.style.position="absolute";d.style.top="0px";d.style.left=this.isMobile()?"0px":(window.innerWidth-
600)/2+"px";d.style.fontSize=cc.isMobile()?"12px":"16px";d.style.padding="20px";d.style.color="white";d.style.zIndex=999999999;d.textContent=a;document.body.appendChild(d);d.addEventListener("mousedown",e=>{document.body.removeChild(e.currentTarget)});cc.isEmpty(b)&&(b=3E3);0<=b&&setTimeout(()=>{document.body.removeChild(d)},b)},createButton:function(a,b,c,d,e){var f=this.findDom(document.createElement("div"));f.css("border-radius","5px");f.css("width",a+"px");f.css("height",b+"px");f.css("background-color",
d);f.css("display","flex");f.css("align-items","center");f.css("justify-content","center");f.css("color","white");f.css("cursor","pointer");f.css("font-size",e+"px");f.css("user-select","none");f.css("transform-origin","50% 50%");f.textContent=c;f.addTouchStart(l=>{cc.log("touch start");l.target.css("opacity",.5)});f.addTouchEnd(l=>{cc.log("touch end");l.target.css("opacity",1)});return f},createButtonIcon:function(a,b,c,d,e,f){var l=this.findDom(document.createElement("div"));l.css("border-radius",
"5px");l.css("width",a+"px");l.css("height",b+"px");l.css("background-color",e);l.css("display","flex");l.css("align-items","center");l.css("justify-content","center");l.css("color","white");l.css("cursor","pointer");l.css("font-size",f+"px");l.css("user-select","none");l.css("transform-origin","50% 50%");a=document.createElement("div");a.style.fill="white";a.style.pointerEvents="none";d=(new DOMParser).parseFromString(d,"image/svg+xml");d.documentElement.style.fill="white";l.appendChild(d.documentElement);
d=document.createElement("span");d.textContent=c;d.style.marginLeft="5px";d.style.pointerEvents="none";l.span=d;l.appendChild(d);return l},createCircleAva:function(a,b,c,d){null==a&&(a="");a=a.trim();var e=this.findDom(document.createElement("div"));e.css("border-radius","50%");e.css("background-color",c);e.css("width",b+"px");e.css("height",b+"px");e.css("display","flex");e.css("align-items","center");e.css("justify-content","center");e.css("color",d);e.css("font-size",(b-10)/2+"px");a=a.split(" ");
e.textContent=a[a.length-1].substr(0,2).toUpperCase();return e},createListCheck:function(a,b,c,d,e){var f=this.findDom(document.createElement("div"));f.css("width","90%");f.css("margin-left","5%");f.css("height","50px");f.css("display","flex");f.css("align-items","center");f.css("justify-content","space-between");f.css("flex-direction","row");f.css("border-bottom","1px solid #AAAAAA");f.css("white-space","nowrap");f.css("cursor","pointer");f.classList.add(a);f.setAttribute(a+"_index",b);f.textContent=
c;f.info=e;a=document.createElement("div");a.classList.add("check_icon");a.textContent=aztExam.svg.iconCheck;a.style.display=d?"block":"none";f.appendChild(a);return f},getLocalStorage:function(a){try{if(localStorage)return localStorage.getItem(a)}catch(b){}cc.log("not support localStorage");return""},setLocalStorage:function(a,b){try{if(localStorage)return localStorage.setItem(a,b),!0}catch(c){}cc.log("not support localStorage");return!1},getParameterByName:function(a,b=window.location.href){a=a.replace(/[\[\]]/g,
"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},hasWebcamStream:function(){return 0==this._streamType||1==this._streamType?!0:!1},hasMicrophoneStream:function(){return 0==this._streamType||2==this._streamType?!0:!1},version:function(){return"100.0"}});
function SoundMeter(a){try{this.context=a;this.clip=this.slow=this.instant=0;this.script=a.createScriptProcessor(2048,1,1);const b=this;this.script.onaudioprocess=function(c){c=c.inputBuffer.getChannelData(0);let d,e=0,f=0;for(d=0;d<c.length;++d)e+=c[d]*c[d],.99<Math.abs(c[d])&&(f+=1);b.instant=Math.sqrt(e/c.length);b.slow=.95*b.slow+.05*b.instant;b.clip=f/c.length}}catch(b){}}
SoundMeter.prototype.connectToSource=function(a,b){console.log("SoundMeter connecting");try{a&&(this.mic=this.context.createMediaStreamSource(a),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!==typeof b&&b(null))}catch(c){console.error(c),"undefined"!==typeof b&&b(c)}};SoundMeter.prototype.stop=function(){console.log("SoundMeter stopping");try{this.mic&&this.mic.disconnect(),this.script&&this.script.disconnect()}catch(a){}};aztExam=aztExam||{};
aztExam.monitorStudent=aztExam.monitor.extend({_hasVideoReviewPlaying:!1,_hasVideoScreenPlaying:!1,_isWebsiteHasShareScreenPermission:!1,_hasExtentCamera:!1,_firstUpload:!0,_queueUpload:null,_uploadIntv:9E3,_needUpdateRealtime:!1,_state:0,w:void 0,_optionsPreparing:null,_lastCurrContent:"",_queueStoreContent:null,_arrStoreFile:null,_isGetLastCurr:!1,ctor:function(){cc.log("init ver= "+this.version());this._super();this.initUI();document.addEventListener("visibilitychange",()=>{this.handleVisibilityChange()},
!1)},handleVisibilityChange:function(){cc.log("doc visible change "+document.visibilityState);document.visibilityState&&"hidden"===document.visibilityState&&this.screenStream&&this._hasVideoScreenPlaying&&setTimeout(()=>{this._captureScreen(!0)},500)},init:function(){this._super();this._optionsPreparing=null;this._arrStoreFile=[];this._queueStoreContent=[];this._state=0},initUI:function(){this.preview=this.findDom(document.createElement("div"));this.preview.style.zIndex="9999999";this.preview.style.transformOrigin=
"100% 100%";this.preview.style.width="280px";this.preview.style.textAlign="center";this.preview.style.overflow="auto";this.preview.style.display="block";var a=document.createElement("div");a.style.width="100%";a.style.height=this._imageCaptureHeight;a.style.position="relative";a.style.float="left";a.style.textAlign="center";a.style.display="flex";a.style.flexDirection="row";a.style.justifyContent="center";this.divContVideo=a;this.preview.appendChild(a);this.videoExCamCont=document.createElement("div");
this.videoExCamCont.style.position="relative";this.videoExCamCont.style.float="left";this.videoExCamCont.style.width="120px";this.videoExCamCont.style.height="160px";this.videoExCamCont.style.overflow="hidden";this.videoExCamCont.style.textAlign="center";this.videoExCamCont.style.border="1px solid #CCCCCC";this.videoExCamCont.style.display="none";this.videoExCamCont.style.borderRadius="8px";this.videoExCamCont.style.marginRight="8px";a.appendChild(this.videoExCamCont);var b=document.createElement("div");
b.style.position="relative";b.style.float="left";b.style.display="flex";b.style.flexDirection="column";b.style.alignItems="center";b.style.justifyContent="center";a.appendChild(b);a=document.createElement("div");a.style.position="relative";a.style.float="left";a.style.width=this._imageCaptureWidth+"px";a.style.height=this._imageCaptureHeight+"px";a.style.overflow="hidden";a.style.borderRadius="8px";cc.isMobile()||(a.style.border="1px solid #CCCCCC");this.videoCont=a;b.appendChild(a);this.videoReview=
document.createElement("video");this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.style.position="relative";this.videoReview.classList.add("azt_monitor_webcam_review");cc.isMobile()||(this.videoReview.style.backgroundColor="gray");this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.updatePreviewUI()};this.videoReview.onresize=()=>{this.updatePreviewUI()};a.appendChild(this.videoReview);this.volumeMeter=document.createElement("canvas");this.volumeMeter.width=6;
this.volumeMeter.height=this._imageCaptureHeight;this.volumeMeter.style.position="absolute";this.volumeMeter.style.border="none";this.ctxVolumeMeter=this.volumeMeter.getContext("2d");this.volumeMeter.style.right="0px";this.volumeMeter.style.zIndex="9999999";this.preview.appendChild(this.volumeMeter);this.btScreen=this.createButtonIcon(146,30,"CHIA S\u1eba M\u00c0N H\u00ccNH",aztExam.svg.iconSharescreen,"#F39D13",11);this.btScreen.style.fontFamily="Arial";this.btScreen.style.display="none";this.btScreen.style.marginTop=
"8px";this.btScreen.addEventListener("mouseup",c=>{this.startGetScreenMedia()});b.appendChild(this.btScreen);this.btExcam=this.createButtonIcon(146,30,"K\u1ebeT N\u1ed0I \u0110I\u1ec6N THO\u1ea0I",aztExam.svg.iconMobile,"#F39D13",11);this.btExcam.style.fontFamily="Arial";this.btExcam.style.display="flex";this.btExcam.style.marginTop="8px";this.btExcam.addEventListener("mouseup",c=>{this.showQrCodeExCam()});b.appendChild(this.btExcam);this.videoScreen=document.createElement("video");this.videoScreen.muted=
!0;this.videoScreen.playsInline=!0;this.videoScreen.onplay=()=>{this._hasVideoScreenPlaying=!0;this.onScreenMedia()};this.videoScreen.onresize=()=>{this._updateSizeScreenDraw(this.options.config.screenUpdateSize)};this.previewWarning=this.findDom(document.createElement("div"));this.previewWarning.style.width="100%";this.previewWarning.style.height="100%";this.previewWarning.style.backgroundColor="red";this.previewWarning.style.opacity=.2;this.previewWarning.style.position="absolute";this.previewWarning.style.top=
"0px";this.previewWarning.style.left="0px";this.previewWarning.lastWarning=!1;this.previewWarning.style.numFound=-1;this.previewWarning.style.display="none";a.appendChild(this.previewWarning);this.canvasPreview=document.createElement("canvas");this.canvasPreview.style.borderRadius="8px";this.ctxPreview=this.canvasPreview.getContext("2d");this.canvasDraw=document.createElement("canvas");this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning=[];this.ctxDraw=this.canvasDraw.getContext("2d");
this.canvasDrawCurr=document.createElement("canvas");this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1;this.ctxDrawCurr=this.canvasDrawCurr.getContext("2d");this.ctxDrawCurr.fontSize="18px Arial";this.ctxDrawCurr.fillStyle="red";this.canvasScreen=document.createElement("canvas");this.canvasScreen.numDraw=0;this.canvasScreen.timestamp=[];this.canvasScreen.warning={};this.canvasScreen.isWarning=!1;this.ctxScreen=this.canvasScreen.getContext("2d");
this.canvasStreamCapture=document.createElement("canvas");this.ctxCanvasStreamCapture=this.canvasStreamCapture.getContext("2d");this.canvasExCam=document.createElement("canvas");this.canvasExCam.numDraw=0;this.canvasExCam.timestamp=[];this.canvasExCam.warning={};this.canvasExCam.isWarning=!1;this.ctxExCam=this.canvasExCam.getContext("2d");this.divLog=document.createElement("div");this.divLog.style.position="fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom=
"0px"},updatePreviewUI:function(){this._hasVideoReviewPlaying&&(this.videoReview.style.width="100%",this.videoReview.style.height="auto",this.canvasStreamCapture.width=this.videoReview.videoWidth,this.canvasStreamCapture.height=this.videoReview.videoHeight);this.isMobile()&&(this.preview.style.transform="scale(0.4)")},appendPreviewToElement:function(){clearInterval(this.appendElementItv);this.appendPreviewToElementTry=0;this.appendElementItv=setInterval(()=>{if(0==this._state)clearInterval(this.appendElementItv),
this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview);else if(null==this._optionsPreparing)clearInterval(this.appendElementItv);else if(10<=this.appendPreviewToElementTry)clearInterval(this.appendElementItv),cc.log("not found element to append preview "+this._optionsPreparing.element);else{var a=document.getElementById(this._optionsPreparing.element);cc.log("try to append preview to element "+a);a?(this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview),a.appendChild(this.preview),
this.stream&&this.startAllPreview(),this.connExCam&&this.connExCam.videoEl&&this.connExCam.videoEl.play(),cc.log("append preview to element ok !"),clearInterval(this.appendElementItv)):this.appendPreviewToElementTry++}},1E3)},prepairSession:function(a,b){a!=this._optionsPreparing&&(2==this._state?cc.log("monitor is running , stop it first !"):(this._state=1,this._optionsPreparing=a,cc.log("start prepairSession"),this.collectDeviceInfo(()=>{if(this.deviceInfo.isSupportMonitor){this.isMobile()?(this._imageCaptureHeight=
120,this._imageCaptureWidth=90,this.videoCont.style.width=this._imageCaptureWidth+"px",this.videoCont.style.height=this._imageCaptureHeight+"px",this.preview.style.width=this._imageCaptureWidth+"px",this.preview.style.transformOrigin="0% 0%",this.preview.style.marginLeft="50px"):(this._imageCaptureWidth=142,this._imageCaptureHeight=106);if(!this.stream){var c=-1,d=-1;0<this.deviceInfo.videoInputDevices.length&&(c=0);0<this.deviceInfo.audioInputDevices.length&&(d=0);this.getMediaUser(c,d)}this.initFaceEyeDetection();
this.appendPreviewToElement();cc.log("suport sharescreen : "+DetectRTC.isScreenCapturingSupported);this.btScreen.style.display=DetectRTC.isScreenCapturingSupported?"flex":"none";if(0<=window.location.href.indexOf("192")||0<=window.location.href.indexOf("42"))this.btScreen.style.display="flex";this.screenStream&&(this.btScreen.style.display="none");this.isMobile()&&(this.btScreen.style.display="none",this.btExcam.style.display="none");a.getUrlPublicTry=0;a.lckeyCurr=cc.randomStr(100);a.lckeyOffer=
cc.randomStr(100);this.initUrlUploadPublic(a,()=>{b&&b(!0,a)})}else b&&b(!1,a),this.hasShowDeviceNotSupport||(this.showDeviceUI(this.deviceInfo),this.hasShowDeviceNotSupport=!0)})))},startSession:function(a){cc.log("start session");this.stopSession();this.prepairSession(a,(b,c)=>{this._optionsPreparing==c&&0!=this._state?b&&(cc.log("url curr "+c.urlCurr),cc.log("url offer "+c.urlOffer),cc.log("url download "+c.urlDownload),""!=c.urlCurr&&""!=c.urlOffer&&""!=c.urlDownload?(this.parseOption(c),this.getLastCurr(d=>
{d||cc.log("first time login to exam");setTimeout(()=>{this.initFirestoreEvent();this._updateSizePreview();this._updateSizeCurrDraw(this.options.config.currentUpdateSize);this._updateSizeStoreDraw(this.options.config.storeUpdateSize);this._startMonitoring();this._state=2;this._initConn()},10)})):(cc.log("prepair for session fail , can't get url for options"),this.stopSession())):cc.log("prepair finish old options ! ")})},stopSession:function(){cc.log("stop session");this.destroyStream();this._stopMonitoring();
clearInterval(this.appendPreviewToElement);this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview);this.conn&&this.conn.reset();this._state=0;this._optionsPreparing=null;this._isGetLastCurr=!1;setTimeout(()=>{0>window.location.href.indexOf("take-test")&&0>window.location.href.indexOf("de-thi")&&(this.destroyScreenStream(),this.connExCam&&this.connExCam.reset(),this.closeQrCodeExam())},1E3)},gotStream:function(a,b,c){this._super(a,b,c);setTimeout(()=>{0==this._state?this.stopAllPreview():
(this.initSoundMeter(),this._running&&this._initConn())},10)},handleError:function(a,b,c,d){0!=this._state&&this._super(a,b,c,d)},destroyStream:function(){this.stopSoundMeter();this._super()},startGetScreenMedia:function(){this.screenStream?this.destroyScreenStream():this.getScreenMedia().then(()=>{this.screenStream&&(this.videoScreen.srcObject=this.screenStream,this.videoScreen.play())})},getScreenMedia:async function(){cc.log("getScreenMedia");try{this.screenStream=await navigator.mediaDevices.getDisplayMedia()}catch(a){cc.log("Error: "+
a),this.screenStream&&(this.screenStream.getTracks().forEach(b=>{b.stop()}),this.screenStream=null)}},onScreenMedia:function(){cc.log("onScreenMedia");this.screenStream&&(this.btScreen.style.display="none",this.screenStream.getVideoTracks()[0].onended=()=>{cc.log("screenStream end");this.destroyScreenStream();this.btScreen.style.display="flex"},this._isWebsiteHasShareScreenPermission=!0,null!=this.conn?this.sendStreamInfo():this._initConn(),this._captureScreen())},changeStream(a){this.conn&&(cc.log("change stream "+
a),"webcam"==a&&this.stream&&this.conn.replaceVideoTrack(this.stream,a),"screen"==a&&this.screenStream&&this.conn.replaceVideoTrack(this.screenStream,a),"excam"==a&&this.connExCam&&this.connExCam.remoteStream&&this.conn.replaceVideoTrack(this.connExCam.remoteStream,a))},destroyScreenStream(){this.screenStream&&(this.screenStream.getTracks().forEach(a=>{a.stop()}),this.screenStream=null,this.sendStreamInfo());this._isWebsiteHasShareScreenPermission=this._hasVideoScreenPlaying=!1},initSoundMeter:function(){if(0==
this._streamType||2==this._streamType)try{window.AudioContext=window.AudioContext||window.webkitAudioContext,null==this.audioContext&&(this.audioContext=new AudioContext),null!=this.soundMeter&&this.soundMeter.stop(),this.soundMeter=new SoundMeter(this.audioContext),this.soundMeter.isConnected=!1,this.soundMeter.connectToSource(this.stream,a=>{this.soundMeter.isConnected=!0;a||cc.log("intSoundMeter done")}),this.initAudioRecorder()}catch(a){}},stopSoundMeter:function(){this.soundMeter&&(this.soundMeter.stop(),
this.soundMeter=null)},initAudioRecorder:function(){1==this.isInitAudioRecorder||this.isMobile()||(this.isInitAudioRecorder=!0,cc.loadJs(["https://azota889.github.io/storage_public/almo/vmsg.js?ver=123"],()=>{this.audioRecorder=new Recorder({wasmURL:"https://azota889.github.io/storage_public/almo/vmsg.wasm",isInitComplete:!1,lastVolumeMeter:-1,lastTimeRecord:-1,isRecording:!1},()=>{cc.log("on audio recorder stop");this.onStopRecordAudio()});this.audioRecorder.initAudio().then(()=>this.audioRecorder.initWorker()).then(()=>
{cc.log("init audioRecorder ok");this.audioRecorder.opts.isInitComplete=!0}).catch(a=>{console.log("error init audioRecorder")})}))},startRecordAudio:function(){this.audioRecorder&&(this.audioRecorder.opts.isRecording=!0,this.audioRecorder.opts.lastTimeRecord=(new Date).getTime(),this.audioRecorder.startRecording(),cc.log("start record audio !"))},stopRecordAudio:function(){this.audioRecorder&&(this.audioRecorder.stopRecording(),this.audioRecorder.opts.isRecording=!1,cc.log("stop record audio !"))},
onStopRecordAudio:function(){var a=new FileReader;a.onload=()=>{var b=a.result,c={v:this.version(),resultid:this.options.resultid,deviceInfo:{osName:this.deviceInfo.osName,browserName:this.deviceInfo.browser.name},timestamp:[],warning:{},isWarning:!0,startTime:this.audioRecorder.opts.lastTimeRecord,time:(new Date).getTime()};c=btoa(JSON.stringify(c));b=b.substring(23,b.length);this._running&&(b=this.encodeStrM(b,c))&&(cc.log("push size "+b.encryptStr.length),this._queueStoreContent.push({type:"audio",
timestamp:[],warning:{},isWarning:!0,content:b.encryptStr,key:b.k,startTime:this.audioRecorder.opts.lastTimeRecord,endTime:(new Date).getTime()}),this._uploadStoreContent())};a.readAsDataURL(this.audioRecorder.blob)},initFaceEyeDetection:function(){this.isMobile()||!this.isMobile()||this.w||("undefined"!==typeof Worker?("undefined"==typeof this.w&&(this.w=new Worker("/assets/js/worker.js?ver=1.6")),this.w.onmessage=a=>{a=a.data;"opencvloaded"==a.cmd&&(cc.log("opencv_loaded"),this.isMobile()?this.w.postMessage({cmd:"processiniteye"}):
this.w.postMessage({cmd:"processinitface"}));"processimage"==a.cmd&&this.faceEyesDetectResult(a.obj);if("processscreen"==a.cmd){a=a.obj.imageData;var b=document.createElement("canvas");b.width=400;b.height=250;b.getContext("2d").putImageData(a,0,0);document.body.appendChild(b)}}):cc.log("browser not support worker"))},faceEyesDetectResult:function(a){var b=this.isMobile()?a.foundEye.length:a.foundFace.length;0==b||1<b?(this.previewWarning.style.display="none",this.previewWarning.style.backgroundColor=
"red",a.currStartTime==this.canvasDrawCurr.startTime&&(cc.log("push curr warning "+a.currIndex+":"+b),this.canvasDrawCurr.isWarning=!0,this.canvasDrawCurr.warning[a.currIndex]=b),a.storeStartTime==this.canvasDraw.startTime&&(cc.log("push store warning "+a.storeIndex+":"+b),this.canvasDraw.isWarning=!0,this.canvasDraw.warning[a.storeIndex]=b)):this.previewWarning.style.display="none"},detectFaceEye:function(a){this.w&&this.w.postMessage({cmd:"processimage",obj:a})},initUrlUploadPublic:function(a,b){cc.log("getUrlPublic");
var c=a.config.domainApi+a.config.urlGetPublicForLive;a.urlDownload="";a.urlCurr="";a.urlOffer="";this.getPublicUpload(c,a.user.token,a.roomid,0,a.user.userid,a.user.userid+"_"+a.user.studentid+"_curr.txt",1,0,a.lckeyCurr,(d,e,f,l,p)=>{d&&""!=d?(a.urlCurr=d,d=e.indexOf(a.roomid),0<=d&&(a.urlDownload=e.substr(0,d)),a.remoteKeyCurr=f,a.prefixName=l.replaceAll("_"+a.user.userid+"_"+a.user.studentid+"_curr.txt",""),a.mykey=p,this.getPublicUpload(c,a.user.token,a.roomid,0,a.user.userid,a.user.userid+"_"+
a.user.studentid+"_offer.txt",1,0,a.lckeyOffer,(n,w,x)=>{n&&""!=n?(a.urlOffer=n,a.remoteKeyOffer=x,setTimeout(()=>{b&&b()},100)):(cc.log("getOffer url "+n),a.getUrlPublicTry++,0!=this._state&&5>a.getUrlPublicTry?setTimeout(()=>{this.initUrlUploadPublic(a,b)},5E3):setTimeout(()=>{b&&b()},100))})):(cc.log("getCurr url "+d),a.getUrlPublicTry++,0!=this._state&&5>a.getUrlPublicTry?setTimeout(()=>{this.initUrlUploadPublic(a,b)},5E3):setTimeout(()=>{b&&b()},100))})},getLastCurr:function(a){var b=new XMLHttpRequest;
b.onreadystatechange=()=>{4==b.readyState&&(200==b.status?(this.deviceInfo.browseri=cc.randomUUID().replaceAll("-",""),a&&a(!0,this.deviceInfo.browseri)):(this.deviceInfo.browseri=cc.randomUUID().replaceAll("-",""),a&&a(!1)))};var c=this.options.prefixName+"_"+this.options.user.userid+"_"+this.options.user.studentid+"_curr.txt";cc.log("filename curr :"+c);c=this.options.urlDownload+this.options.roomid+"/"+this.options.user.userid+"/public/"+c+"?t="+(new Date).getTime();cc.log("link get curr "+c);
b.open("GET",c);b.send()},startUploadFl:function(){if(this.options.urlUploadFl)this._uploadFl();else{var a=this.options;this.getPublicUpload(a.config.urlGetPublicForLive,a.user.token,a.roomid,a.resultid,a.user.userid,a.user.userid+"_"+a.user.studentid+"_"+a.resultid+"_fl.txt",1,0,cc.randomStr(5),(b,c)=>{b&&""!=b&&(this.options.urlUploadFl=b,this._uploadFl())})}},_uploadFl:function(){if(this.options.urlUploadFl){cc.log("uploadFl "+this.options.urlUploadFl);var a=this.options,b=btoa(JSON.stringify({resultid:this.options.resultid,
arrStoreFile:this._arrStoreFile})),c=cc.randomUUID();c=btoa(c).substr(0,10);b=CryptoJS.AES.encrypt(c+b,this.options.mykey).toString();this.uploadPublicContent(a.urlUploadFl,a.user.userid+"_"+a.user.studentid+"_"+a.resultid+"_fl.txt",b,(d,e)=>{cc.log("upload fl ok")})}},getLastFl:function(a){var b=new XMLHttpRequest;b.onreadystatechange=()=>{if(4==b.readyState){if(200==b.status){if(this._isGetLastCurr)return;try{var c=CryptoJS.AES.decrypt(b.responseText,this.options.mykey).toString(CryptoJS.enc.Utf8),
d=c.substring(10,c.length),e=JSON.parse(atob(d));e.resultid==this.options.resultid&&(this._arrStoreFile=e.arrStoreFile.concat(this._arrStoreFile),cc.log("arrStoreFile "+JSON.stringify(this._arrStoreFile)))}catch(f){cc.log("expception get listfile ")}}a&&a()}};b.open("GET",this.options.urlDownload+this.options.roomid+"/"+this.options.user.userid+"/public/"+this.options.resultid+"/"+(this.options.prefixName+"_"+this.options.user.userid+"_"+this.options.user.studentid+"_"+this.options.resultid+"_fl.txt?t=")+
(new Date).getTime());b.send()},getLastOffer:function(a){var b=new XMLHttpRequest;b.onreadystatechange=()=>{4==b.readyState&&(200==b.status?a&&a(!0):a&&a(!1))};b.open("GET",this.options.urlDownload+this.options.roomid+"/"+this.options.user.userid+"/public/"+(this.options.prefixName+"_"+this.options.user.userid+"_"+this.options.user.studentid+"_offer.txt?t=")+(new Date).getTime());b.send()},initFirestoreEvent:function(){this.options.firebaseApp&&(this.options.roomid!=this.lastStudentSubcribleRoomId?
(this.lastStudentSubcribleRoomId&&this.examLiveTeachers_student_unbsubscribe(this.lastStudentSubcribleRoomId),this.lastStudentSubcribleRoomId=this.options.roomid,this.examLiveTeachers_student_subscribe(this.options.roomid,a=>{this.onGetTeacherControl(a)})):cc.log("not change roomid , no need subcrible"));this.options.firebaseApp&&(this.options.user.userid!=this.lastStudentSubcribleUserId?(this.lastStudentSubcribleUserId&&this.examLiveStudents_student_unbsubscribe(this.lastStudentSubcribleUserId),
this.lastStudentSubcribleUserId=this.options.roomid,this.examLiveStudents_student_subscribe(this.options.roomid,a=>{this.onGetStudentInfoFromStudent(a)})):cc.log("not change roomid , no need subcrible"))},onGetTeacherControl:function(a){cc.log("student get teacher control "+JSON.stringify(a));if(0!=this._state){cc.log("myId "+this.options.user.userid);this.isUpdateRealtime=!1;try{if(1==a.success){var b=a.data;for(a=0;a<b.length;a++){var c=b[a].arr.split(",");for(a=0;a<c.length;a++)c[a].toString()==
this.options.user.userid.toString()&&(this.isUpdateRealtime=!0)}}}catch(d){cc.log("exception receive teacher control")}this.isUpdateRealtime&&this._lastCurrContent&&(cc.log("change to upload realtime"),this._lastCurrContent&&this.uploadPublicContent(this.options.urlCurr,"curr.txt",this._lastCurrContent,d=>{cc.log("upload curr ok "+d)}))}},onGetStudentInfoFromStudent:function(a){cc.log("student get student info from teacher "+JSON.stringify(a));if(this._running)try{if(1==a.success){if(a.data){var b=
a.data;cc.log("get ans "+b.ans+":"+b.ans_scr);b.ans&&this.conn&&this.conn.isUsed&&(cc.log("get answer conn"),this.conn.getAnswerIntv())}}else setTimeout(()=>{this.examLiveStudents_student_subscribe(this.options.roomid,c=>{this.onGetStudentInfoFromStudent(c)})},1500)}catch(c){cc.log("exception student get student info from teacher")}},showQrCodeExCam:function(){if(!this.isShowQrCodeExCam){this.isShowQrCodeExCam=!0;if(null==this.divExamQrCodeExCam){var a=document.createElement("div");a.style.width=
"450px";a.style.height="500px";a.style.position="fixed";a.style.backgroundColor="white";a.style.border="1px solid gray";a.style.left=window.innerWidth-450+"px";a.style.zIndex="9999999999";a.style.top="0px";var b=document.createElement("div");b.style.position="absolute";b.style.width="100%";b.style.paddingLeft="20px";b.textContent="D\u00f9ng \u0111i\u1ec7n tho\u1ea1i qu\u00e9t m\u00e3 qrcode \u0111\u1ec3 k\u1ebft n\u1ed1i v\u1edbi camera \u0111i\u1ec7n tho\u1ea1i .     Qu\u00e1 tr\u00ecnh k\u1ebft n\u1ed1i c\u00f3 th\u1ec3 m\u1ea5t t\u1eeb 10-15 gi\u1ea5y . ";
b.style.top="25px";b.style.textAlign="center";a.appendChild(b);b=document.createElement("div");b.style.position="absolute";b.style.width="350px";b.style.height="350px";b.style.left="50px";b.style.top="75px";b.style.display="flex";b.style.justifyContent="center";b.style.alignItems="center";b.textContent="\u0110ang t\u1ea1o m\u00e3 qr";a.appendChild(b);b=document.createElement("div");b.style.position="absolute";b.style.width="350px";b.style.height="350px";b.style.left="55px";b.style.top="75px";b.style.border=
"1px solid #CCCCCC";b.style.pointerEvents="none";a.appendChild(b);this.divQr=b;this.btClose=this.createButton(150,30,"\u0110\u00d3NG","#F39D13",13);this.btClose.style.fontFamily="Arial";this.btClose.style.position="absolute";this.btClose.style.left="150px";this.btClose.style.top="450px";this.btClose.addEventListener("mouseup",d=>{this.closeQrCodeExam()});a.appendChild(this.btClose);this.divExamQrCodeExCam=a}null==this.divExamQrCodeExCam.parentNode&&document.body.appendChild(this.divExamQrCodeExCam);
var c=this.options;""==this.options.user.userid&&(c=this._optionsPreparing);c.excamkey=cc.randomStr(30);null==c.qrsign?this.get_token_for_qr_live(c.user.token,d=>{cc.log("on get token for qr live");if(""==d)alert("Kh\u00f4ng l\u1ea5y \u0111\u01b0\u1ee3c d\u1eef li\u1ec7u qrcode !");else try{var e=JSON.parse(d);1==e.success&&(c.qrsign=e.data,this.divQr.textContent="",new QRCode(this.divQr,{text:window.location.hostname+"/cam.html?userid="+c.user.userid+"&fn="+c.excamkey+"&tk="+c.qrsign+"&roomid="+
c.roomid+"&resultid="+c.resultid,width:350,height:350,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))}catch(f){cc.log("error parse qrsign")}}):(this.divQr.textContent="",new QRCode(this.divQr,{text:window.location.hostname+"/cam.html?userid="+c.user.userid+"&fn="+c.prefixName+"&tk="+c.qrsign+"&roomid="+c.roomid+"&resultid="+c.resultid+"&studentid=0",width:350,height:350,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}));this.btExcam.style.display=
"none";this._initConnExCam()}},closeQrCodeExam:function(){this.isShowQrCodeExCam=!1;this.divExamQrCodeExCam&&this.divExamQrCodeExCam.parentNode&&this.divExamQrCodeExCam.parentNode.removeChild(this.divExamQrCodeExCam);if(this.connExCam){var a=this.connExCam.stateConnection();if("close"==a||"notstart"==a)this.btExcam.style.display="flex"}},_initConn:function(){if(this._running){var a=!0;this.stream?0==this.stream.getVideoTracks().length&&(a=!1):a=!1;if(0!=a||null!=this.screenStream||null!=this.connExCam){cc.log("initConn");
null==this.conn?(this.conn=new aztExam.RTCConnection(this),this.conn.addCEventListener("uploadOffer",()=>{this.getLastOffer(e=>{e?this.getLastFl(()=>{this._isGetLastCurr=!0}):this.showToolTip("Kh\u00f4ng t\u1ea3i \u0111\u01b0\u1ee3c d\u1eef li\u1ec7u xu\u1ed1ng ! Vui l\u00f2ng li\u00ean h\u1ec7 v\u1edbi admin \u0111\u1ec3 \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 . ",-1)})}),this.conn.addCEventListener("datachannelopen",()=>{this.sendStreamInfo()}),this.conn.addCEventListener("onmessages",(e,f)=>{cc.log("onmessages"+
JSON.stringify(f));f.cmd="forceUpload";"screen"==f.data&&this._captureScreen(!0,!0);"webcam"!=f.data&&"excam"!=f.data||this._processDraw(!0)})):this.conn.reset();var b={upload:this.options.urlOffer,download:""},c={upload:"",download:this.options.urlDownload+this.options.roomid+"/"+this.options.user.userid+"/public/"+(this.options.prefixName+"_"+this.options.user.userid+"_"+this.options.user.studentid+"_answer.txt")},d=null;null!=this.stream&&a?d=this.stream:null!=this.screenStream?d=this.screenStream:
this.connExCam&&this.connExCam.remoteStream&&(d=this.connExCam.remoteStream);this.conn.start(this.options.user,null,"offer",b,c,d,this.options.firebaseApp?!1:!0,this.options.mykey)}}},_initConnScreen:function(){},_initConnExCam:function(){cc.log("initConnExtCamera");null==this.connExCam?(this.connExCam=new aztExam.RTCConnection(this),this.connExCam.resizeUI(120,160),this.videoExCamCont.appendChild(this.connExCam.ui),this.connExCam.txtConnecting.style.backgroundColor="gray",this.connExCam.txtConnecting.style.fontSize=
"13px",this.connExCam.addCEventListener("stateChange",()=>{var d=this.connExCam.stateConnection();"connected"==d&&(null==this.conn&&this._initConn(),this.closeQrCodeExam(),this.sendStreamInfo(),this.videoExCamCont.style.display="block",this.btExcam.style.display="none",this._running&&(this.preview.style.transform="scale(0.8)"));if("close"==d||"notstart"==d)this.sendStreamInfo(),this.videoExCamCont.style.display="none",this.btExcam.style.display="flex",this._running&&(this.preview.style.transform=
"scale(1)");"connecting"==d&&(this.sendStreamInfo(),this.videoExCamCont.style.display="block",this.btExcam.style.display="none",this._running&&(this.preview.style.transform="scale(0.8)"))})):this.connExCam.reset();var a=this.options,b="";""==this.options.user.userid?(b=this._optionsPreparing.config.domainApi+this._optionsPreparing.config.urlGetPublicForLive,a=this._optionsPreparing):b=this.options.config.urlGetPublicForLive;if(null==this.options.urlUploadExcam)this.getPublicUpload(b,a.user.token,
a.roomid,0,a.user.userid,a.user.userid+"_answer_cam.txt",1,0,cc.randomStr(5),d=>{this.urlUploadExcam=d;var e={upload:"",download:a.urlDownload+a.roomid+"/"+a.user.userid+"/public/"+this.options.prefixName+"_"+a.user.userid+"_offer_cam.txt"};d={upload:d,download:""};this._updateSizeExcamDraw(a.config.storeUpdateSize);this.connExCam.start(a.user,a.user,"answer",e,d,null,!0,(new Date).getTime(),a.excamkey)});else{b={upload:"",download:a.urlDownload+a.roomid+"/"+a.user.userid+"/public/"+this.options.prefixName+
a.user.userid+"_offer_cam.txt"};var c={upload:this.urlUploadExcam,download:""};this._updateSizeExcamDraw(a.config.storeUpdateSize);this.connExCam.start(a.user,a.user,"answer",b,c,null,!0,(new Date).getTime(),a.excamkey)}},sendStreamInfo:function(){this.conn&&this.conn.isDataChannelOpen&&(cc.log("sendStreamInfo"),this.conn.sendMessages({cmd:"infoStream",isWebcam:this.stream?!0:!1,isScreen:this.screenStream?!0:!1,isExcam:this.connExCam&&this.connExCam.remoteStream?!0:!1}))},_startMonitoring:function(){cc.log("start monitoring "+
this.options.user.userid+":"+this.options.user.studentid+":"+this.options.user.username);this._running=!0;this._countProcessDraw=0;this._queueStoreContent=[];this.preview.style.transform="none"!=this.videoExCamCont.style.display?"scale(0.68)":"scale(1)";this.divContVideo.style.justifyContent="end";cc.isMobile()&&(this.preview.style.marginLeft="0px");this._update();this._captureScreen()},_stopMonitoring:function(){cc.log("stop monitoring");this.divContVideo.style.justifyContent="center";this._queueStoreContent=
[];this._running=!1;this.preview.style.transform="scale(1)";clearInterval(this.audioRecordIntv);this.stopRecordAudio();this.lastTimeStartAudioRecord=this.lastSoundMeterVal=-1},_update:function(){var a=(new Date).getTime();this._lastTimeDraw?a>this._lastTimeDraw&&1E3<a-this._lastTimeDraw&&(this._processDraw(),this._lastTimeDraw=a):this._lastTimeDraw=a;this.soundMeter&&this.audioRecorder&&this.audioRecorder.opts.isInitComplete&&(a=Number(this.soundMeter.instant.toFixed(5)),0<this.audioRecorder.opts.lastVolumeMeter&&
.003<a&&a>5*this.audioRecorder.opts.lastVolumeMeter&&6E4<(new Date).getTime()-this.audioRecorder.opts.lastTimeRecord&&(this.startRecordAudio(),clearInterval(this.audioRecordIntv),this.audioRecordIntv=setInterval(()=>{clearInterval(this.audioRecordIntv);this.stopRecordAudio()},1E4)),this.audioRecorder.opts.lastVolumeMeter=a);this._running&&setTimeout(()=>{this._update()},1200)},_updateSizePreview:function(){this.canvasPreview.width=this._imageCaptureWidth;this.canvasPreview.height=this._imageCaptureHeight},
_updateSizeCurrDraw:function(a){cc.log("updateSizeCurrDraw "+a);a=this.options.config;this.canvasDrawCurr.width=a.currentUpdateSize*a.currentUpdateSize*this._imageCaptureWidth;this.canvasDrawCurr.height=this._imageCaptureHeight;this.canvasDrawCurr.cols=a.currentUpdateSize*a.currentUpdateSize;this.canvasDrawCurr.rows=1;this.canvasDrawCurr.imageWidth=this._imageCaptureWidth;this.canvasDrawCurr.imageHeight=this._imageCaptureHeight;this.ctxDrawCurr.clearRect(0,0,this.canvasDrawCurr.width,this.canvasDrawCurr.height);
this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1},_updateSizeStoreDraw:function(a){cc.log("updateSizeStoreDraw "+a);a=this.options.config;this.canvasDraw.width=a.storeUpdateSize*a.storeUpdateSize*this._imageCaptureWidth;this.canvasDraw.height=this._imageCaptureHeight;this.canvasDraw.cols=a.storeUpdateSize*a.storeUpdateSize;this.canvasDraw.rows=1;this.canvasDraw.imageWidth=this._imageCaptureWidth;this.canvasDraw.imageHeight=
this._imageCaptureHeight;this.ctxDraw.clearRect(0,0,this.canvasDraw.width,this.canvasDraw.height);this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning={};this.canvasDraw.isWarning=!1},_updateSizeScreenDraw:function(a){if(this.screenStream||0!=this.screenStream.getVideoTracks.length){var b=this.options.config,c=this.videoScreen.videoWidth,d=this.videoScreen.videoHeight;c=0==c?400:c;var e=400/c;c=Math.floor(c*e);d=Math.floor((0==d?225:d)*e);this.canvasScreen.screenWidth=c;
this.canvasScreen.screenHeight=d;c+=this._imageCaptureWidth;d=this._imageCaptureHeight+160>d?this._imageCaptureHeight+160:d;cc.log("updateSizeStoreDraw "+a+":"+c+":"+d);this.canvasScreen.width=b.screenUpdateSize*c;this.canvasScreen.height=d;this.canvasScreen.cols=b.screenUpdateSize;this.canvasScreen.rows=1;this.canvasScreen.imageWidth=c;this.canvasScreen.imageHeight=d;this.canvasStreamCapture.width=c;this.canvasStreamCapture.height=d;this.ctxScreen.clearRect(0,0,this.canvasScreen.width,this.canvasScreen.height);
this.canvasScreen.numDraw=0;this.canvasScreen.timestamp=[];this.canvasScreen.warning={};this.canvasScreen.isWarning=!1}},_updateSizeExcamDraw:function(a){a=this.options.config;this.canvasExCam.width=a.storeUpdateSize*a.storeUpdateSize*120;this.canvasExCam.height=160;this.canvasExCam.cols=a.storeUpdateSize*a.storeUpdateSize;this.canvasExCam.rows=1;this.canvasExCam.imageWidth=120;this.canvasExCam.imageHeight=160;this.ctxExCam.clearRect(0,0,this.canvasExCam.width,this.canvasExCam.height);this.canvasExCam.numDraw=
0;this.canvasExCam.timestamp=[];this.canvasExCam.warning={};this.canvasExCam.isWarning=!1},_captureScreenByTeacher:function(){},_captureScreen:function(a,b){if(this.screenStream&&this._hasVideoScreenPlaying&&this._running){cc.log("draw screen "+this.canvasScreen.numDraw+":"+this.canvasScreen.imageWidth+":"+this.canvasScreen.imageHeight);var c=(new Date).getTime(),d=this.canvasScreen.numDraw;this.ctxScreen.drawImage(this.videoScreen,0,0,this.videoScreen.videoWidth,this.videoScreen.videoHeight,d*this.canvasScreen.imageWidth+
this._imageCaptureWidth,0,this.canvasScreen.screenWidth,this.canvasScreen.screenHeight);this.ctxScreen.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,d*this.canvasScreen.imageWidth,0,this.canvasPreview.width,this.canvasPreview.height);this.connExCam&&this.connExCam.remoteStream&&this.connExCam.videoEl&&this.ctxScreen.drawImage(this.connExCam.videoEl,d*this.canvasScreen.imageWidth+10,this._imageCaptureHeight+10,this.canvasExCam.imageWidth,this.canvasExCam.imageHeight-
20);0==this.canvasScreen.numDraw&&(this.canvasScreen.startTime=c);this.canvasScreen.numDraw++;this.canvasScreen.timestamp.push(c);if(this.canvasScreen.numDraw==this.options.config.screenUpdateSize||1==b)cc.log("upload screeen"+this.canvasScreen.numDraw+":"+this.options.config.screenUpdateSize),c=this._toStrCanvasDraw(this.canvasScreen),(c=this.encodeStrM(c.strBase64Media,c.strBase64Info))&&this._queueStoreContent.push({type:"screen",timestamp:JSON.parse(JSON.stringify(this.canvasScreen.timestamp)),
warning:JSON.parse(JSON.stringify(this.canvasScreen.warning)),isWarning:this.canvasScreen.isWarning,content:c.encryptStr,key:c.k,startTime:this.canvasScreen.startTime,endTime:(new Date).getTime()}),this._uploadStoreContent(b),this.ctxScreen.clearRect(0,0,this.canvasScreen.width,this.canvasScreen.height),this.canvasScreen.numDraw=0,this.canvasScreen.timestamp=[],this.canvasScreen.warning={},this.canvasScreen.isWarning=!1;a||setTimeout(()=>{this._captureScreen()},1E4)}},_processDraw:function(a){if(this._running){this._countProcessDraw++;
var b=this.options.config,c=(new Date).getTime();this.ctxPreview.fillStyle="black";this.ctxPreview.fillRect(0,0,this.canvasPreview.width,this.canvasPreview.height);if(this._hasVideoReviewPlaying&&0<this.videoWidth&&0<this.videoHeight){var d=Math.floor(this.videoHeight*this.canvasPreview.width/this.videoWidth);this.isMobile()?this.ctxPreview.drawImage(this.videoReview,0,0,this.canvasPreview.width,this.canvasPreview.height):this.ctxPreview.drawImage(this.videoReview,0,0,this.videoWidth,this.videoHeight,
0,0,this.canvasPreview.width,d)}var e=b.currentUpdateSize;d=b.storeUpdateSize;var f=this.canvasDraw.numDraw;this.ctxDrawCurr.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,this.canvasDrawCurr.numDraw*this.canvasDrawCurr.imageWidth,0*this.canvasDrawCurr.imageHeight,this.canvasDrawCurr.imageWidth,this.canvasDrawCurr.imageHeight);0==this.canvasDrawCurr.numDraw&&(this.canvasDrawCurr.startTime=c);this.canvasDrawCurr.numDraw++;this.canvasDrawCurr.timestamp.push(c);0==
this._countProcessDraw%8&&(this.ctxCanvasStreamCapture.clearRect(0,0,this.canvasStreamCapture.width,this.canvasStreamCapture.height),this.ctxCanvasStreamCapture.drawImage(this.videoReview,0,0,this.canvasStreamCapture.width,this.canvasStreamCapture.height),this.ctxDraw.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,f*this.canvasDraw.imageWidth,0*this.canvasDraw.imageHeight,this.canvasDraw.imageWidth,this.canvasDraw.imageHeight),0==this.canvasDraw.numDraw&&(this.canvasDraw.startTime=
c),this.canvasDraw.numDraw++,this.canvasDraw.timestamp.push(c),this.connExCam&&null!=this.connExCam.videoEl&&(this.ctxExCam.drawImage(this.connExCam.videoEl,this.canvasExCam.numDraw*this.canvasExCam.imageWidth,0,this.canvasExCam.imageWidth,this.canvasExCam.imageHeight),0==this.canvasExCam.numDraw&&(this.canvasExCam.startTime=c),this.canvasExCam.numDraw++,this.canvasExCam.timestamp.push(c)));if(this.canvasDrawCurr.numDraw==e*e){if(this.isUpdateRealtime){cc.log("upload curr"+this.canvasDrawCurr.numDraw+
":"+b.currentUpdateSize+":"+b.storeUpdateSize);this._lastCurrContent=this._toStrCanvasDraw(this.canvasDrawCurr);var l=this.encodeStrN(this.options.lckeyCurr,this.options.remoteKeyCurr,this._lastCurrContent.strBase64Media,this._lastCurrContent.strBase64Info);c=Math.floor(5*Math.random());cc.log("upload size "+l.length+":"+c);setTimeout(()=>{this.uploadPublicContent(this.options.urlCurr,this.options.user.userid+"_"+this.options.user.studentid+"_curr.txt",l,p=>{cc.log("upload curr ok "+p)})},1E3*c)}this.ctxDrawCurr.clearRect(0,
0,this.canvasDrawCurr.width,this.canvasDrawCurr.height);this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1}if(this.canvasDraw.numDraw==d*d||1==a){c=this._toStrCanvasDraw(this.canvasDraw);cc.log("push store "+this.canvasDraw.numDraw+":"+b.currentUpdateSize+":"+b.storeUpdateSize);if(c=this.encodeStrM(c.strBase64Media,c.strBase64Info))cc.log("push size "+c.encryptStr.length),this._queueStoreContent.push({type:"webcam",timestamp:JSON.parse(JSON.stringify(this.canvasDraw.timestamp)),
warning:JSON.parse(JSON.stringify(this.canvasDraw.warning)),isWarning:this.canvasDraw.isWarning,content:c.encryptStr,key:c.k,startTime:this.canvasDraw.startTime,endTime:(new Date).getTime()});this._uploadStoreContent(a);this.ctxDraw.clearRect(0,0,this.canvasDraw.width,this.canvasDraw.height);this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning={};this.canvasDraw.isWarning=!1}if(this.canvasExCam.numDraw==d*d||1==a){c=this._toStrCanvasDraw(this.canvasExCam);cc.log("push store excam "+
this.canvasExCam.numDraw+":"+b.currentUpdateSize+":"+b.storeUpdateSize);if(c=this.encodeStrM(c.strBase64Media,c.strBase64Info))cc.log("push size excam"+c.encryptStr.length),this._queueStoreContent.push({type:"excam",timestamp:JSON.parse(JSON.stringify(this.canvasExCam.timestamp)),warning:JSON.parse(JSON.stringify(this.canvasExCam.warning)),isWarning:this.canvasExCam.isWarning,content:c.encryptStr,key:c.k,startTime:this.canvasExCam.startTime,endTime:(new Date).getTime()});this._uploadStoreContent(a);
this.ctxExCam.clearRect(0,0,this.canvasExCam.width,this.canvasExCam.height);this.canvasExCam.numDraw=0;this.canvasExCam.timestamp=[];this.canvasExCam.warning={};this.canvasExCam.isWarning=!1}}},_toStrCanvasDraw:function(a){(new Date).getTime();var b=a.toDataURL("image/jpeg",15),c=(new Date).getTime(),d=!1,e=!1;null!=this.stream&&0<this.stream.getVideoTracks().length&&(d=!0);null!=this.stream&&0<this.stream.getAudioTracks().length&&(e=!0);a={v:this.version(),c:a.cols,r:a.rows,numImage:a.numDraw,w:a.imageWidth,
h:a.imageHeight,resultid:this.options.resultid,im:this.isMobile(),deviceInfo:{browseri:this.deviceInfo.browseri,osName:this.deviceInfo.osName,browserName:this.deviceInfo.browser.name,hasWebcam:this.deviceInfo.hasWebcam,hasMicrophone:this.deviceInfo.hasMicrophone,isWebsiteHasWebcamPermissions:d,isWebsiteHasMicrophonePermissions:e,isWebsiteHasShareScreenPermission:this.isMobile()?!1:DetectRTC.isScreenCapturingSupported,hasShareScreen:null!=this.screenStream?!0:!1,hasExCam:this.connExCam&&this.connExCam.remoteStream?
!0:!1},startTime:a.startTime,time:c,timeStr:(new Date).toUTCString(),timestamp:JSON.parse(JSON.stringify(a.timestamp)),warning:JSON.parse(JSON.stringify(a.warning)),isWarning:a.isWarning};a=btoa(JSON.stringify(a));b=b.substring(23,b.length);return{strBase64Media:b,strBase64Info:a}},_uploadStoreContent:function(a){if(0<this._queueStoreContent.length){var b=this._queueStoreContent.shift(),c=(new Date).getTime();"webcam"==b.type&&(c+=".azt_wc");"screen"==b.type&&(c+=".azt_scr");"excam"==b.type&&(c+=
".azt_exca");"audio"==b.type&&(c+=".azt_aud");var d=5+1E3*Math.floor(20*Math.random());1==a&&(d=10);cc.log("upload store queue rand "+b.content.length+":"+d);setTimeout(()=>{this.uploadContent(c,b.content,0,1,b.key,(e,f)=>{cc.log("upload store queue ok "+f);""!=f&&(a&&this.conn&&this.conn.sendMessages({cmd:"forceUploadComplete"}),0==this._queueStoreContent.length&&(this._arrStoreFile.push({path:f,time:(new Date).getTime(),startTime:b.startTime,endTime:b.endTime,warning:JSON.parse(JSON.stringify(b.warning)),
timestamp:JSON.parse(JSON.stringify(b.timestamp)),isWarning:b.isWarning}),this.startUploadFl()))});this._uploadStoreContent()},d)}else cc.log("upload store content empty")},role:function(){return"student"}});aztExam.MonitorStudent=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorStudent(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();aztExam=aztExam||{};
aztExam.monitorTeacherHistory=cc.Node.extend({conn:null,user:null,resultObj:null,files:null,loadIndex:0,pageIndex:0,pageMax:10,cache:null,lasttimeRefresh:-1,countDown:120,arrCanvasFace:null,ctor:function(a){this._super();this.monitor=a;window.addEventListener("resize",()=>{this.onresize()});this.initUI();this.arrCanvasFace=[];this.initFaceApi()},initUI:function(){this.ui=document.createElement("div");this.ui.style.width="100%";this.ui.style.height="100%";this.ui.style.fontFamily="sans-serif";this.ui.style.fontSize=
"14px";this.ui.style.lineHeight="18px";this.ui.style.color="white";this.ui.style.overflow="hidden";this.ui.style.position="absolute";this.ui.style.top="0px";this.ui.style.left="0px";this.ui.style.backgroundColor="#222222";this.header=this.findDom(document.createElement("div"));this.header.css("width","100%");this.header.css("height","60px");this.header.css("border-bottom","1px solid black");this.header.css("position","fixed");this.header.css("display","none");this.header.css("top","0px");this.header.css("background-color",
"#333434");this.ui.appendChild(this.header);this.realtimeView=document.createElement("div");this.realtimeView.style.position="absolute";this.realtimeView.style.overflow="hidden";this.realtimeView.style.width="320px";this.realtimeView.style.height="100%";this.realtimeView.style.backgroundColor="#4c4b4b";this.ui.appendChild(this.realtimeView);this.initRealtimeView();this.infoView=document.createElement("div");this.infoView.style.position="absolute";this.infoView.style.width=window.innerWidth-340+"px";
this.infoView.style.left="340px";this.infoView.style.top="10px";this.infoView.style.height="100%";this.infoView.style.overflowX="hidden";this.infoView.style.overflowY="scroll";this.ui.appendChild(this.infoView);this.infoDevice=document.createElement("div");this.infoDevice.style.position="relative";this.infoDevice.style.width="100%";this.infoDevice.style.height="auto";this.infoView.appendChild(this.infoDevice);this.infoFile=document.createElement("div");this.infoFile.style.position="relative";this.infoFile.style.width=
window.innerWidth-360+"px";this.infoFile.style.height="auto";this.infoFile.style.marginTop="30px";this.infoView.appendChild(this.infoFile);this.btBack=this.monitor.createButton(120,36,"QUAY L\u1ea0I","#1A84E3",14);this.btBack.css("position","absolute");this.btBack.css("cursor","pointer");this.btBack.css("top","20px");this.btBack.css("right","20px");this.btBack.addEventListener("mouseup",a=>{this.clearAll();this.hide();this.monitor.loop()});this.ui.appendChild(this.btBack);this.initRealtimeFullscreen();
this.hide()},initRealtimeFullscreen:function(){this.realtimeFullscreen=document.createElement("div");this.realtimeFullscreen.style.backgroundColor="#111111DD";this.realtimeFullscreen.style.width=window.innerWidth+"px";this.realtimeFullscreen.style.height=window.innerHeight+"px";this.realtimeFullscreen.style.position="absolute";this.realtimeFullscreen.style.top="0px";this.realtimeFullscreen.style.left="0px";this.realtimeFullscreen.style.display="none";this.realtimeFullscreen.style.zIndex=9999;this.ui.appendChild(this.realtimeFullscreen);
this.headerFullscreen=this.findDom(document.createElement("div"));this.headerFullscreen.css("width","100%");this.headerFullscreen.css("height","60px");this.headerFullscreen.css("border-bottom","1px solid black");this.headerFullscreen.css("position","fixed");this.headerFullscreen.css("display","block");this.headerFullscreen.css("top","0px");this.headerFullscreen.css("background-color","#333434");this.realtimeFullscreen.appendChild(this.headerFullscreen);this.doneFullscreen=this.monitor.createButton(120,
36,"XONG","#1A84E3",14);this.doneFullscreen.css("position","absolute");this.doneFullscreen.css("cursor","pointer");this.doneFullscreen.css("top","12px");this.doneFullscreen.css("left","2px");this.doneFullscreen.addEventListener("mouseup",a=>{this.hideRealtimeFullscreen()});this.headerFullscreen.appendChild(this.doneFullscreen);this.captureFullscreen=this.monitor.createButton(250,36,"CH\u1ee4P L\u1ed6I","red",14);this.captureFullscreen.css("position","absolute");this.captureFullscreen.css("cursor",
"pointer");this.captureFullscreen.css("top","12px");this.captureFullscreen.css("left","200px");this.captureFullscreen.addEventListener("mouseup",a=>{this.conn&&this.conn.sendMessages({cmd:"forceUpload",data:this.currStream})});this.headerFullscreen.appendChild(this.captureFullscreen)},initRealtimeView:function(){var a=(window.innerHeight-90)/3,b=document.createElement("div");b.style.backgroundColor="#333434";b.style.width="100%";b.style.height="30px";b.style.lineHeight="30px";b.style.color="white";
b.textContent="Webcam";b.style.paddingLeft="20px";b.style.position="relative";this.webcamSpanTitle=b;this.realtimeView.appendChild(b);this.webcamRealtime=document.createElement("div");this.webcamRealtime.style.width="100%";this.webcamRealtime.style.height=(window.innerHeight-90)/3+"px";this.webcamRealtime.style.overflow="hidden";this.webcamRealtime.style.cursor="pointer";this.webcamRealtime.style.position="relative";this.webcamRealtime.style.borderBottom="1px solid #333434";this.webcamRealtime.addEventListener("mouseup",
()=>{this.conn&&("close"==this.conn.stateConnection()?this.initConn():this.showRealtimeFullscreen())});this.btViewWebcam=this.monitor.createButton(150,36,"XEM TR\u1ef0C TI\u1ebeP","#1A84E3",14);this.btViewWebcam.style.position="absolute";this.btViewWebcam.style.left="75px";this.btViewWebcam.style.top=(a-36)/2+"px";this.btViewWebcam.style.zIndex=9999;this.webcamRealtime.appendChild(this.btViewWebcam);this.realtimeView.appendChild(this.webcamRealtime);this.imgWebcam=document.createElement("canvas");
this.imgWebcam.style.zIndex=99;this.imgWebcam.style.height="100%";this.imgWebcam.style.margin="auto";this.imgWebcam.style.display="block";this.imgWebcam.style.position="absolute";this.webcamRealtime.appendChild(this.imgWebcam);b=document.createElement("div");b.style.backgroundColor="#333434";b.style.width="100%";b.style.height="30px";b.style.lineHeight="30px";b.style.color="white";b.textContent="M\u00e0n h\u00ecnh";b.style.paddingLeft="20px";b.style.position="relative";this.screenSpanTitle=b;this.realtimeView.appendChild(b);
this.screenRealtime=document.createElement("div");this.screenRealtime.style.width="100%";this.screenRealtime.style.height=(window.innerHeight-90)/3+"px";this.screenRealtime.style.overflow="hidden";this.screenRealtime.style.position="relative";this.screenRealtime.style.borderBottom="1px solid #333434";this.screenRealtime.addEventListener("mouseup",()=>{this.conn&&(this.drawLastScreen(),this.conn.requestStream("screen"));this.streamInfo&&0!=this.streamInfo.isScreen||this.monitor.showToolTip("Ch\u01b0a c\u00f3 d\u1eef li\u1ec7u chia s\u1ebb m\u00e0n h\u00ecnh !")});
this.btViewScreen=this.monitor.createButton(150,36,"XEM TR\u1ef0C TI\u1ebeP","#1A84E3",14);this.btViewScreen.style.position="absolute";this.btViewScreen.style.left="75px";this.btViewScreen.style.top=(a-36)/2+"px";this.btViewScreen.style.zIndex=9999;this.screenRealtime.appendChild(this.btViewScreen);this.realtimeView.appendChild(this.screenRealtime);this.imgScreen=document.createElement("canvas");this.imgScreen.style.zIndex=99;this.imgScreen.width=320;this.imgScreen.height=(window.innerHeight-90)/
3;this.imgScreen.style.margin="auto";this.imgScreen.style.display="none";this.screenRealtime.appendChild(this.imgScreen);b=document.createElement("div");b.style.backgroundColor="#333434";b.style.width="100%";b.style.height="30px";b.style.lineHeight="30px";b.style.color="white";b.textContent="Camera ngo\u00e0i";b.style.paddingLeft="20px";b.style.position="relative";this.exCamSpanTitle=b;this.realtimeView.appendChild(b);this.exCamRealtime=document.createElement("div");this.exCamRealtime.style.width=
"100%";this.exCamRealtime.style.height=(window.innerHeight-90)/3+"px";this.exCamRealtime.style.overflow="hidden";this.exCamRealtime.style.position="relative";this.exCamRealtime.addEventListener("mouseup",()=>{this.conn&&(this.drawLastScreen(),this.conn.requestStream("excam"));this.streamInfo&&0!=this.streamInfo.isExcam||this.monitor.showToolTip("Ch\u01b0a c\u00f3 d\u1eef li\u1ec7u t\u1eeb camera ngo\u00e0i !")});this.btViewExcam=this.monitor.createButton(150,36,"XEM TR\u1ef0C TI\u1ebeP","#1A84E3",
14);this.btViewExcam.style.position="absolute";this.btViewExcam.style.left="75px";this.btViewExcam.style.top=(a-36)/2+"px";this.btViewExcam.style.zIndex=9999;this.exCamRealtime.appendChild(this.btViewExcam);this.realtimeView.appendChild(this.exCamRealtime);this.imgCamEx=document.createElement("canvas");this.imgCamEx.style.zIndex=99;this.imgCamEx.width=(window.innerHeight-90)/4;this.imgCamEx.height=(window.innerHeight-90)/3;this.imgCamEx.style.margin="auto";this.imgCamEx.style.display="none";this.exCamRealtime.appendChild(this.imgCamEx)},
onresize:function(){this.infoView.style.width=window.innerWidth-340+"px";this.infoFile.style.width=window.innerWidth-360+"px";this.webcamRealtime.style.height=(window.innerHeight-90)/3+"px";this.exCamRealtime.style.height=(window.innerHeight-90)/3+"px";this.screenRealtime.style.height=(window.innerHeight-90)/3+"px";this.conn&&this.conn.resizeUI(320,(window.innerHeight-90)/3);this.realtimeFullscreen.style.width=window.innerWidth+"px";this.realtimeFullscreen.style.height=window.innerHeight+"px";"block"==
this.realtimeFullscreen.style.display&&this.conn.resizeUI(window.innerWidth,window.innerHeight-60)},show:function(){this.ui.style.display="block"},hide:function(){this.ui.style.display="none"},hideRealtimeFullscreen:function(){this.realtimeFullscreen.style.display="none";this.conn.resizeUI(320,(window.innerHeight-90)/3);this.conn.ui.style.top="0px";this.conn.requestStream("webcam");this.webcamRealtime.appendChild(this.conn.ui)},showRealtimeFullscreen:function(){this.conn.resizeUI(window.innerWidth,
window.innerHeight-60);this.conn.ui.style.top="60px";this.realtimeFullscreen.appendChild(this.conn.ui);this.realtimeFullscreen.style.display="block"},showUser:function(a){if(this.user!=a&&a)if(a.info)this.clearAll(),this.show(),this.monitor.showLoading(),this.user=a,0>=a.userid?(cc.log("User info not valid to show"),this.monitor.hideLoading()):(this.user.info.resultid&&this.getUserListFiles(this.user.info.resultid),this.appendUserInfo(),this.initConn());else{var b=this.monitor.options,c=new XMLHttpRequest;
c.user=a;c.onreadystatechange=()=>{if(4==c.readyState)if(200==c.status)try{var d=this.decodeStr(c.responseText);c.user.info=d.info;c.user.imgstr=d.imgstr;this.showUser(c.user)}catch(e){this.monitor.showToolTip("Ch\u01b0a c\u00f3 d\u1eef li\u1ec7u gi\u00e1m s\u00e1t !")}else this.monitor.showToolTip("Ch\u01b0a c\u00f3 d\u1eef li\u1ec7u gi\u00e1m s\u00e1t !")};c.open("GET",b.urlDownload+b.roomid+"/"+a.userid+"/public/"+a.userid+"_"+a.studentid+"_curr.txt?t="+(new Date).getTime());c.send()}},clearAll:function(){this.conn&&
this.conn.reset();this.connScreen&&this.connScreen.reset();this.user=null;this.loadIndex=0;this.streamInfo=this.resultObj=this.file=null;this.cache={};cc.removeAllChildNodes(this.infoFile);cc.removeAllChildNodes(this.infoDevice);clearInterval(this.intvGetListFile);this.viewRealtime({isWebcam:!0,isScreen:!1,isExcam:!1});this.arrCanvasFace=[];this.files=[]},initConn:function(){null==this.conn&&(this.conn=new aztExam.RTCConnection(this.monitor),this.conn.addCEventListener("uploadAnswer",()=>{this.monitor.options.firebaseApp&&
this.monitor.examLiveStudents_teacher_saveChange(this.monitor.options.roomid,this.user.userid.toString(),{ans:this.conn.answer.timestamp.toString()})}),this.conn.addCEventListener("onmessages",(b,c)=>{cc.log("onmessages"+JSON.stringify(c));"replaceTrack"==c.cmd&&this.viewStream(c.name);"infoStream"==c.cmd&&this.viewRealtime(c);"forceUploadComplete"==c.cmd&&(this.monitor.showToolTip("Ch\u1ee5p l\u1ed7i th\u00e0nh c\u00f4ng !"),this.getUserListFiles())}),this.webcamRealtime.appendChild(this.conn.ui),
this.conn.resizeUI(320,(window.innerHeight-90)/3),this.conn.ui.style.zIndex=999,this.conn.ui.style.position="absolute");var a=this.monitor.options;this.monitor.getPublicUpload(a.config.urlGetPublicForLive,a.user.token,a.roomid,0,this.user.userid,this.user.userid+"_"+this.user.studentid+"_answer.txt",1,0,cc.randomStr(5),b=>{if(this.user){var c=cc.md5(a.take+"_"+a.roomid+"_"+this.user.userid)+"_"+this.user.userid+"_"+this.user.studentid+"_offer.txt",d=cc.md5("USER_"+a.take+"_"+a.roomid+"_"+this.user.userid);
this.conn.start(a.user,this.user,"answer",{download:a.urlDownload+a.roomid+"/"+this.user.userid+"/public/"+c,upload:""},{download:"",upload:b},null,this.monitor.options.firebaseApp?!1:!0,d)}this.viewStream("webcam")})},initConnScreen:function(){},viewStream:function(a){this.currStream!=a&&(this.currStream=a,this.btViewWebcam.style.display="flex",this.btViewScreen.style.display="flex",this.btViewExcam.style.display="flex",this.imgWebcam.style.display="block",this.imgScreen.style.display="block",this.imgCamEx.style.display=
"block","webcam"==this.currStream&&(this.webcamRealtime.appendChild(this.conn.ui),this.btViewWebcam.style.display="none",this.imgWebcam.style.display="none"),"screen"==this.currStream&&this.showRealtimeFullscreen(),"excam"==this.currStream&&this.showRealtimeFullscreen())},viewRealtime:function(a){this.streamInfo=a;this.webcamSpanTitle.style.display=1==a.isWebcam?"block":"none";this.webcamRealtime.style.display=1==a.isWebcam?"block":"none";this.screenSpanTitle.style.display=1==a.isScreen?"block":"none";
this.screenRealtime.style.display=1==a.isScreen?"block":"none";this.exCamSpanTitle.style.display=1==a.isExcam?"block":"none";this.exCamRealtime.style.display=1==a.isExcam?"block":"none"},drawLastScreen:function(){if(this.conn&&this.conn.videoEl){if("webcam"==this.currStream){var a=this.imgWebcam.getContext("2d");a.drawImage(this.conn.videoEl,0,0,this.imgWebcam.width,this.imgWebcam.height)}"screen"==this.currStream&&(a=this.imgScreen.getContext("2d"),a.drawImage(this.conn.videoEl,0,0,this.imgScreen.width,
this.imgScreen.height));"excam"==this.currStream&&(a=this.imgCamEx.getContext("2d"),a.drawImage(this.conn.videoEl,0,0,this.imgCamEx.width,this.imgCamEx.height))}},appendUserInfo:function(){cc.removeAllChildNodes(this.infoDevice);var a=document.createElement("div");a.style.position="relative";a.style.width="100%";a.textContent="T\u00ean "+this.user.username;this.infoDevice.appendChild(a);if(this.user.info&&this.user.info.deviceInfo){a=this.user.info.deviceInfo;var b=document.createElement("div");b.style.position=
"relative";b.style.width="100%";b.style.marginTop="10px";b.textContent="Thi\u1ebft b\u1ecb  : "+a.osName+", "+a.browserName;this.infoDevice.appendChild(b);b=document.createElement("div");b.style.position="relative";b.style.width="100%";b.style.marginTop="10px";b.textContent="Media : "+(1==a.hasWebcam?"C\u00f3 webcam ,":" Kh\u00f4ng c\u00f3 webcam ,");b.textContent+=1==a.hasMicrophone?" C\u00f3 microphone ,":" Kh\u00f4ng c\u00f3 microphone ,";b.textContent+=1==a.isWebsiteHasWebcamPermissions?" C\u00f3 c\u1ea5p quy\u1ec1n webcam ,":
" Kh\u00f4ng c\u1ea5p quy\u1ec1n webcam ,";b.textContent+=1==a.isWebsiteHasMicrophonePermissions?" C\u00f3 c\u1ea5p quy\u1ec1n microphone .":" Kh\u00f4ng c\u1ea5p quy\u1ec1n microphone .";b.textContent+=1==a.isWebsiteHasShareScreenPermission?" C\u00f3 h\u1ed7 tr\u1ee3 chia s\u1ebb m\u00e0n h\u00ecnh .":" Kh\u00f4ng h\u1ed7 tr\u1ee3 chia s\u1ebb m\u00e0n h\u00ecnh .";b.textContent+=1==a.hasShareScreen?" C\u00f3 chia s\u1ebb m\u00e0n h\u00ecnh .":" Kh\u00f4ng chia s\u1ebb m\u00e0n h\u00ecnh .";b.textContent+=
1==a.hasExCam?" C\u00f3 k\u1ebft n\u1ed1i camera ngo\u00e0i .":" Kh\u00f4ng k\u1ebft n\u1ed1i camera ngo\u00e0i .";this.infoDevice.appendChild(b)}},appendFileInfo:function(){cc.removeAllChildNodes(this.infoFile);var a=document.createElement("div");a.style.position="relative";a.style.width="100%";a.textContent="D\u1eef li\u1ec7u gi\u00e1m s\u00e1t l\u01b0\u1ee3t thi .";a.style.fontWeight="bolder";a.style.height="40px";a.style.display="flex";a.style.alignItems="center";this.infoFile.appendChild(a);
this.btRefresh=this.monitor.createButton(180,36,"T\u1ea3i l\u1ea1i","#1A84E3",14);this.btRefresh.css("cursor","pointer");this.btRefresh.css("margin-left","80px");this.btRefresh.addEventListener("mouseup",()=>{if(this.user.info&&this.user.info.resultid){this.monitor.showLoading();var b=(new Date).getTime();9E4<b-this.lasttimeRefresh?(this.getUserListFiles(this.user.info.resultid),this.lasttimeRefresh=b):setTimeout(()=>{this.monitor.hideLoading()},200)}});this.lasttimeRefresh=(new Date).getTime();a.appendChild(this.btRefresh);
clearInterval(this.intvGetListFile);this.countDown=120;this.intvGetListFile=setInterval(()=>{this.btRefresh.textContent="T\u1ea3i l\u1ea1i ( "+this.countDown+" gi\u00e2y )";this.countDown--;0==this.countDown&&(clearInterval(this.intvGetListFile),this.getUserListFiles(this.user.info.resultid))},1E3);this.loadFile(this.loadIndex)},loadFile:function(a){if(this.user&&!(!this.files||0>=this.files.length||0>a||a>=this.files.length))if(a>=this.pageMax)a<this.files.length&&(a=this.monitor.createButton(120,
36,"XEM TH\u00caM","#1A84E3",14),a.css("margin","40px"),a.css("position","relative"),a.css("cursor","pointer"),a.addEventListener("mouseup",c=>{this.pageMax+=this.pageMax;this.loadFile(this.loadIndex+1);c.target.parentNode.removeChild(c.target)}),this.infoFile.appendChild(a));else if(this.loadIndex=a,a=this.files[a],a.path&&""!=a.path)if(this.cache[a.path])this.onLoadFile(!0,this.cache[a.path],a);else{var b=new XMLHttpRequest;b.pathInfo=a;b.onreadystatechange=()=>{if(4==b.readyState)if(200==b.status)this.onLoadFile(!0,
b.responseText,b.pathInfo);else this.onLoadFile(!1,null,b.pathInfo)};b.open("GET",a.path);b.send()}else setTimeout(()=>{this.loadFile(this.loadIndex+1)},1500)},onLoadFile:function(a,b,c){if(this.user){if(a)try{this.cache[c.path]=b;var d=this.monitor.decodeStr(b);d&&(d.pathInfo=c,cc.log("valid decode "),this.appendImgInfo(d))}catch(e){cc.log("error load file "+c.path)}else cc.log("error load path "+c.path);setTimeout(()=>{this.loadFile(this.loadIndex+1)},1500)}},appendImgInfo:function(a){if(a.info&&
a.imgstr){var b=document.createElement("div");b.style.position="relative";b.style.width="100%";b.style.height="auto";b.style.marginTop="20px";b.style.marginBottom="20px";b.style.overflow="hidden";this.infoFile.appendChild(b);var c="Webcam";a.pathInfo&&(0<=a.pathInfo.path.indexOf("azt_scr")&&(c="M\u00e0n h\u00ecnh "),0<=a.pathInfo.path.indexOf("azt_exca")&&(c="Cam ngo\u00e0i "),0<=a.pathInfo.path.indexOf("azt_aud")&&(c="\u00c2m thanh "));a.pathInfo.type=c;var d=document.createElement("div");d.style.position=
"relative";d.style.width="100%";d.textContent=c+" : "+(new Date(a.info.startTime)).toLocaleString().split(",")[1]+" -- "+(new Date(a.info.time)).toLocaleString().split(",")[1];b.appendChild(d);var e=document.createElement("div");e.style.width="100%";e.style.height="auto";e.style.position="relative";e.style.overflowX="scroll";e.style.marginTop="10px";b.appendChild(e);c=0;for(var f in a.info.warning)null!=a.info.warning[f]&&c++;f=document.createElement("div");f.style.position="relative";f.style.width=
"100%";f.style.marginTop="5px";f.style.fontStyle="italic";f.style.fontSize="13px";f.style.color=0<c?"red":"white";f.textContent="C\u1ea3nh b\u00e1o kh\u1ea3 n\u0103ng vi ph\u1ea1m : "+c;b.appendChild(f);if(0>a.pathInfo.path.indexOf("azt_aud")){var l=new Image;l.info=a.info;l.pathInfo=a.pathInfo;l.onload=()=>{var p=document.createElement("canvas");p.width=l.width;p.height=l.height;p.info=l.info;p.pathInfo=l.pathInfo;var n=p.getContext("2d");n.drawImage(l,0,0);e.appendChild(p);n.fillStyle="red";n.font=
"13px Arial";n.lineWidth=5;var w=l.info.timestamp,x=l.info.warning;this._drawThumbFirstTime(l);for(var G=0;G<w.length;G++){var N=(new Date(w[G])).toLocaleString().split(",")[1];n.fillText(N,G*l.info.w+8,p.height-4);n.moveTo(G*l.info.w,0);n.lineTo(G*l.info.w,l.info.h);n.stroke();null!=x[G]&&(n.globalAlpha=.2,n.fillRect(G*l.info.w,0,l.info.w,l.info.h),n.globalAlpha=1)}cc.log("cv type "+p.pathInfo.type);"Webcam"==p.pathInfo.type&&(this.arrCanvasFace.push(p),1==this.arrCanvasFace.length&&this.detectFaceCanvas())};
0>a.imgstr.indexOf("data")?l.src="data:image/jpeg;base64,"+a.imgstr:l.src=a.imgstr}else b=document.createElement("audio"),b.controls=!0,0>a.imgstr.indexOf("data")?b.src="data:audio/mpeg;base64,"+a.imgstr:b.src=a.imgstr,e.appendChild(b)}},_drawThumbFirstTime:function(a){if(0<=a.pathInfo.path.indexOf("azt_wc")&&!this.imgWebcam.isDraw){cc.log("draw webcam");var b=this.imgWebcam.getContext("2d");this.imgWebcam.isDraw=!0;b.drawImage(a,0,0,a.info.w,a.info.h,0,0,a.info.w,a.info.h)}0<=a.pathInfo.path.indexOf("azt_scr")&&
!this.imgScreen.isDraw&&(cc.log("draw screen"),b=this.imgScreen.getContext("2d"),this.imgScreen.isDraw=!0,b.drawImage(a,0,0,a.info.w,a.info.h,0,0,this.imgScreen.width,this.imgScreen.height));0<=a.pathInfo.path.indexOf("azt_exca")&&!this.imgCamEx.isDraw&&(cc.log("draw excam"),b=this.imgCamEx.getContext("2d"),this.imgCamEx.isDraw=!0,b.drawImage(a,0,0,a.info.w,a.info.h,0,0,this.imgCamEx.width,this.imgCamEx.height))},getUserResultInfo:function(){if(this.user){var a=this.monitor.options;this.monitor.getExamResultGetLastExamResultOfStudentId(a.user.token,
a.examid,this.user.userid,this.user.studentid,b=>{this.resultObj=b;0<this.resultObj.lastResultId?this.getUserListFiles(this.resultObj.lastResultId):(this.monitor.hideLoading(),cc.log("error get resultId "+this.user.userid+":"+this.user.studentid))})}},getUserListFilesServer:function(a){this.user&&this.monitor.getListFile(this.monitor.options.roomid,this.user.userid,a,b=>{cc.log("getlistfile callback");b?(cc.log("getListFile : "+JSON.stringify(b)),this.files=JSON.parse(JSON.stringify(b))):cc.log("error get listfile "+
this.user.userid+":"+this.user.studentid+":"+a);this.monitor.hideLoading();setTimeout(()=>{this.loadIndex=0;this.appendFileInfo()},10)})},getUserListFiles:function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState){if(200==a.status){try{var d=this.monitor.options,e=cc.md5("USER_"+d.take+"_"+d.roomid+"_"+this.user.userid),f=CryptoJS.AES.decrypt(a.responseText,e).toString(CryptoJS.enc.Utf8),l=f.substring(10,f.length);this.files=JSON.parse(atob(l)).arrStoreFile.reverse();cc.log("get arrFileStudent : "+
JSON.stringify(this.files))}catch(p){cc.log("expception get listfile ")}setTimeout(()=>{this.loadIndex=0;this.appendFileInfo()},10)}else this.loadIndex=0,this.appendFileInfo();this.monitor.hideLoading()}};var b=this.monitor.options,c=cc.md5(b.take+"_"+b.roomid+"_"+this.user.userid)+"_"+this.user.userid+"_"+this.user.studentid+"_"+this.user.info.resultid+"_fl.txt";a.open("GET",b.urlDownload+b.roomid+"/"+this.user.userid+"/public/"+this.user.info.resultid+"/"+c+"?t="+(new Date).getTime());a.send()},
initFaceApi:function(){this.isInitFaceApi||cc.loadJs(["https://azota889.github.io/storage_public/almo/face-api.min.js"],()=>{this.loadFaceApi().then(async()=>{cc.log("load faceApi ok");null==this.faceApiOption&&(this.faceApiOption=new faceapi.TinyFaceDetectorOptions({inputSize:224,scoreThreshold:.5}));const a=await faceapi.detectAllFaces(this.imgWebcam,this.faceApiOption);cc.log("detect face finish : "+JSON.stringify(a));this.monitor.hideLoading();this.detectFaceCanvas()})})},loadFaceApi:async function(){cc.log("load tinyface");
this.isInitFaceApi||(await faceapi.loadTinyFaceDetectorModel("https://azota889.github.io/storage_public/almo/weights"),cc.log("end load tinyface"),this.isInitFaceApi=!0)},detectFaceCanvas:function(){cc.log("start detect face canvas "+this.arrCanvasFace.length);if(0<this.arrCanvasFace.length){var a=this.arrCanvasFace.shift();this.monitor.isInfoMobile(a.info.deviceInfo)||this.detectFace(a,0).then(()=>{cc.log("detect face index 0")})}else cc.log("ok finish face detection canvas")},detectFace:async function(a,
b){if(this.isInitFaceApi&&a){if(0>b||cc.isEmpty(b))b=0;if(b==a.info.numImage)cc.log("finish detect canvas try next"),this.detectFaceCanvas();else{cc.log("start detect face "+a.info.numImage+":"+b);var c=document.createElement("canvas");c.width=a.info.w;c.height=a.info.h;c.getContext("2d").drawImage(a,b*c.width,0,c.width,c.height,0,0,c.width,c.height);null==this.faceApiOption&&(this.faceApiOption=new faceapi.TinyFaceDetectorOptions({inputSize:224,scoreThreshold:.4}));var d=await faceapi.detectAllFaces(c,
this.faceApiOption);cc.log("detect face finish : "+JSON.stringify(d));var e=a.getContext("2d");if(d&&0<d.length){e.strokeStyle="#0af50a";e.lineWidth=1;for(var f=0;f<d.length;f++){var l=d[f]._box;e.strokeRect(b*c.width+Math.floor(l._x),Math.floor(l._y),Math.floor(l._width),Math.floor(l._height))}}else e.fillStyle="red",e.globalAlpha=.2,e.fillRect(b*c.width,0,c.width,c.height),e.globalAlpha=1;setTimeout(()=>{this.detectFace(a,b+1)},100)}}}});aztExam=aztExam||{};
aztExam.monitorTeacher=aztExam.monitor.extend({_imageCaptureWidth:200,_imageCaptureHeight:150,mainViewWidth:1280,mainViewHeight:720,historyWidth:440,userMediaWidth:840,userMediaHeight:472,arrImageIntv:null,isFirstLoad:!0,state:-1,arrUserConn:null,_mouseX:-1,_mouseY:-1,_mouseIntv:-1,_timeOnlineIntv:5E4,_maxUserUpdate:25,_indexStartUpdate:0,_indexEndUpdate:-1,_indexStartShow:0,_numShow:25,currIndexGet:-1,countLoop:0,_roomControlInfo:null,_objUserHasJoined:null,_objUserList:null,_arrUserUpdate:null,
_objUrlDownload:{},ctor:function(){cc.log("init ver= "+this.version());this._super();this.initUI();window.addEventListener("resize",()=>{this.onresize()});cc.insertCss(".loader {border: 6px solid #f3f3f3; /* Light grey */border-top: 6px solid #3498db; /* Blue */border-radius: 50%;width: 50px;height: 50px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}");cc.insertCss("div::-webkit-scrollbar {width: 10px;height:10px;background-color: #2b2a2a;}div::-webkit-scrollbar-track {box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.3);}div::-webkit-scrollbar-thumb {background-color: rgb(77, 76, 76);}");
document.addEventListener("fullscreenchange",()=>{this.onFullscreenChange()},!1);document.addEventListener("webkitfullscreenchange",()=>{this.onFullscreenChange()},!1);document.addEventListener("mozfullscreenchange",()=>{this.onFullscreenChange()},!1);this.onresize()},start:function(a){this.parseOption(a);this._objUserList={};for(a=0;a<this.options.userlistStart.length;a++){var b={};b.userid=this.options.userlistStart[a].userid;b.studentid=this.options.userlistStart[a].studentid;b.username=cc.isEmpty(this.options.userlistStart[a].studentname)?
this.options.userlistStart[a].username:this.options.userlistStart[a].studentname;this.options.userlist[a]=b;this._objUserList[b.studentid.toString()]=b}this._running=!0;this.collectDeviceInfo(()=>{this._imageCaptureWidth=360;this._imageCaptureHeight=202;if(!this.stream){var c=-1,d=-1;0<this.deviceInfo.videoInputDevices.length&&(c=0);0<this.deviceInfo.audioInputDevices.length&&(d=0);this.getMediaUser(c,d)}this.initUrlUploadPublic(()=>{this.initShowUser();this.startFirestoreEvent();this.loop()})})},
loop:function(){cc.log("running "+this._running);this._running=!0;this.update(0)},stopLoop:function(){this._running=!1},stop:function(){},reset:function(){this._super();this.currIndexGet=-1;this.countLoop=this._indexEndUpdate=this._indexStartUpdate=this._indexStartShow=0;this.isFirstLoad=!0;this.setState(0);this.arrUserConn=[];this._objUserHasJoined={};this._objUserList={};this._arrUserUpdate=[];this._roomControlInfo=null},startFirestoreEvent:function(){this.examSessions_subscribeUserMap(this.options.roomid,
a=>{cc.log("receive userMap "+JSON.stringify(a));try{if(1==a.success&&a.data)for(var b in a.data)if(this._objUserList[b.toString()]){var c=a.data[b].toString().split("_")[0];this._objUserList[b.toString()].userid=c;cc.log("update userid to studentid "+b+":"+c)}}catch(d){}})},initUrlUploadPublic:function(a){this.showLoading();this.getTokenForLive(this.options.roomid,b=>{b&&""!=b?(this.options.user.token=b,this.getPublicUpload(this.options.config.urlGetPublicForLive,this.options.user.token,this.options.roomid,
0,this.options.user.userid,"offer.txt",1,0,cc.randomStr(10),(c,d)=>{if(c&&""!=c){var e=d.indexOf(this.options.roomid);0<=e?(this._urlDownload=d.substr(0,e),this.options.urlDownload=this._urlDownload,setTimeout(()=>{a&&a()},100)):alert("L\u1ed7i l\u1ea5y d\u1eef li\u1ec7u upload ! "+c+":"+this.options.roomid)}else setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})):setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})},onFullscreenChange:function(){var a=document.fullscreenElement||document.mozFullScreenElement||
document.webkitFullscreenElement;cc.removeAllChildNodes(this.btFullscreen);a?this.btFullscreen.appendChild(aztExam.svg.getDom(aztExam.svg.iconExitFullscreen)):this.btFullscreen.appendChild(aztExam.svg.getDom(aztExam.svg.iconFullscreen))},toggleFullScreen:function(){var a=this.app;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&
document.msExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},initUI:function(){this.app=document.createElement("div");this.app.style.width="100%";this.app.style.height="100%";this.app.style.fontFamily="sans-serif";this.app.style.fontSize="20px";this.app.style.overflow="hidden";this.app.style.backgroundColor="#222222";this.mainView=this.findDom(document.createElement("div"));this.mainView.css("width",
"100%");this.mainView.css("height","100%");this.mainView.css("transform-origin","0% 0%");this.mainView.css("position","absolute");this.mainView.classList.add("azt_monitor_mainview");this.mainView.css("background-color","#4c4b4b");this.mainView.css("overflow","hidden");this.mainView.css("display","none");this.app.appendChild(this.mainView);this.userView=this.findDom(document.createElement("div"));this.userView.css("width","100%");this.userView.css("height","100%");this.userView.css("transform-origin",
"0% 0%");this.userView.css("position","absolute");this.userView.css("overflow","hidden");this.userView.classList.add("azt_monitor_userview");this.userView.css("background-color","#4c4b4b");this.userView.css("display","none");this.app.appendChild(this.userView);this.divLog=document.createElement("div");this.divLog.style.position="fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom="0px";this.loadingDiv=document.createElement("div");this.loadingDiv.style.width=
"100%";this.loadingDiv.style.height="100%";this.loadingDiv.style.backgroundColor="gray";this.loadingDiv.style.opacity=.5;this.loadingDiv.style.display="none";this.loadingDiv.style.justifyContent="center";this.loadingDiv.style.alignItems="center";this.loadingDiv.style.position="absolute";this.loadingDiv.style.zIndex="9999999999";var a=document.createElement("div");a.classList.add("loader");this.loadingDiv.appendChild(a);document.body.appendChild(this.loadingDiv);this.historyView=new aztExam.monitorTeacherHistory(this);
this.app.appendChild(this.historyView.ui);this.initMainView();this.initUserView();this.setState(0)},onresize:function(){var a=window.innerHeight-52;var b=window.innerWidth-96;if(!(0>=a||0>=b)){var c=this.mainViewWidth/this.mainViewHeight<b/a?a/this.mainViewHeight:b/this.mainViewWidth;a=(a-this.mainViewHeight*c)/2;b=48+(b-this.mainViewWidth*c)/2;this.classMedia.css("transform","scale("+c+")");this.classMedia.css("top",a+"px");this.classMedia.css("left",b+"px");this.btBack.style.top=(window.innerHeight-
100)/2+"px";this.btNext.style.left=window.innerWidth-48+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.userHeader.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.app.style.height=window.innerHeight+"px";this.userMediaWidth=window.innerWidth-this.historyWidth-2;this.userMediaHeight=window.innerHeight-60;this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+
"px");this.userMedia.css("top","65px");this.listUser.style.height=window.innerHeight-120+"px";this.mainSearchResult.style.height=window.innerHeight-50+"px";this.mainSearchContentDiv.style.height=window.innerHeight-130+"px";this.mainSearchContent.style.minHeight=window.innerHeight-130+"px";this.resizeUserMedia()}},initMainView:function(){this.mainHeader=this.findDom(document.createElement("div"));this.mainHeader.css("width","100%");this.mainHeader.css("height","60px");this.mainHeader.css("border-bottom",
"1px solid black");this.mainHeader.css("position","fixed");this.mainHeader.css("display","none");this.mainHeader.css("top","0px");this.mainHeader.css("background-color","#333434");this.mainView.appendChild(this.mainHeader);this.btViewHistory=this.createButton(180,36,"TH\u00d4NG TIN C\u00c1 NH\u00c2N","#1A84E3",14);this.btViewHistory.css("position","absolute");this.btViewHistory.css("top","12px");this.btViewHistory.css("right","180px");this.btViewHistory.css("cursor","pointer");this.btViewHistory.addTouch(c=>
{this.removeAllUserMedia();this.showListUser();this.setState(1)});this.mainHeader.appendChild(this.btViewHistory);this.btExit=this.createButton(80,36,"\u0110\u00d3NG","#1A84E3",14);this.btExit.css("position","absolute");this.btExit.css("top","12px");this.btExit.css("left","12px");this.btExit.css("cursor","pointer");this.btExit.addTouch(c=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainHeader.appendChild(this.btExit);this.mainBottomMenu=this.findDom(document.createElement("div"));
this.mainBottomMenu.style.width="100%";this.mainBottomMenu.style.height="50px";this.mainBottomMenu.css("border-top","1px solid black");this.mainBottomMenu.css("position","fixed");this.mainBottomMenu.css("bottom","0px");this.mainBottomMenu.css("background-color","#222222");this.mainView.appendChild(this.mainBottomMenu);this.classMedia=this.findDom(document.createElement("div"));this.classMedia.css("width",this.mainViewWidth+"px");this.classMedia.css("height",this.mainViewHeight+"px");this.classMedia.css("overflow",
"hidden");this.classMedia.css("transform-origin","0% 0%");this.classMedia.css("position","absolute");this.classMedia.classList.add("azt_monitor_mainview");this.classMedia.css("background-color","#4c4b4b");this.mainView.appendChild(this.classMedia);this.btClose=this.findDom(document.createElement("div"));this.btClose.css("width","80px");this.btClose.css("height","36px");this.btClose.css("position","absolute");this.btClose.css("right","10px");this.btClose.css("bottom","7px");this.btClose.css("color",
"red");this.btClose.css("background","#333434");this.btClose.css("line-height","36px");this.btClose.css("cursor","pointer");this.btClose.css("text-align","center");this.btClose.textContent="\u0110\u00d3NG";this.btClose.css("font-size","14px");this.btClose.addEventListener("mouseup",c=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainBottomMenu.appendChild(this.btClose);this.btClassInfo=this.findDom(document.createElement("div"));this.btClassInfo.css("width",
"190px");this.btClassInfo.css("height","36px");this.btClassInfo.css("position","absolute");this.btClassInfo.css("left","10px");this.btClassInfo.css("bottom","7px");this.btClassInfo.css("color","white");this.btClassInfo.css("background","#333434");this.btClassInfo.css("line-height","36px");this.btClassInfo.css("cursor","pointer");this.btClassInfo.css("font-size","12px");this.mainBottomMenu.appendChild(this.btClassInfo);this.txtClassInfo=document.createElement("div");this.txtClassInfo.style.width="150px";
this.txtClassInfo.style.lineHeight="36px";this.txtClassInfo.style.marginLeft="40px";this.btClassInfo.appendChild(this.txtClassInfo);var a=document.createElement("div");a.appendChild(aztExam.svg.getDom(aztExam.svg.iconGroup));a.style.position="absolute";a.style.top="4px";a.style.left="8px";this.btClassInfo.appendChild(a);this.btBack=this.findDom(document.createElement("div"));this.btBack.style.width="48px";this.btBack.style.height="auto";this.btBack.style.textAlign="center";this.btBack.style.position=
"absolute";this.btBack.style.left="0px";this.btBack.style.color="gray";this.btBack.style.fontSize="14px";this.btBack.style.top=(window.innerHeight-100)/2+"px";this.btBack.style.cursor="pointer";this.btBack.style.display="none";this.mainView.appendChild(this.btBack);a=document.createElement("div");a.appendChild(aztExam.svg.getDom(aztExam.svg.iconLeft));a.style.fill="gray";this.btBack.appendChild(a);this.infoBack=document.createElement("div");this.infoBack.style.width="100%";this.infoBack.style.marginTop=
"-10px";this.btBack.appendChild(this.infoBack);this.btBack.addEventListener("mouseup",c=>{this.backShowUser()});this.btNext=this.findDom(document.createElement("div"));this.btNext.style.width="48px";this.btNext.style.height="auto";this.btNext.style.textAlign="center";this.btNext.style.position="absolute";this.btNext.style.left=window.innerWidth-58+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.btNext.style.color="gray";this.btNext.style.fontSize="14px";this.btNext.style.cursor="pointer";
this.btNext.style.display="none";this.mainView.appendChild(this.btNext);a=document.createElement("div");a.appendChild(aztExam.svg.getDom(aztExam.svg.iconLeft));a.style.fill="gray";a.style.transform="scale(-1,1)";this.btNext.appendChild(a);this.infoNext=document.createElement("div");this.infoNext.style.width="100%";this.infoNext.style.marginTop="-10px";this.btNext.appendChild(this.infoNext);this.btNext.addEventListener("mouseup",c=>{this.nextShowUser()});this.btFullscreen=this.findDom(document.createElement("div"));
this.btFullscreen.css("cursor","pointer");this.btFullscreen.css("position","absolute");this.btFullscreen.css("top","5px");this.btFullscreen.css("right","5px");this.btFullscreen.css("transform","scale(0.6,0.6)");this.btFullscreen.appendChild(aztExam.svg.getDom(aztExam.svg.iconFullscreen));this.btFullscreen.addEventListener("mouseup",c=>{this.toggleFullScreen()});this.mainView.appendChild(this.btFullscreen);var b=document.createElement("div");b.style.width="250px";b.style.height="20px";b.style.position=
"absolute";b.style.top="10px";b.style.right="120px";b.style.borderRadius="8px";b.style.borderColor="#CCCCCC";b.style.backgroundColor="#000000";b.style.color="#444444";b.style.padding="6px";b.style.paddingLeft="15px";b.style.fontSize="16px";b.textContent="T\u00ecm theo t\u00ean ";b.setAttribute("contenteditable",!0);b.setAttribute("contentsearch","");b.addEventListener("input",()=>{cc.log("on txt search change "+b.textContent);b.setAttribute("contentsearch",b.textContent);this.searchUserMainView(b.textContent)});
b.addEventListener("focus",()=>{""==b.getAttribute("contentsearch")&&(b.textContent="");this.searchUserMainView(b.textContent)});b.addEventListener("blur",()=>{""==b.textContent&&(b.textContent="T\u00ecm theo t\u00ean ",this.searchUserMainView(""))});this.mainBottomMenu.appendChild(b);this.mainSearchResult=document.createElement("div");this.mainSearchResult.style.width="450px";this.mainSearchResult.style.height=window.innerHeight-50+"px";this.mainSearchResult.style.position="fixed";this.mainSearchResult.style.right=
"0px";this.mainSearchResult.style.bottom="50px";this.mainSearchResult.style.display="none";this.mainSearchResult.style.backgroundColor="black";this.mainSearchResult.style.overflow="hidden";this.mainView.appendChild(this.mainSearchResult);this.btCloseSearch=this.createButton(80,36,"\u0110\u00d3NG","#1A84E3",14);this.btCloseSearch.css("position","relative");this.btCloseSearch.css("cursor","pointer");this.btCloseSearch.style.margin="20px";this.btCloseSearch.addEventListener("mouseup",c=>{this.mainSearchResult.style.display=
"none"});this.mainSearchResult.appendChild(this.btCloseSearch);this.mainSearchContentDiv=document.createElement("div");this.mainSearchContentDiv.style.width="100%";this.mainSearchContentDiv.style.height=window.innerHeight-130+"px";this.mainSearchContentDiv.style.overflowX="hidden";this.mainSearchContentDiv.style.overflowY="scroll";this.mainSearchResult.appendChild(this.mainSearchContentDiv);this.mainSearchContent=document.createElement("div");this.mainSearchContent.style.width="100%";this.mainSearchContent.style.display=
"flex";this.mainSearchContent.style.flexDirection="column";this.mainSearchContent.style.justifyContent="end";this.mainSearchContent.style.minHeight=window.innerHeight-130+"px";this.mainSearchContentDiv.appendChild(this.mainSearchContent)},searchUserMainView:function(a){if(""==a||3>a.length)this.mainSearchContent.textContent="",this.mainSearchResult.style.display="none";else{var b=(new Date).getTime();if(!(this.lastSearchUserMainView&&300>b-this.lastSearchUserMainView)){this.lastSearchUserMainView=
b;b=[];a=a.toLowerCase().replaceAll("&nbsp;","").trim();for(var c=0;c<this.options.userlist.length;c++)0<=this.options.userlist[c].username.toLowerCase().indexOf(a)&&b.push({userid:this.options.userlist[c].userid,studentid:this.options.userlist[c].studentid,username:this.options.userlist[c].username});if(0<b.length){this.mainSearchContent.textContent="";a=Math.min(200,b.length);for(c=0;c<a;c++){var d=document.createElement("div");d.style.width="100%";d.style.backgroundColor="#222222";d.style.padding=
"10px";d.style.color="#666666";d.style.borderBottom="1px solid #333333";d.style.cursor="pointer";d.style.overflow="hidden";var e=document.createElement("div");e.textContent=b[c].username;e.style.fontSize="16px";e.style.width="100%";e.style.position="relative";d.appendChild(e);d.userInfo=JSON.parse(JSON.stringify(b[c]));var f=document.createElement("div");f.textContent=0!=b[c].userid?"\u0110\u00e3 v\u00e0o thi ":"Ch\u01b0a v\u00e0o thi";0!=b[c].userid?(f.style.color="green",e.style.color="white"):
(f.style.color="#666666",e.style.color="#666666");f.style.width="100%";f.style.position="relative";f.style.fontSize="12px";f.style.marginTop="8px";d.appendChild(f);d.addEventListener("mouseup",l=>{l.currentTarget.userInfo&&0<l.currentTarget.userInfo.userid&&(this.stopLoop(),this.historyView.showUser(this._objUserList[l.currentTarget.userInfo.studentid]))});this.mainSearchContent.appendChild(d)}this.mainSearchResult.style.display="block"}else this.mainSearchResult.style.display="none"}}},initUserView:function(){this.userMedia=
this.findDom(document.createElement("div"));this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+"px");this.userMedia.css("transform-origin","0% 0%");this.userMedia.css("background-color","#222222");this.userMedia.css("position","absolute");this.userMedia.css("overflow","hidden");this.userView.appendChild(this.userMedia);this.history=this.findDom(document.createElement("div"));this.history.css("width",this.historyWidth+"px");this.history.css("height",
"100%");this.history.css("background-color","white");this.history.css("overflow-y","hidden");this.history.css("overflow-x","hidden");this.history.css("position","absolute");this.history.css("right","0px");this.history.css("display","block");this.userView.appendChild(this.history);this.userHeader=this.findDom(document.createElement("div"));this.userHeader.css("width",window.innerWidth-this.historyWidth+"px");this.userHeader.css("height","60px");this.userHeader.css("position","absolute");this.userHeader.css("top",
"0px");this.userHeader.css("left","0px");this.userHeader.css("background-color","#333434");this.userView.appendChild(this.userHeader);this.btUserViewDone=this.createButton(220,36,"M\u00c0N H\u00ccNH THEO D\u00d5I","#1A84E3",14);this.btUserViewDone.css("position","absolute");this.btUserViewDone.css("top","12px");this.btUserViewDone.css("left","12px");this.btUserViewDone.css("cursor","pointer");this.btUserViewDone.addTouch(d=>{this.removeAllUserMedia();this.setState(0)});this.userHeader.appendChild(this.btUserViewDone);
this.myMedia=this.findDom(document.createElement("div"));this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("height","80px");this.myMedia.css("position","absolute");this.myMedia.css("bottom","0px");this.myMedia.css("left","0px");this.myMedia.css("display","flex");this.myMedia.css("flex-direction","row");this.myMedia.css("align-items","center");this.myMedia.css("justify-content","end");this.myMedia.css("background-color","#333434");this.myMedia.css("display","none");
this.userView.appendChild(this.myMedia);this.videoReview=this.findDom(document.createElement("video"));this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.height=80;this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.videoReview.height=80};this.btMyMedia=this.findDom(document.createElement("div"));this.btMyMedia.css("width","35px");this.btMyMedia.css("height",80);this.btMyMedia.css("margin-left","10px");this.btMyMedia.css("margin-right","6px");this.myMedia.appendChild(this.videoReview);
this.myMedia.appendChild(this.btMyMedia);this.btMyCameraOff=this.findDom(document.createElement("div"));this.btMyCameraOff.appendChild(aztExam.svg.getDom(aztExam.svg.iconCameraOff));this.btMyCameraOff.css("width","30px");this.btMyCameraOff.css("height","30px");this.btMyCameraOff.css("fill","#cd1f1f");this.btMyCameraOff.css("color","#cd1f1f");this.btMyCameraOff.css("display","none");this.btMyCameraOff.css("margin-top","5px");this.btMyCameraOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyCameraOff);
this.btMyCamera=this.findDom(document.createElement("div"));this.btMyCamera.appendChild(aztExam.svg.getDom(aztExam.svg.iconCamera));this.btMyCamera.css("width","30px");this.btMyCamera.css("height","30px");this.btMyCamera.css("fill","#dfd9d9");this.btMyCamera.css("color","#dfd9d9");this.btMyCamera.css("display","block");this.btMyCamera.css("margin-top","5px");this.btMyCamera.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyCamera);this.btMyMicOff=this.findDom(document.createElement("div"));
this.btMyMicOff.appendChild(aztExam.svg.getDom(aztExam.svg.iconMicOff));this.btMyMicOff.css("width","25px");this.btMyMicOff.css("height","25px");this.btMyMicOff.css("fill","#cd1f1f");this.btMyMicOff.css("display","none");this.btMyMicOff.css("margin-top","10px");this.btMyMicOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyMicOff);this.btMyMic=this.findDom(document.createElement("div"));this.btMyMic.appendChild(aztExam.svg.getDom(aztExam.svg.iconMic));this.btMyMic.css("width","25px");
this.btMyMic.css("height","25px");this.btMyMic.css("fill","#dfd9d9");this.btMyMic.css("display","block");this.btMyMic.css("cursor","pointer");this.btMyMic.css("margin-top","10px");this.btMyMedia.appendChild(this.btMyMic);this.listUserView=this.findDom(document.createElement("div"));this.listUserView.css("width",this.historyWidth+"px");this.listUserView.css("height","100%");this.listUserView.css("overflow","hidden");this.listUserView.css("background-color","white");this.listUserView.css("position",
"absolute");this.listUserView.css("right","0px");this.listUserView.css("display","block");var a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom="20px";this.listUserView.appendChild(a);var b=this.createButton(130,36,"TH\u00d4NG TIN","#1A84E3",14);b.style.float="left";b.style.marginTop="4px";b.addTouch(d=>{this.showUserHistory()});a.appendChild(b);var c=document.createElement("div");c.style.width=
"59%";c.style.height="21px";c.style.borderRadius="8px";c.style.borderColor="#CCCCCC";c.style.backgroundColor="#edeaea";c.style.color="#afaaaa";c.style.padding="10px";c.style.fontSize="17px";c.style.marginLeft="8px";c.style.float="left";c.textContent="T\u00ecm theo t\u00ean ";c.setAttribute("contenteditable",!0);c.setAttribute("contentsearch","");c.addEventListener("input",()=>{cc.log("on txt search change "+c.textContent);c.setAttribute("contentsearch",c.textContent);this.searchUserListItem(c.textContent)});
c.addEventListener("focus",()=>{""==c.getAttribute("contentsearch")&&(c.textContent="",this.searchUserListItem(c.textContent))});c.addEventListener("blur",()=>{""==c.textContent&&(this.searchUserListItem(""),c.textContent="T\u00ecm theo t\u00ean ")});a.appendChild(c);this.txtListUserInfo=document.createElement("div");this.txtListUserInfo.style.width="50%";this.txtListUserInfo.style.height="20px";this.txtListUserInfo.textContent="";this.txtListUserInfo.style.fontFamily="sans-serif";this.txtListUserInfo.style.fontSize=
"16px";this.txtListUserInfo.style.paddingLeft="15px";this.listUserView.appendChild(this.txtListUserInfo);this.listUser=document.createElement("div");this.listUser.style.width="100%";this.listUser.style.overflowX="hidden";this.listUser.style.overflowY="scroll";this.listUser.style.height=window.innerHeight-80+"px";this.listUserView.appendChild(this.listUser);a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom=
"10px";a.style.display="flex";a.style.flexDirection="row";a.style.justifyContent="start";a.style.alignItems="center";this.history.appendChild(a);b=this.createButton(130,36,"DANH S\u00c1CH","#1A84E3",14);b.style.marginTop="4px";b.addTouch(d=>{this.showListUser()});a.appendChild(b);b=document.createElement("div");b.style.fontSize="16px";b.textContent=aztExam.lang.lbTitleHistory;b.style.fontWeight="bold";b.style.marginTop="4px";b.style.marginLeft="25px";a.appendChild(b)},setState(a){this.state!=a&&(this.state=
a,this.mainView.css("display","none"),this.userView.css("display","none"),0==this.state&&this.mainView.css("display","block"),1==this.state&&this.userView.css("display","block"))},showLoading(){this.loadingDiv.style.display="flex";this.loadingDiv.style.justifyContent="center";this.loadingDiv.style.alignContent="center"},hideLoading(){this.loadingDiv.style.display="none"},update:function(a){a=(new Date).getTime();this._lastTimeIntv?a>this._lastTimeIntv&&1E3<a-this._lastTimeIntv&&(this.processImageIntv(),
this._lastTimeIntv=a):this._lastTimeIntv=a;this._lastTimeGet?a>this._lastTimeGet&&650<a-this._lastTimeGet&&(this.getCurrNew(),this._lastTimeGet=a):this._lastTimeGet=a;this._lastTimeGetOffline?a>this._lastTimeGetOffline&&3E3<a-this._lastTimeGetOffline&&(this.getCurrOffline(),this._lastTimeGetOffline=a):this._lastTimeGetOffline=a;this._running&&setTimeout(()=>{window.requestAnimationFrame(b=>{this.update(b)})},450)},getCurrNew:function(){this.isFirstLoad&&(this.currIndexGet++,this.currIndexGet>=this._arrUserUpdate.length?
(this.currIndexGet=-1,this.isFirstLoad=!1):this.getCurrUser(this._arrUserUpdate[this.currIndexGet]));if(8>this.countLoop){for(var a=null,b=Number.MAX_VALUE,c=0;c<this._arrUserUpdate.length;c++){var d=(new Date).getTime(),e=Number(this._arrUserUpdate[c].lastimeUpdate);if(this._arrUserUpdate[c].info){var f=this._arrUserUpdate[c].info.startTime;4E3<d-e&&e<b&&d-f<this.options.duration&&(b=e,a=this._arrUserUpdate[c])}}a?(this.countLoop++,cc.log("getUserOnline : "+a.userid),this.getCurrUser(a)):0<this.countLoop&&
this.countLoop--}else 8<=this.countLoop&&17>this.countLoop?(this.countLoop++,cc.log("rest")):17<=this.countLoop&&(this.countLoop=0)},getCurrOffline:function(){var a=null,b=Number.MAX_VALUE;(new Date).getTime();for(var c=0;c<this._arrUserUpdate.length;c++){var d=(new Date).getTime();if(this._arrUserUpdate[c].lastimeUpdate){var e=Number(this._arrUserUpdate[c].lastimeUpdate);(null==this._arrUserUpdate[c].info||d-this._arrUserUpdate[c].info.startTime>this.options.duration)&&4E3<d-e&&e<b&&(b=e,a=this._arrUserUpdate[c])}}a&&
(cc.log("getUserOffline : "+a.userid),this.getCurrUser(a))},getCurr:function(){this.isFirstLoad?(this.currIndexGet++,this.currIndexGet>=this._indexEndUpdate?(this.isFirstLoad=!1,this.currIndexGet=-9):(cc.log("load index "+this.currIndexGet),this.getCurrUser(this.options.userlist[this.currIndexGet]))):-1>this.currIndexGet?this.currIndexGet++:(this.countLoop++,9>this.countLoop?this.currIndexGet>=this._indexEndUpdate?this.currIndexGet=-1:(this.currIndexGet++,cc.log("load index "+this.currIndexGet),this.getCurrUser(this.options.userlist[this.currIndexGet])):
24<=this.countLoop&&(this.countLoop=-1))},getCurrUser:function(a){if(a&&a.userid){var b=(new Date).getTime();a.lastimeUpdate=b;if(!(0>=a.userid)){var c=new XMLHttpRequest;c.user=a;c.onreadystatechange=()=>{if(4==c.readyState)if(200==c.status)this.onGetCurrUser(!0,c.responseText,c.user);else this.onGetCurrUser(!1,null,c.user)};b=cc.md5(this.options.take+"_"+this.options.roomid+"_"+a.userid)+"_"+a.userid+"_"+a.studentid+"_curr.txt";c.open("GET",this.options.urlDownload+this.options.roomid+"/"+a.userid+
"/public/"+b+"?t="+(new Date).getTime());c.send()}}},onGetCurrUser:function(a,b,c){a&&(a=this.decodeStr(b))&&(c.info=JSON.parse(JSON.stringify(a.info)),c.imgstr=a.imgstr,c.mainViewItem&&this.bindMainviewItem(c))},addUser:function(a){if(0<a.length){for(var b=-1,c=0;c<a.length;c++)if(a[c].userid&&a[c].username)if(null==this._objUserList[a[c].userid]){var d=JSON.parse(JSON.stringify(a[c]));this.options.userlist.push(d);-1==b&&(b=this.options.userlist.length-1);this._objUserList[a[c].userid]=d;this.getCurrUser(d)}else a[c].t&&
(this._objUserList[a[c]].startTime=a[c].t),this.getCurrUser(this._objUserList[a[c]]);-1<b&&this._indexStartShow+this._numShow>b&&this.showUser()}},backShowUser:function(){if(this._indexStartShow>=this._numShow){this._indexStartUpdate=this._indexStartShow-=this._numShow;this._indexEndUpdate=this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("backShowUser :"+
this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);this.showUser();this.sendMessControlToStudent();this.showLoading();setTimeout(()=>{this.hideLoading()},1E3)}},nextShowUser:function(){this._indexStartUpdate=this._indexStartShow=this._indexStartShow+this._numShow<this.options.userlist.length?this._indexStartShow+this._numShow:0;this._indexEndUpdate=
this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);cc.log("nextShowUser :"+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this.showUser();this.sendMessControlToStudent();this.showLoading();
setTimeout(()=>{this.hideLoading()},1E3)},initShowUser:function(){var a=-1,b=this.getLocalStorage("aztTeacherControl_"+this.options.roomid);if(!cc.isEmpty(b))try{a=JSON.parse(b).idx}catch(c){}cc.log("localStartShow "+a);this._indexStartUpdate=this._indexStartShow=0<=a?a:0;this._indexEndUpdate=this.options.userlist.length>this._maxUserUpdate+this._indexStartUpdate?this._maxUserUpdate+this._indexStartUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("list user : "+
JSON.stringify(this.options.userlist));cc.log("initShowUser "+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this._arrUserUpdate=[];for(a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);this.sendMessControlToStudent();this.showUser()},sendMessControlToStudent:function(){for(var a=[],b=0;b<this._arrUserUpdate.length;b++)a.push(this._arrUserUpdate[b].userid);var c={idx:this._indexStartShow,cmd:"neba",arr:a.toString()};this.examLiveTeachers_teacher_saveChange(this.options.roomid,
c,d=>{cc.log("write control response :"+JSON.stringify(d));this.setLocalStorage("aztTeacherControl_"+this.options.roomid,JSON.stringify(c))})},showUser:function(){this.bindClassMedia();this.txtClassInfo.textContent="Danh s\u00e1ch h\u1ecdc sinh ( "+this.options.userlist.length+" )";var a=Math.floor(this.options.userlist.length/this._numShow);a=a==this.options.userlist.length/this._numShow?a:a+1;var b=Math.floor(this._indexStartShow/this._numShow)+1;this.infoNext.textContent=b+" / "+a;this.infoBack.textContent=
b+" / "+a;this.btBack.style.display="block";this.btNext.style.display="block"},refreshUserJoin:function(){for(var a=0,b=(new Date).getTime(),c=0;c<this.options.userlist.length;c++)this.options.userlist[c].info&&b-this.options.userlist[c].info.startTime<this.options.duration&&a++},bindClassMedia:function(){var a=this._arrUserUpdate;if(0!=a.length){cc.log("bindClassMedia "+a.length);for(var b=Math.sqrt(this._numShow),c=0,d=Math.floor(this.mainViewWidth/b)-1,e=Math.floor(this.mainViewHeight/Math.sqrt(this._numShow))-
1,f=0;f<this.options.userlist.length;f++)this.options.userlist[f].mainViewItem=null;cc.removeAllChildNodes(this.classMedia);for(f=0;f<this._arrUserUpdate.length;f++){var l=this.createMainviewItem(a[f],d,e);l.style.position="absolute";l.style.overflow="hidden";l.style.left=c%b*d+"px";l.style.top=Math.floor(c/b)*e+"px";l.style.cursor="pointer";l.addEventListener("mouseup",p=>{p.currentTarget.user&&(this.stopLoop(),this.historyView.showUser(p.currentTarget.user));p.stopPropagation()});l.addEventListener("mouseover",
p=>{p.currentTarget.tooltip.style.display="block"});l.addEventListener("mouseout",p=>{p.currentTarget.tooltip.style.display="none"});this.classMedia.appendChild(l);c++}}},processImageIntv:function(){if(0==this.state)for(var a=document.getElementsByClassName("aztExam_image_intv"),b=0;b<a.length;b++){var c=a[b];if(c.hasLoaded){var d=c.image,e=c.info.w,f=c.currIdx,l=c.info.numImage;0<=c.currIdx&&0<l&&(col=f,d.style.marginLeft=-(col*e)+"px",null!=c.info.warning[f.toString()]?(d=parseInt(c.info.warning[f.toString()]),
1<d&&(c.warning.style.backgroundColor="yellow",c.warning.style.display="block"),0==d&&(c.warning.style.backgroundColor="red",c.warning.style.display="block")):c.warning.style.display="none",f=f<l-1?f+1:-4,c.currIdx=f)}}},createMainviewItem:function(a,b,c){var d=document.createElement("div");d.style.border="1px solid black";d.style.backgroundColor="#2e2d2d";d.style.width=b+"px";d.style.height=c+"px";d.user=a;var e=this.findDom(document.createElement("div"));e.css("font-size","14px");e.css("color",
"white");e.css("width",b+"px");e.css("height","28px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");e.css("background-color","#4c4949");var f=document.createElement("span");f.style.width=b-70+"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.textContent=a.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.appendChild(aztExam.svg.getDom(aztExam.svg.iconRefresh));
f.css("position","absolute");f.css("width","15px");f.css("height","15px");f.css("bottom","8px");f.css("right","30px");f.css("display","block");f.css("cursor","pointer");f.setAttribute("icRefresh",!0);f.addEventListener("mouseup",p=>{this.getCurrUser(p.currentTarget.it.user);p.stopPropagation()});f.it=d;d.icRefresh=f;f=this.findDom(document.createElement("div"));f.css("border-radius","50%");f.css("background-color","gray");f.css("width","6px");f.css("height","6px");f.css("position","absolute");f.css("bottom",
"11px");f.css("right","11px");e.appendChild(f);d.icStatus=f;f=this.findDom(document.createElement("div"));f.appendChild(aztExam.svg.getDom(aztExam.svg.iconWarning));f.css("position","absolute");f.css("bottom","8px");f.css("right","60px");f.css("display","none");d.icWarning=f;f=document.createElement("span");f.style.position="absolute";f.style.width="60px";f.style.right="22px";f.style.bottom="8px";f.style.textAlign="right";f.style.color="gray";e.appendChild(f);d.txtTimeUpdate=f;f=22<=c-50?c-50:22;
var l=this.createCircleAva(a.username,f,"#222222","gray");d.appendChild(l);l.style.position="absolute";l.style.top="12px";l.style.left=(b-f)/2+"px";a.imageIntv||(a.imageIntv=this.createImageIntv());d.imageIntv=a.imageIntv;d.imageIntv.style.display="none";d.appendChild(d.imageIntv);d.appendChild(e);b=this.findDom(document.createElement("div"));b.appendChild(aztExam.svg.getDom(aztExam.svg.iconSharescreen));b.css("position","absolute");b.css("top","8px");b.css("left","8px");b.css("display","none");b.style.fill=
"#0af50a";b.style.zIndex=999999;d.icScreen=b;d.appendChild(b);b=this.findDom(document.createElement("div"));b.appendChild(aztExam.svg.getDom(aztExam.svg.iconMobile));b.css("position","absolute");b.css("top","8px");b.css("left","40px");b.css("display","none");b.style.fill="#0af50a";b.style.zIndex=99999;d.icMobile=b;d.appendChild(b);tooltip=document.createElement("div");tooltip.style.width="100%";tooltip.style.height="20px";tooltip.style.backgroundColor="#222222";tooltip.style.color="#AAAAAA";tooltip.textContent=
"XEM CHI TI\u1ebeT ";tooltip.style.lineHeight="20px";tooltip.style.fontSize="13px";tooltip.style.padding="8px";tooltip.style.textAlign="center";tooltip.style.top=(c-40)/2+"px";tooltip.style.position="absolute";tooltip.style.display="none";tooltip.style.opacity=.65;d.tooltip=tooltip;d.appendChild(tooltip);a.mainViewItem=d;this.bindMainviewItem(a);return d},bindMainviewItem:function(a){if(a&&a.mainViewItem&&a.info&&a.imgstr){var b=a.mainViewItem,c=a.info,d=a.imgstr;a=this.isOnline(c);b.icStatus.style.backgroundColor=
a?"#0af50a":"yellow";b.spanName.style.color=a?"white":"gray";b.icWarning.style.display=c.isWarning&&a?"block":"none";b.icScreen.style.display=1==c.deviceInfo.hasShareScreen?"block":"none";b.icMobile.style.display=1==c.deviceInfo.hasExCam?"block":"none";var e=(new Date).getTime();e=Math.floor((e-c.time)/1E3);e=3600<e?Math.floor(e/3600)+"h":60<e?Math.floor(e/60)+"m":e+"s";b.txtTimeUpdate.textContent=e+" ago";b.imageIntv.style.display="block";e=b.imageIntv;if(e.imageTime!=c.time){e=b.imageIntv;var f=
e.image;f.src="data:image/jpeg;base64,"+d;f.style.marginTop="0px";f.style.marginLeft="0px";e.currIdx=0;e.info=c;e.hasLoaded=!0;e.imageTime=c.time;d=c.w;var l=c.h;e.style.width=d+"px";e.style.height=l+"px";f=parseInt(b.style.width);l=(parseInt(b.style.height)-28)/l;e.style.transform="scale("+l+")";e.style.top="0px";e.style.left=(f-d*l)/2+"px"}b.lastimeUpdate=(new Date).getTime();b.hasLoaded=!0;b.status="updated";b.info=c;b.user.isOnline=a;b.user.info=c}},createImageIntv:function(a){a=this.findDom(document.createElement("div"));
a.style.overflow="hidden";a.style.width=this._imageCaptureWidth+"px";a.style.height=this._imageCaptureHeight+"px";a.classList.add("aztExam_image_intv");a.style.transformOrigin="0% 0%";a.style.position="absolute";a.style.backgroundColor="#2e2d2d";var b=new Image;b.style.position="absolute";a.appendChild(b);var c=document.createElement("div");c.style.position="absolute";c.style.width="100%";c.style.height="100%";c.style.backgroundColor="red";c.style.opacity="0.3";c.style.display="none";a.warning=c;
a.appendChild(c);a.currIdx=-1;a.image=b;a.imageTime=-1;a.info=null;return a},initConn:function(){this.arrConn=[];for(var a=0;4>a;a++)this.arrConn[a]=new aztExam.RTCConnection(this),this.arrConn[a].initConn(this.options.user.userid,"user_"+a,"find_offer"),this.app.appendChild(this.arrConn[a].ui)},addUserMedia:function(a){if(cc.isArray(a)&&0<a.length){for(var b=0;b<a.length>0;b++)this.initUserConn(a[b]);this.history.user=a[0];this.bindUserMedia(this.arrUserConn);this.getListFile(this.options.roomid,
a[0].userid)}else this.initUserConn(a),this.history.user=a,this.bindUserHistory(a),this.bindUserMedia(this.arrUserConn),this.getListFile(this.options.roomid,a.userid)},initUserConn:function(a){for(var b=-1,c=-1,d=0;d<this.arrUserConn.length;d++)this.arrUserConn[d].user==a&&(b=d),!this.arrUserConn[d].isUsed&&0>c&&(c=d);if(!(0<=b)){b=null;if(0>c)if(4>this.arrUserConn.length)b=new aztExam.RTCConnection(this),this.arrUserConn.push(b);else{c=Number.MAX_VALUE;var e=null;for(d=0;d<this.arrUserConn.length;d++)0<=
this.arrUserConn[d].timeUsed&&this.arrUserConn[d].timeUsed<c&&(c=this.arrUserConn[d].timeUsed,e=this.arrUserConn[d]);e&&(b=e,b.stop())}else b=this.arrUserConn[c];b.user=a;b.start(this.options.user.userid,a.userid)}},removeUserMedia:function(a){for(var b=-1,c=0;c<this.arrUserConn.length;c++)if(this.arrUserConn[c].user==a){b=c;break}0<=b&&(this.arrUserConn[c].stop(),this.arrUserConn[c].user=null);this.bindUserMedia(this.arrUserConn)},removeAllUserMedia:function(a){for(a=0;a<this.arrUserConn.length;a++)this.arrUserConn[a].stop(),
this.arrUserConn[a].user=null;this.bindUserMedia(this.arrUserConn)},resizeUserMedia:function(){var a=this.userMedia.childNodes;if(0<a.length){var b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/b,d=Math.floor(a.length/b);d=d==a.length/b?d:d+1;b=Math.floor((this.userMediaWidth-2)/d);2==a.length&&(b=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(var e=0;e<a.length;e++){var f=a[e];f.style.width=b+"px";f.style.height=c+"px";f.style.top=Math.floor(e/d)*
c+"px";f.style.left=Math.floor(e%d)*b+"px";f.conn.resizeUI(b,c-50);f.ava.style.top=(c-50-parseInt(f.ava.style.height))/2+"px";f.ava.style.left=(b-parseInt(f.ava.style.width))/2+"px"}}},bindUserMedia:function(a){cc.removeAllChildNodes(this.userMedia);a=[];for(var b=0;b<this.arrUserConn.length;b++)this.arrUserConn[b].isUsed&&a.push(this.arrUserConn[b]);if(0<a.length){b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/b,d=Math.floor(a.length/b);d=d==a.length/
b?d:d+1;var e=Math.floor((this.userMediaWidth-2)/d);2==a.length&&(e=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(b=0;b<a.length;b++){var f=this.createUserMediaItem(a[b],e,c);f.style.position="absolute";f.style.width=e+"px";f.style.height=c+"px";f.style.top=Math.floor(b/d)*c+"px";f.style.left=Math.floor(b%d)*e+"px";f.conn=a[b];this.userMedia.appendChild(f)}}},createUserMediaItem:function(a,b,c){var d=document.createElement("div");d.style.border="1px solid black";d.style.backgroundColor="#2e2d2d";
d.style.width=b+"px";d.style.height=c+"px";d.addEventListener("mouseup",p=>{this.history.user=p.currentTarget.conn.user;this.bindUserHistory(p.currentTarget.conn.user);this.showUserHistory();p.stopPropagation()});d.conn=a;var e=this.findDom(document.createElement("div"));e.css("font-size","16px");e.css("color","white");e.css("width","100%");e.css("height","50px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");e.css("background-color","#222222");
var f=document.createElement("span");f.style.width=b-70+"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.textContent=a.user.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.appendChild(aztExam.svg.getDom(aztExam.svg.iconClose));f.css("position","absolute");f.css("width","30px");f.css("height","30px");f.css("bottom","18px");f.css("right","10px");f.css("display","block");f.css("cursor","pointer");f.conn=
a;f.addEventListener("mouseup",p=>{this.removeUserMedia(p.currentTarget.conn.user);p.stopPropagation()});e.appendChild(f);f=22<=c-50?c-50:22;f=200<f?200:f;var l=this.createCircleAva(a.user.username,f,"#222222","gray");d.ava=l;d.appendChild(l);l.style.position="absolute";l.style.top=(c-50-f)/2+"px";l.style.left=(b-f)/2+"px";a.ui.style.position="absolute";a.resizeUI(b,c-50);d.appendChild(a.ui);d.appendChild(e);return d},isOnline:function(a){return a&&a.time&&(new Date).getTime()-a.time<this._timeOnlineIntv?
!0:!1},role:function(){return"teacher"}});aztExam.MonitorTeacher=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorTeacher(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();aztExam=aztExam||{};
aztExam.monitorCamera=aztExam.monitor.extend({ctor:function(){this.init();this.initUI();setTimeout(()=>{this.conn&&this.conn.resizeUI(window.innerWidth,window.innerHeight)},4E3)},init:function(){this._super()},initUI:function(){this.videoReview=document.createElement("video");this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.style.position="relative";this.videoReview.classList.add("azt_monitor_webcam_review");this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.updatePreviewUI()};
this.videoReview.onresize=()=>{this.updatePreviewUI()};document.body.appendChild(this.videoReview)},updatePreviewUI:function(){0!=window.innerHeight&&0!=this.videoReview.videoHeight&&(this.videoReview.style.width="100%",this.videoReview.style.height="auto")},startSession:function(a){a!=this._optionsPreparing&&(this._optionsPreparing=a,this._state=1,this.collectDeviceInfo(()=>{if(this.deviceInfo.isSupportMonitor){if(!this.stream){var b=-1,c=-1;0<this.deviceInfo.videoInputDevices.length&&(b=0);0<this.deviceInfo.audioInputDevices.length&&
(c=0);this.getMediaUser(b,c)}a.getUrlPublicTry=0;this.initUrlUploadPublic(a,()=>{cc.log("initUrlUploadPublic ok");setTimeout(()=>{this.startCamera(a)},100)})}else this.showDeviceUI(this.deviceInfo)}))},stopSession:function(){cc.log("stop session");this.destroyStream();this._stopMonitoring();this.conn&&this.conn.reset();this._state=0;this._optionsPreparing=null;this._isGetLastCurr=!1},startCamera:function(a){this.parseOption(a);this._state=2;this._initConn()},gotStream:function(a,b,c){this._super(a,
b,c);setTimeout(()=>{0==this._state?this.stopAllPreview():this._initConn()},10)},handleError:function(a,b,c,d){0!=this._state&&this._super(a,b,c,d)},destroyStream:function(){this._super()},initUrlUploadPublic:function(a,b){cc.log("getUrlPublic");var c=a.config.domainApi+"s3space/get_public_upload_url_for_qr_live";a.urlDownload="";a.urlOffer="";this.getPublicUploadQr(c,a.tk,a.roomid,0,a.user.userid,a.user.userid+"_offer_cam.txt",1,0,(d,e,f,l)=>{d&&""!=d?(a.urlOffer=d,d=e.indexOf(a.roomid),0<=d&&(a.urlDownload=
e.substr(0,d)),a.prefixName=l.replaceAll("_"+a.user.userid+"_offer_cam.txt",""),b&&b()):(cc.log("getCurr url "+d),a.getUrlPublicTry++,0!=this._state&&5>a.getUrlPublicTry?setTimeout(()=>{this.initUrlUploadPublic(a,b)},5E3):b&&b())})},_initConn:function(){cc.log("initConn");2==this._state&&this.stream&&(null==this.conn?(this.conn=new aztExam.RTCConnection(this),this.conn.autoReconnect=!1,this.conn.addCEventListener("stateChange",()=>{"close"==this.conn.stateConnection()&&(this.conn.txtConnecting.textContent=
"M\u1ea5t k\u1ebft n\u1ed1i , t\u1eaft tr\u00ecnh duy\u1ec7t v\u00e0 qu\u00e9t l\u1ea1i m\u00e3 qrcode \u0111\u1ec3 k\u1ebft n\u1ed1i !")}),document.body.appendChild(this.conn.ui),this.conn.ui.style.position="absolute",this.conn.ui.style.top="0px",this.conn.ui.style.left="0px",this.conn.resizeUI(window.innerWidth,window.innerHeight)):this.conn.reset(),this.conn.start(this.options.user,null,"offer",{upload:this.options.urlOffer,download:""},{upload:"",download:this.options.urlDownload+this.options.roomid+
"/"+this.options.user.userid+"/public/"+this.options.prefixName+"_"+this.options.user.userid+"_answer_cam.txt"},this.stream,!0,(new Date).getTime(),this.options.fn),this.conn.txtConnecting.textContent="\u0110ang k\u1ebft n\u1ed1i v\u1edbi m\u00e1y t\u00ednh , qu\u00e1 tr\u00ecnh k\u1ebft n\u1ed1i c\u00f3 th\u1ec3 m\u1ea5t t\u1eeb 10-15 gi\u00e2y ...",this.conn.txtConnecting.style.height="90px")},role:function(){return"student"}});
aztExam.MonitorCamera=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorCamera(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();
